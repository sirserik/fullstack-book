<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel + Nuxt: Полный курс разработки</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/nginx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/ini.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <span class="logo-laravel">L</span>
                    <span class="logo-plus">+</span>
                    <span class="logo-nuxt">N</span>
                </div>
                <div class="logo-text">
                    <span class="logo-title">Laravel + Nuxt</span>
                    <span class="logo-subtitle">Fullstack Course</span>
                </div>
            </div>
        </div>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item active" data-chapter="intro">
                    <span class="nav-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                    </span>
                    <span class="nav-text">Главная</span>
                </li>
                <li class="nav-item" data-chapter="chapter1">
                    <span class="nav-number">01</span>
                    <span class="nav-text">Введение</span>
                </li>
                <li class="nav-item" data-chapter="chapter2">
                    <span class="nav-number">02</span>
                    <span class="nav-text">Backend Laravel</span>
                </li>
                <li class="nav-item" data-chapter="chapter3">
                    <span class="nav-number">03</span>
                    <span class="nav-text">Frontend Nuxt</span>
                </li>
                <li class="nav-item" data-chapter="chapter4">
                    <span class="nav-number">04</span>
                    <span class="nav-text">Интеграция</span>
                </li>
                <li class="nav-item" data-chapter="chapter5">
                    <span class="nav-number">05</span>
                    <span class="nav-text">Деплой</span>
                </li>
                <li class="nav-item" data-chapter="chapter6">
                    <span class="nav-number">06</span>
                    <span class="nav-text">Docker</span>
                </li>
                <li class="nav-item" data-chapter="chapter7">
                    <span class="nav-number">07</span>
                    <span class="nav-text">Laravel 12 API</span>
                </li>
                <li class="nav-item" data-chapter="chapter8">
                    <span class="nav-number">08</span>
                    <span class="nav-text">Nuxt 4</span>
                </li>
                <li class="nav-item" data-chapter="chapter9">
                    <span class="nav-number">09</span>
                    <span class="nav-text">Tailwind CSS 4</span>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="tech-badges">
                <span class="badge badge-laravel">Laravel 12</span>
                <span class="badge badge-nuxt">Nuxt 4</span>
                <span class="badge badge-vue">Vue 3</span>
                <span class="badge badge-tailwind">Tailwind 4</span>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="menu-toggle" id="menuToggle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <span class="mobile-title">Laravel + Nuxt</span>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Intro/Home Page -->
        <section class="chapter active" id="intro">
            <div class="hero">
                <div class="hero-background">
                    <div class="hero-gradient"></div>
                    <div class="hero-pattern"></div>
                </div>
                <div class="hero-content">
                    <div class="hero-badge">OPEN SOURCE • FULLSTACK</div>
                    <h1 class="hero-title">
                        <span class="title-laravel">Laravel</span>
                        <span class="title-plus">+</span>
                        <span class="title-nuxt">Nuxt</span>
                    </h1>
                    <p class="hero-subtitle">Полный курс разработки на практике</p>
                    <p class="hero-description">
                        Бесплатная книга по созданию fullstack-приложений с нуля до production.
                        <strong>Open Source</strong> для всех разработчиков.
                    </p>
                    <button class="cta-button" onclick="navigateTo('chapter1')">
                        Начать обучение
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"/>
                            <polyline points="12,5 19,12 12,19"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="content-section">
                <h2 class="section-title">Архитектура проекта</h2>
                <div class="architecture-diagram">
                    <div class="arch-box arch-frontend">
                        <div class="arch-header">FRONTEND</div>
                        <div class="arch-tech">Nuxt 3 / Vue 3</div>
                        <ul class="arch-list">
                            <li>Components</li>
                            <li>Pages</li>
                            <li>Stores (Pinia)</li>
                            <li>i18n</li>
                        </ul>
                    </div>
                    <div class="arch-connector">
                        <div class="connector-line"></div>
                        <div class="connector-label">REST API</div>
                        <div class="connector-line"></div>
                    </div>
                    <div class="arch-box arch-backend">
                        <div class="arch-header">BACKEND</div>
                        <div class="arch-tech">Laravel 8</div>
                        <ul class="arch-list">
                            <li>Models</li>
                            <li>Controllers</li>
                            <li>API Routes</li>
                            <li>Resources</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="section-title">Оглавление</h2>
                <div class="chapters-grid">
                    <div class="chapter-card" onclick="navigateTo('chapter1')">
                        <div class="chapter-number">01</div>
                        <h3 class="chapter-title">Введение</h3>
                        <p class="chapter-desc">Архитектура, стек технологий, структура проекта</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter2')">
                        <div class="chapter-number">02</div>
                        <h3 class="chapter-title">Backend Laravel</h3>
                        <p class="chapter-desc">Модели, контроллеры, API, миграции</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter3')">
                        <div class="chapter-number">03</div>
                        <h3 class="chapter-title">Frontend Nuxt</h3>
                        <p class="chapter-desc">Компоненты, страницы, stores, i18n</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter4')">
                        <div class="chapter-number">04</div>
                        <h3 class="chapter-title">Интеграция</h3>
                        <p class="chapter-desc">Связь frontend и backend</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter5')">
                        <div class="chapter-number">05</div>
                        <h3 class="chapter-title">Деплой</h3>
                        <p class="chapter-desc">Развёртывание на production сервере</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter6')">
                        <div class="chapter-number">06</div>
                        <h3 class="chapter-title">Docker</h3>
                        <p class="chapter-desc">Docker Compose для development и production</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter7')">
                        <div class="chapter-number">07</div>
                        <h3 class="chapter-title">Laravel 12 API</h3>
                        <p class="chapter-desc">Sanctum, Resources, Rate Limiting, тесты</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter8')">
                        <div class="chapter-number">08</div>
                        <h3 class="chapter-title">Nuxt 4</h3>
                        <p class="chapter-desc">Новая структура, data fetching, TypeScript</p>
                    </div>
                    <div class="chapter-card" onclick="navigateTo('chapter9')">
                        <div class="chapter-number">09</div>
                        <h3 class="chapter-title">Tailwind CSS 4</h3>
                        <p class="chapter-desc">CSS-first конфигурация, @theme, утилиты</p>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="section-title">Что вы создадите</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">100+</div>
                        <div class="stat-label">Моделей</div>
                        <div class="stat-tech">Laravel</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">135+</div>
                        <div class="stat-label">Контроллеров</div>
                        <div class="stat-tech">Laravel</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">100+</div>
                        <div class="stat-label">Компонентов</div>
                        <div class="stat-tech">Nuxt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">38+</div>
                        <div class="stat-label">Страниц</div>
                        <div class="stat-tech">Nuxt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Языка</div>
                        <div class="stat-tech">RU/EN/KZ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">70+</div>
                        <div class="stat-label">API Endpoints</div>
                        <div class="stat-tech">REST</div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="section-title">Что вы изучите</h2>
                <div class="skills-container">
                    <div class="skills-column">
                        <h3 class="skills-header">
                            <span class="skills-icon backend-icon"></span>
                            Backend
                        </h3>
                        <ul class="skills-list">
                            <li>Eloquent ORM</li>
                            <li>REST API разработка</li>
                            <li>Миграции и связи</li>
                            <li>API Resources</li>
                            <li>CORS настройка</li>
                        </ul>
                    </div>
                    <div class="skills-column">
                        <h3 class="skills-header">
                            <span class="skills-icon frontend-icon"></span>
                            Frontend
                        </h3>
                        <ul class="skills-list">
                            <li>Composition API</li>
                            <li>Nuxt 3 структура</li>
                            <li>Компоненты Vue 3</li>
                            <li>Pinia state management</li>
                            <li>i18n локализация</li>
                            <li>Tailwind CSS</li>
                        </ul>
                    </div>
                    <div class="skills-column">
                        <h3 class="skills-header">
                            <span class="skills-icon deploy-icon"></span>
                            Деплой
                        </h3>
                        <ul class="skills-list">
                            <li>Настройка VPS сервера</li>
                            <li>Nginx конфигурация</li>
                            <li>SSL сертификаты</li>
                            <li>PM2 для Node.js</li>
                            <li>Docker</li>
                            <li>CI/CD пайплайны</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>



        <!-- Chapter 01: Введение -->
        <section class="chapter" id="chapter1">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 01</span>
                <h1>Введение</h1>
            </div>

            <div class="content-section">
                <h2>Что такое fullstack-приложение?</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                         FULLSTACK АРХИТЕКТУРА                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                              ПОЛЬЗОВАТЕЛЬ                               │
│                                   │                                     │
│                                   ▼                                     │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        FRONTEND (Nuxt 3)                        │   │
│   │   • Отображение интерфейса                                      │   │
│   │   • Обработка пользовательских действий                         │   │
│   │   • SSR/CSR рендеринг                                           │   │
│   │   • Локализация (i18n)                                          │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                   │                                     │
│                          HTTP запросы (REST API)                        │
│                                   │                                     │
│                                   ▼                                     │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                       BACKEND (Laravel 8)                       │   │
│   │   • Бизнес-логика                                               │   │
│   │   • Работа с базой данных                                       │   │
│   │   • Аутентификация                                              │   │
│   │   • API endpoints                                               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                   │                                     │
│                                   ▼                                     │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                         DATABASE (MySQL)                        │   │
│   │   • Хранение данных                                             │   │
│   │   • Переводы (translates)                                       │   │
│   │   • Контент страниц                                             │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Структура проекта — структура</h2>
<h3>Backend (Laravel)</h3>
<pre><code class="language-text">app-backend/
├── app/
│   ├── Http/
│   │   ├── Controllers/
│   │   │   ├── Controller.php          # Базовый контроллер
│   │   │   ├── ApiController.php       # Главный API контроллер
│   │   │   ├── NewsController.php      # CRUD новостей
│   │   │   └── ...                     # 135+ контроллеров
│   │   └── Resources/
│   │       ├── NewsResource.php        # Трансформация News → JSON
│   │       └── ...                     # 40+ ресурсов
│   └── Models/
│       ├── Translate.php               # Мультиязычность
│       ├── News.php                    # Новости
│       ├── BachelorSchool.php          # Факультеты
│       └── ...                         # 100+ моделей
├── database/
│   ├── migrations/                     # 110+ миграций
│   └── seeders/
├── routes/
│   ├── api.php                         # API маршруты
│   └── web.php                         # Web маршруты (админка)
├── config/
│   └── cors.php                        # CORS настройки
└── composer.json</code></pre>
<h3>Frontend (Nuxt)</h3>
<pre><code class="language-text">app-frontend/
├── components/
│   ├── MainHeader.vue
│   ├── MainFooter.vue
│   ├── about/                          # Компоненты "О нас"
│   ├── admission/                      # Компоненты "Поступление"
│   └── ...                             # 100+ компонентов
├── pages/
│   ├── index.vue                       # Главная
│   ├── news/
│   │   ├── index.vue                   # Список новостей
│   │   └── [slug].vue                  # Детальная страница
│   └── ...                             # 38+ страниц
├── layouts/
│   └── default.vue                     # Основной layout
├── stores/
│   ├── lang.ts                         # Язык
│   └── seo.ts                          # SEO данные
├── locales/
│   ├── ru.json
│   ├── en.json
│   └── kz.json
├── nuxt.config.ts
├── tailwind.config.js
└── package.json</code></pre>
<hr>
<h2>Ключевая концепция: Мультиязычность</h2>
<p>В проекте MyApp используется уникальная система переводов — все тексты хранятся в таблице <code>translates</code>:</p>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                         СИСТЕМА ПЕРЕВОДОВ                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   Таблица: translates                                                   │
│   ┌────────┬─────────────────────┬──────────────┬──────────────────┐    │
│   │ id     │ ru                  │ en           │ kz               │    │
│   ├────────┼─────────────────────┼──────────────┼──────────────────┤    │
│   │ 1      │ "Добро пожаловать"  │ "Welcome"    │ "Қош келдіңіз"   │    │
│   │ 2      │ "Новости"           │ "News"       │ "Жаңалықтар"     │    │
│   │ 3      │ "О нас"             │ "About us"   │ "Біз туралы"     │    │
│   └────────┴─────────────────────┴──────────────┴──────────────────┘    │
│                                                                         │
│   Таблица: news                                                         │
│   ┌────────┬──────────────┬──────────────────────┬────────────┐         │
│   │ id     │ name (FK)    │ background_image     │ date       │         │
│   ├────────┼──────────────┼──────────────────────┼────────────┤         │
│   │ 1      │ 1            │ /storage/img/1.jpg   │ 2024-01-15 │         │
│   │ 2      │ 2            │ /storage/img/2.jpg   │ 2024-01-20 │         │
│   └────────┴──────────────┴──────────────────────┴────────────┘         │
│                 │                                                       │
│                 └──────► Связь с translates через name (FK)             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>API структура</h2>
<p>Структура проекта предоставляет публичный REST API:</p>
<div class="table-wrapper"><table>
<thead><tr><th>Endpoint</th><th>Описание</th></tr></thead>
<tbody>
<tr><td><code>GET /api/mainPage</code></td><td>Главная страница</td></tr>
<tr><td><code>GET /api/news</code></td><td>Список новостей</td></tr>
<tr><td><code>GET /api/news?year=2024&month=1</code></td><td>Фильтрация новостей</td></tr>
<tr><td><code>GET /api/aboutUs</code></td><td>О университете</td></tr>
<tr><td><code>GET /api/bachelorSchool</code></td><td>Факультеты</td></tr>
<tr><td><code>GET /api/contacts</code></td><td>Контакты</td></tr>
<tr><td><code>GET /api/headerNavBar</code></td><td>Меню шапки</td></tr>
<tr><td><code>GET /api/footerNavBar</code></td><td>Меню футера</td></tr>
<tr><td><code>GET /api/metaData</code></td><td>SEO данные</td></tr>
</tbody></table></div>
<hr>
<h2>Требования к окружению</h2>
<h3>Backend</h3>
<ul class="styled-list">
<li>PHP 7.3+ или 8.0+</li>
<li>Composer</li>
<li>MySQL 5.7+</li>
<li>Apache/Nginx</li>
</ul>
<h3>Frontend</h3>
<ul class="styled-list">
<li>Node.js 18+</li>
<li>npm или yarn</li>
</ul>
<h3>Для деплоя</h3>
<ul class="styled-list">
<li>VPS сервер (Ubuntu 20.04+)</li>
<li>Nginx</li>
<li>PM2 (для Node.js)</li>
<li>Supervisor (для Laravel очередей)</li>
<li>Let's Encrypt (SSL)</li>
</ul>
<hr>
<h2>Чек-лист главы</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Понимаю fullstack архитектуру</li>
<li class="checklist"><input type="checkbox" disabled> Понимаю структуру проекта</li>
<li class="checklist"><input type="checkbox" disabled> Понимаю систему мультиязычности</li>
<li class="checklist"><input type="checkbox" disabled> Знаю основные API endpoints</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../02-Backend-Laravel/README.md">Backend Laravel →</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('intro')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter2')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 02: Backend Laravel -->
        <section class="chapter" id="chapter2">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 02</span>
                <h1>Backend Laravel</h1>
            </div>

            <div class="content-section">
                <h2>Создание проекта</h2>
<pre><code class="language-bash">composer create-project laravel/laravel app-backend "8.*"
cd app-backend</code></pre>
<h3>Зависимости (composer.json)</h3>
<pre><code class="language-json">{
    "require": {
        "php": "^7.3|^8.0",
        "laravel/framework": "^8.12",
        "laravel/tinker": "^2.5",
        "laravel/ui": "^3.2",
        "intervention/image": "^2.5",
        "jeroennoten/laravel-adminlte": "^3.5",
        "fruitcake/laravel-cors": "^2.0",
        "guzzlehttp/guzzle": "^7.0.1"
    }
}</code></pre>
<pre><code class="language-bash">composer install</code></pre>
<hr>
<h2>Настройка .env</h2>
<pre><code class="language-ini">APP_NAME=MyApp
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=myapp
DB_USERNAME=root
DB_PASSWORD=</code></pre>
<hr>
<h2>Миграции</h2>
<h3>Таблица переводов (translates)</h3>
<p>Центральная таблица для мультиязычности:</p>
<pre><code class="language-php">&lt;?php
// database/migrations/2024_03_11_085138_create_translates_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateTranslatesTable extends Migration
{
    public function up()
    {
        Schema::create('translates', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;timestamps();
            $table-&gt;text('ru')-&gt;nullable();
            $table-&gt;text('kz')-&gt;nullable();
            $table-&gt;text('en')-&gt;nullable();
        });
    }

    public function down()
    {
        Schema::dropIfExists('translates');
    }
}</code></pre>
<h3>Таблица новостей (news)</h3>
<pre><code class="language-php">&lt;?php
// database/migrations/2024_03_26_052941_create_news_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateNewsTable extends Migration
{
    public function up()
    {
        Schema::create('news', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;timestamps();
            $table-&gt;string('name');              // FK → translates.id
            $table-&gt;string('background_image');
            $table-&gt;date('date');
        });
    }

    public function down()
    {
        Schema::dropIfExists('news');
    }
}</code></pre>
<h3>Таблица контактов (contacts)</h3>
<pre><code class="language-php">&lt;?php
// database/migrations/2024_03_25_090654_create_contacts_table.php

Schema::create('contacts', function (Blueprint $table) {
    $table-&gt;id();
    $table-&gt;timestamps();
    $table-&gt;string('tab_name')-&gt;nullable();        // FK → translates.id
    $table-&gt;string('address');
    $table-&gt;string('admissions_committee_num_1');
    $table-&gt;string('admissions_committee_num_2');
    $table-&gt;string('admissions_committee_mail');
    $table-&gt;string('rectors_reception_num');
    $table-&gt;string('office_receptionist_num');
    $table-&gt;string('tiktok_name');
    $table-&gt;text('tiktok_link');
    $table-&gt;string('instagram_name');
    $table-&gt;text('instagram_link');
    $table-&gt;text('facebook_link');
    $table-&gt;text('youtube_link');
});</code></pre>
<pre><code class="language-bash">php artisan migrate</code></pre>
<hr>
<h2>Модели</h2>
<h3>Translate.php</h3>
<pre><code class="language-php">&lt;?php
// app/Models/Translate.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Translate extends Model
{
    protected $table = 'translates';
    protected $primaryKey = 'id';
    protected $fillable = ['ru', 'en', 'kz'];
}</code></pre>
<h3>News.php</h3>
<pre><code class="language-php">&lt;?php
// app/Models/News.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class News extends Model
{
    use HasFactory;

    protected $table = 'news';
    protected $primaryKey = 'id';
    protected $fillable = ['name', 'background_image', 'date'];

    // Связь с переводом названия
    public function getName()
    {
        return $this-&gt;hasOne(Translate::class, 'id', 'name');
    }

    // Связь с контентом новости
    public function getChild()
    {
        return $this-&gt;hasMany(NewsContent::class, 'parent_id', 'id');
    }

    // Связь с документами
    public function getDocuments()
    {
        return $this-&gt;hasOne(NewsDocument::class, 'parent_id', 'id');
    }

    // Связь со слайдером
    public function getSlider()
    {
        return $this-&gt;hasOne(NewsPageSlider::class, 'news_id', 'id');
    }
}</code></pre>
<h3>BachelorSchool.php</h3>
<pre><code class="language-php">&lt;?php
// app/Models/BachelorSchool.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class BachelorSchool extends Model
{
    use HasFactory;

    protected $table = 'bachelor_schools';
    protected $primaryKey = 'id';
    protected $fillable = ['name', 'image'];

    public function getName()
    {
        return $this-&gt;hasOne(Translate::class, 'id', 'name');
    }

    public function getSpecialties()
    {
        return $this-&gt;hasMany(BachelorSchoolSpecialty::class, 'school_id', 'id');
    }

    public function getEducators()
    {
        return $this-&gt;hasMany(BachelorSchoolEducator::class, 'school_id', 'id');
    }

    public function getPage()
    {
        return $this-&gt;hasMany(BachelorSchoolPage::class, 'school_id', 'id');
    }
}</code></pre>
<h3>Contact.php</h3>
<pre><code class="language-php">&lt;?php
// app/Models/Contact.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Contact extends Model
{
    use HasFactory;

    protected $table = 'contacts';
    protected $primaryKey = 'id';

    protected $fillable = [
        'id',
        'timestable',
        'tab_name',
        'address',
        'admissions_committee_num_1',
        'admissions_committee_num_2',
        'admissions_committee_mail',
        'rectors_reception_num',
        'office_receptionist_num',
        'tiktok_name',
        'tiktok_link',
        'instagram_name',
        'instagram_link',
        'facebook_link',
        'youtube_link'
    ];

    public function getTabName()
    {
        return $this-&gt;hasOne(Translate::class, 'id', 'tab_name');
    }
}</code></pre>
<hr>
<h2>Базовый контроллер</h2>
<pre><code class="language-php">&lt;?php
// app/Http/Controllers/Controller.php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Bus\DispatchesJobs;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;
use Illuminate\Support\Facades\Storage;

class Controller extends BaseController
{
    use AuthorizesRequests, DispatchesJobs, ValidatesRequests;

    // Стандартный JSON ответ
    protected static function response($status, $data, $message = null)
    {
        return response()-&gt;json([
            'success' =&gt; boolval($status == 200 || $status == 201 || $status == 202),
            'status'  =&gt; $status,
            'message' =&gt; $message,
            'data'    =&gt; $data,
        ], $status);
    }

    // Загрузка изображений
    protected function uploadImage($image)
    {
        $path = Storage::disk('public')-&gt;put('images', $image);
        $name = basename($path);
        return 'storage/images/' . $name;
    }

    // Загрузка документов
    protected function uploadDocument($doc)
    {
        $fileName = 'profile-'.time().'.'.$doc-&gt;getClientOriginalExtension();
        $path = $doc-&gt;storeAs('public/files', $fileName);
        return 'storage/files/' . $fileName;
    }
}</code></pre>
<hr>
<h2>API Controller (ключевые методы)</h2>
<pre><code class="language-php">&lt;?php
// app/Http/Controllers/ApiController.php

namespace App\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\HeaderNavBar;
use App\Models\Contact;
use App\Models\News;
use App\Models\MainPage;
use App\Models\BachelorSchool;
// ... другие импорты

use App\Http\Resources\NewsResource;
use App\Http\Resources\ContactResource;
use App\Http\Resources\MainPageResource;
use App\Http\Resources\BachelorSchoolResource;
// ... другие ресурсы

use Illuminate\Http\Request;
use stdClass;

class ApiController extends Controller
{
    /**
     * Навигация шапки
     */
    public function headerNavBar()
    {
        $headerNavBarData = HeaderNavBar::query()-&gt;with('getName')-&gt;get();
        return HeaderNavBarResource::collection($headerNavBarData);
    }

    /**
     * Контакты
     */
    public function contacts()
    {
        $contactsData = Contact::query()-&gt;with('getTabName')-&gt;get();
        return ContactResource::collection($contactsData)[0];
    }

    /**
     * Новости с фильтрацией
     */
    public function news(Request $request)
    {
        $correctNews = [];
        $news = News::query()-&gt;with(['getName', 'getChild'])-&gt;get();

        $year = $request-&gt;input('year');
        $month = $request-&gt;input('month');
        $day = $request-&gt;input('day');
        $sort = $request-&gt;input('sort');

        $requestDate = [$year, $month, $day];

        foreach ($news as $item) {
            $correctCount = 0;
            $dateArr = explode('-', $item-&gt;date);

            foreach ($requestDate as $key =&gt; $value) {
                if ($value) {
                    if ($dateArr[$key] == $value) {
                        $correctCount += 1;
                    }
                } else {
                    $correctCount += 1;
                }
            }

            if ($correctCount == 3) {
                $correctNews[] = $item;
            }
        }

        $sortedCorrectNews = $this-&gt;sorted($correctNews, $sort);
        return NewsResource::collection($sortedCorrectNews);
    }

    /**
     * Сортировка новостей
     */
    private function sorted($data, $type)
    {
        if ($type == 'old') {
            usort($data, [$this, 'sortByDateOldToNew']);
        } else {
            usort($data, [$this, 'sortByDateNewToOld']);
        }
        return $data;
    }

    private function sortByDateOldToNew($a, $b)
    {
        return strtotime($a-&gt;date) - strtotime($b-&gt;date);
    }

    private function sortByDateNewToOld($a, $b)
    {
        return strtotime($b-&gt;date) - strtotime($a-&gt;date);
    }

    /**
     * Главная страница
     */
    public function mainPage()
    {
        $mainPageData = MainPage::query()-&gt;with(['getTitle', 'getContent'])-&gt;get();
        $schools = BachelorSchool::query()-&gt;with(['getName'])-&gt;get();

        // Формирование структуры ответа
        foreach ($mainPageData as $key =&gt; $value) {
            switch($key) {
                case 0:
                    $banner = new MainPageResource($value);
                    break;
                case 1:
                    $educationProgram['title'] = new MainPageResource($value);
                    break;
                // ... остальные case
            }
        }

        $mainPageApi = new stdClass;
        $mainPageApi-&gt;banner = $banner;
        $mainPageApi-&gt;educationProgram = $educationProgram;
        $mainPageApi-&gt;professionalSchools = $professionalSchools;
        // ... остальные поля

        return $mainPageApi;
    }

    /**
     * О нас
     */
    public function aboutUs()
    {
        $aboutUs = AboutUsPage::query()-&gt;with(['getTitle', 'getContent'])-&gt;get();
        $metaData = AboutUniversityPagesMeta::where('page_id', 1)-&gt;first();

        foreach ($aboutUs as $key =&gt; $value) {
            switch($key) {
                case 0:
                    $banner = new AboutUsPageResource($value);
                    break;
                case 1:
                    $history = new AboutUsPageResource($value);
                    break;
                // ...
            }
        }

        $aboutUsApi = new stdClass;
        $aboutUsApi-&gt;banner = $banner;
        $aboutUsApi-&gt;history = $history;
        $aboutUsApi-&gt;historyYears = $historyYears;
        $aboutUsApi-&gt;blocks = $blocks;
        $aboutUsApi-&gt;meta = $metaData ? new MetaDataResource($metaData) : null;

        return $aboutUsApi;
    }

    /**
     * Факультеты
     */
    public function bachelorSchool()
    {
        $bachelorSchool = BachelorSchool::query()
            -&gt;with(['getName', 'getSpecialties', 'getEducators', 'getPage'])
            -&gt;get();

        return BachelorSchoolResource::collection($bachelorSchool);
    }

    /**
     * Футер навигация
     */
    public function footerNavBar(Request $request)
    {
        $lang = in_array($request-&gt;lang, ['ru', 'en', 'kz']) ? $request-&gt;lang : 'ru';
        $contactsData = $this-&gt;contacts();
        $address = explode(', ', $contactsData-&gt;address)[2];

        $contacts = [
            'id' =&gt; 6,
            'name' =&gt; $contactsData-&gt;getTabName-&gt;{$lang},
            'child' =&gt; [
                'address' =&gt; $address,
                'email' =&gt; $contactsData-&gt;admissions_committee_mail,
                'phone' =&gt; $contactsData-&gt;admissions_committee_num_2,
                'facebook' =&gt; $contactsData-&gt;facebook_link,
                'instagram' =&gt; $contactsData-&gt;instagram_link,
                'youtube' =&gt; $contactsData-&gt;youtube_link
            ]
        ];

        $navBar = $this-&gt;headerNavBar();

        $footerNavBar = new stdClass;
        $footerNavBar-&gt;navbar = $navBar;
        $footerNavBar-&gt;contacts = $contacts;

        return $footerNavBar;
    }
}</code></pre>
<hr>
<h2>API Resources</h2>
<h3>NewsResource.php</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Resources/NewsResource.php

namespace App\Http\Resources;

use App\Models\NewsDocument;
use App\Models\NewsMeta;
use Illuminate\Http\Resources\Json\JsonResource;
use stdClass;

class NewsResource extends JsonResource
{
    public function toArray($request)
    {
        $lang = in_array($request-&gt;lang, ['ru', 'en', 'kz']) ? $request-&gt;lang : 'ru';

        // Слайдер
        $slider = $this-&gt;getSlider ? $this-&gt;getSlider : null;
        if (isset($slider-&gt;images)) {
            foreach(json_decode($slider-&gt;images) as $item) {
                $sliderImages[] = url($item);
            }
        }

        // Документы
        $documents = NewsDocument::query()-&gt;where('parent_id', $this-&gt;id)-&gt;get();

        // Контент
        $blocks = PageResource::collection($this-&gt;getChild);
        $content = new stdClass;
        $content-&gt;title = $this-&gt;getName ? $this-&gt;getName-&gt;{$lang} : '';
        $content-&gt;date = $this-&gt;date;
        $content-&gt;slider = isset($sliderImages) ? $sliderImages : null;
        $content-&gt;blocks = $blocks;
        $content-&gt;document = DocumentResource::collection($documents);

        return [
            'id' =&gt; $this-&gt;id,
            'name' =&gt; $this-&gt;getName ? $this-&gt;getName-&gt;{$lang} : '',
            'date' =&gt; $this-&gt;date,
            'image' =&gt; $this-&gt;background_image ? url($this-&gt;background_image) : '',
            'meta' =&gt; NewsMeta::where('page_id', $this-&gt;id)-&gt;first(),
            'child' =&gt; $this-&gt;getChild ? $content : [],
        ];
    }
}</code></pre>
<hr>
<h2>API Routes</h2>
<pre><code class="language-php">&lt;?php
// routes/api.php

use App\Http\Controllers\ApiController;
use Illuminate\Support\Facades\Route;

// Навигация
Route::get('/headerNavBar', [ApiController::class, 'headerNavBar']);
Route::get('/footerNavBar', [ApiController::class, 'footerNavBar']);

// Контакты
Route::get('/contacts', [ApiController::class, 'contacts']);

// Новости
Route::get('/newsPage', [ApiController::class, 'newsPage']);
Route::get('/news', [ApiController::class, 'news']);

// Главная
Route::get('/mainPage', [ApiController::class, 'mainPage']);

// О нас
Route::get('/aboutUs', [ApiController::class, 'aboutUs']);
Route::get('/authority', [ApiController::class, 'authority']);
Route::get('/accreditation', [ApiController::class, 'accreditation']);
Route::get('/partnersPage', [ApiController::class, 'partnersPage']);
Route::get('/careerPage', [ApiController::class, 'careerPage']);
Route::get('/rectorsBlogPage', [ApiController::class, 'rectorsBlogPage']);
Route::get('/academicCouncilPage', [ApiController::class, 'academicCouncilPage']);

// Наука
Route::get('/scienceInnovationPage', [ApiController::class, 'scienceInnovationPage']);
Route::get('/studentScience', [ApiController::class, 'studentScience']);
Route::get('/scientificPublicationPage', [ApiController::class, 'scientificPublicationPage']);

// Поступление
Route::get('/admissionsCommitteePage', [ApiController::class, 'admissionsCommitteePage']);
Route::get('/masterPage', [ApiController::class, 'masterPage']);
Route::get('/internationalStudentsPage', [ApiController::class, 'internationalStudentsPage']);

// Студентам
Route::get('/academicPolicyPage', [ApiController::class, 'academicPolicyPage']);
Route::get('/libraryPage', [ApiController::class, 'libraryPage']);
Route::get('/studentClubPage', [ApiController::class, 'studentClubPage']);
Route::get('/studentHousePage', [ApiController::class, 'studentHousePage']);

// Школы
Route::get('/bachelorSchool', [ApiController::class, 'bachelorSchool']);

// SEO
Route::get('/metaData', [ApiController::class, 'metaData']);

// Инфраструктура
Route::get('/infrastructurePage', [ApiController::class, 'infrastructurePage']);

// Летняя школа
Route::get('/summerSchoolPage', [ApiController::class, 'summerSchoolPage']);</code></pre>
<hr>
<h2>CORS Configuration</h2>
<pre><code class="language-php">&lt;?php
// config/cors.php

return [
    'paths' =&gt; ['api/*'],
    'allowed_methods' =&gt; ['*'],
    'allowed_origins' =&gt; ['*'],  // На production указать конкретный домен
    'allowed_origins_patterns' =&gt; [],
    'allowed_headers' =&gt; ['*'],
    'exposed_headers' =&gt; [],
    'max_age' =&gt; 0,
    'supports_credentials' =&gt; false,
];</code></pre>
<hr>
<h2>Запуск</h2>
<pre><code class="language-bash"># Генерация ключа
php artisan key:generate

# Миграции
php artisan migrate

# Линк storage
php artisan storage:link

# Запуск сервера
php artisan serve
# API доступно на http://localhost:8000/api</code></pre>
<hr>
<h2>Проверка API</h2>
<pre><code class="language-bash"># Главная страница
curl http://localhost:8000/api/mainPage

# Новости
curl http://localhost:8000/api/news

# Новости 2024 года
curl "http://localhost:8000/api/news?year=2024"

# Контакты
curl http://localhost:8000/api/contacts</code></pre>
<hr>
<h2>Чек-лист главы</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Создал проект Laravel</li>
<li class="checklist"><input type="checkbox" disabled> Настроил .env</li>
<li class="checklist"><input type="checkbox" disabled> Создал миграции (translates, news, contacts)</li>
<li class="checklist"><input type="checkbox" disabled> Создал модели с relationships</li>
<li class="checklist"><input type="checkbox" disabled> Написал ApiController</li>
<li class="checklist"><input type="checkbox" disabled> Создал API Resources</li>
<li class="checklist"><input type="checkbox" disabled> Настроил routes/api.php</li>
<li class="checklist"><input type="checkbox" disabled> Настроил CORS</li>
<li class="checklist"><input type="checkbox" disabled> Проверил API через curl</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../03-Frontend-Nuxt/README.md">Frontend Nuxt →</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter1')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter3')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 03: Frontend Nuxt -->
        <section class="chapter" id="chapter3">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 03</span>
                <h1>Frontend Nuxt</h1>
            </div>

            <div class="content-section">
                <h2>Создание проекта</h2>
<pre><code class="language-bash">npx nuxi@latest init app-frontend
cd app-frontend</code></pre>
<h3>Зависимости (package.json)</h3>
<pre><code class="language-json">{
  "name": "app-frontend",
  "private": true,
  "type": "module",
  "scripts": {
    "start": "nuxt start --port 3008",
    "build": "nuxt build",
    "dev": "nuxt dev --host",
    "generate": "nuxt generate",
    "preview": "nuxt preview"
  },
  "dependencies": {
    "@formkit/auto-animate": "^0.8.1",
    "@nuxtjs/i18n": "^8.3.1",
    "@nuxtjs/seo": "^2.0.0-rc.11",
    "@pinia/nuxt": "^0.5.1",
    "@vueuse/core": "^10.9.0",
    "@vueuse/motion": "^2.1.0",
    "axios": "^1.6.8",
    "maska": "^2.1.11",
    "nuxt": "^3.10.3",
    "nuxt-swiper": "^1.2.2",
    "pinia": "^2.1.7",
    "vue": "^3.4.19",
    "vue-awesome-paginate": "^1.1.46"
  },
  "devDependencies": {
    "autoprefixer": "^10.4.18",
    "postcss": "^8.4.35",
    "tailwind-scrollbar": "^3.1.0",
    "tailwindcss": "^3.4.1"
  }
}</code></pre>
<pre><code class="language-bash">npm install</code></pre>
<hr>
<h2>nuxt.config.ts</h2>
<pre><code class="language-typescript">// nuxt.config.ts

export default defineNuxtConfig({
  devtools: { enabled: true },

  app: {
    head: {
      title: 'Fullstack Demo',
      link: [
        { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' },
      ],
    },
  },

  css: ['~/assets/css/main.css'],

  postcss: {
    plugins: {
      tailwindcss: {},
      autoprefixer: {},
    },
  },

  modules: [
    '@vueuse/motion/nuxt',
    'nuxt-swiper',
    '@formkit/auto-animate',
    '@nuxtjs/i18n',
    '@nuxtjs/seo',
    '@pinia/nuxt',
  ],

  i18n: {
    vueI18n: './i18n.config.ts',
    lazy: true,
    langDir: 'locales',
    strategy: 'prefix_except_default',
    locales: [
      { code: 'kz', name: 'KZ', file: 'kz.json' },
      { code: 'en', name: 'EN', file: 'en.json' },
      { code: 'ru', name: 'RU', file: 'ru.json' }
    ],
    defaultLocale: 'ru',
  },

  plugins: [
    { src: '~/plugins/vue-content-loader.js', mode: 'client' }
  ],
});</code></pre>
<hr>
<h2>tailwind.config.js</h2>
<pre><code class="language-javascript">// tailwind.config.js

module.exports = {
  content: [
    './components/**/*.{js,vue,ts}',
    './layouts/**/*.vue',
    './pages/**/*.vue',
    './plugins/**/*.{js,ts}',
    './app.vue',
    './error.vue',
  ],
  theme: {
    extend: {
      colors: {
        violet: '#4E4481',
        white: '#fff',
        green: '#AAA0FC',
        grey: '#F1F1F1',
      },
      screens: {
        xs: '450px',
        ms: '500px',
        sm: '640px',
        md: '768px',
        lg: '992px',
        lg2: '1150px',
        '2lg': '1040px',
        xl: '1280px',
        '2xl': '1470px',
      },
      borderRadius: {
        15: '15px',
      },
      lineHeight: {
        140: '140%',
      },
    },
  },
  plugins: [
    require('tailwind-scrollbar')({ preferredStrategy: 'pseudoelements' }),
  ],
}</code></pre>
<hr>
<h2>Локализация (i18n)</h2>
<h3>i18n.config.ts</h3>
<pre><code class="language-typescript">// i18n.config.ts

export default defineI18nConfig(() =&gt; ({
  fallbackLocale: 'ru'
}))</code></pre>
<h3>locales/ru.json</h3>
<pre><code class="language-json">{
  "welcome": "Новости",
  "contacts": "Контакты",
  "btnNewsText": "Вернуться к новостям",
  "formTitle": "Оставь заявку",
  "contactsTextAdress": "Адрес:",
  "contactsTextSelectionCommittee": "Приемная комиссия:",
  "contactsTextRectorsReception": "Приемная ректора:",
  "contactsTextOffice": "Офис регистратор:",
  "contactAdressInfo": "г. Москва, ул. Примерная, д. 1",
  "contactPhoneText": "Телефон:",
  "faqTitleFirst": "Какие программы обучения предлагает университет?",
  "faqAnswer": "Учебный процесс включает лекции, практические занятия...",
  "professionAboutManagement": "Председатель Правления-Ректор",
  "bachelorSchoolsTitle": "Профессиональные школы"
}</code></pre>
<h3>locales/en.json</h3>
<pre><code class="language-json">{
  "welcome": "News",
  "contacts": "Contacts",
  "btnNewsText": "Back to news",
  "formTitle": "Leave a request",
  "contactsTextAdress": "Address:",
  "contactsTextSelectionCommittee": "Selection committee:",
  "contactsTextRectorsReception": "Rector's reception:",
  "contactsTextOffice": "Office registrar:",
  "contactAdressInfo": "Moscow, Example Street, 1",
  "contactPhoneText": "Phone:",
  "bachelorSchoolsTitle": "Vocational schools"
}</code></pre>
<h3>locales/kz.json</h3>
<pre><code class="language-json">{
  "welcome": "Жаналык",
  "contacts": "Контактілер",
  "btnNewsText": "Жаңалықтарға оралу",
  "formTitle": "Өтініш қалдырыңыз",
  "contactsTextAdress": "Мекенжай:",
  "contactsTextSelectionCommittee": "Қабылдау комиссиясы:",
  "contactsTextRectorsReception": "Ректордың қабылдауы:",
  "bachelorSchoolsTitle": "Кәсіптік оқу орындары"
}</code></pre>
<hr>
<h2>Stores (Pinia)</h2>
<h3>stores/lang.ts</h3>
<pre><code class="language-typescript">// stores/lang.ts

export const useLangStore = defineStore('lang', () =&gt; {
  const activeLang = ref&lt;any&gt;({
    id: 1,
    name: 'RU',
    value: 'RU'
  })

  return { activeLang }
})</code></pre>
<h3>stores/seo.ts</h3>
<pre><code class="language-typescript">// stores/seo.ts

export const useSeoStore = defineStore('seo', () =&gt; {
  const { data: seoData, error: seoDataError } = useFetch&lt;SeoProps&gt;(
    `https://api.example.com/api/metaData`
  )

  if (seoDataError.value) {
    console.error('Ошибка при загрузке данных:', seoDataError.value.message)
  }

  return { seoData, seoDataError }
})</code></pre>
<hr>
<h2>Layout</h2>
<h3>layouts/default.vue</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { locale } = useI18n()

const headerNavBarData = ref&lt;any&gt;(null)
const headerNavBarError = ref&lt;any&gt;(null)
const footerNavBarData = ref&lt;any&gt;(null)
const footerNavBarError = ref&lt;any&gt;(null)
const footerNavBarLoader = ref&lt;boolean&gt;(false)

const fetchData = async () =&gt; {
  const { data, error } = await useFetch&lt;{
    data: any
  }&gt;(`https://api.example.com/api/headerNavBar?lang=${locale.value}`)

  headerNavBarData.value = data.value?.data
  headerNavBarError.value = error
}

const fetchFooterData = async () =&gt; {
  const { data, error } = await useFetch&lt;{
    data: any
  }&gt;(`https://api.example.com/api/footerNavBar?lang=${locale.value}`)

  footerNavBarData.value = data.value
  footerNavBarError.value = error
}

await fetchData()
await fetchFooterData()

// Следим за изменением языка
watch(locale, async () =&gt; {
  await fetchData()
  await fetchFooterData()
})
&lt;/script&gt;

&lt;template&gt;
  &lt;main&gt;
    &lt;MainHeader :headerNavBarData="headerNavBarData" /&gt;
    &lt;div&gt;
      &lt;slot /&gt;
    &lt;/div&gt;
    &lt;MainFooter
      :footerNavBarLoader="footerNavBarLoader"
      :footerNavBarData="footerNavBarData"
    /&gt;
  &lt;/main&gt;
&lt;/template&gt;</code></pre>
<hr>
<h2>Страницы</h2>
<h3>pages/index.vue (Главная)</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
import { ibg } from '~/utils/lib/ibg'
const { locale } = useI18n()

// Загрузка данных главной страницы
const { data: mainPageData, error: mainPageError } = useFetch&lt;MainPageData&gt;(
  `https://api.example.com/api/mainPage?lang=${locale.value}`
)

if (mainPageError.value) {
  console.error('Ошибка при загрузке данных:', mainPageError.value.message)
}

// Контакты
const { data: contactsData, error: contactsError } = useFetch&lt;ContactResponse&gt;(
  `https://api.example.com/api/contacts?lang=${locale.value}`
)

// Новости
const { data: newsData, error: newsDataError } = useFetch&lt;NewsDataResponse&gt;(
  `https://api.example.com/api/news?lang=${locale.value}`
)

onMounted(() =&gt; {
  ibg()
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div v-if="mainPageData"&gt;
    &lt;!-- Баннер --&gt;
    &lt;MainBg :banner="mainPageData.banner" /&gt;

    &lt;!-- Программы обучения --&gt;
    &lt;MainTraning
      :title="mainPageData.educationProgram.title.title"
      :items="mainPageData.educationProgram.items"
    /&gt;

    &lt;!-- Школы --&gt;
    &lt;MainSchools
      :title="mainPageData.professionalSchools.title.title"
      :item="mainPageData.professionalSchools.item"
    /&gt;

    &lt;!-- Преимущества --&gt;
    &lt;MainAdvantages
      :title="mainPageData.advantages.title.title"
      :items="mainPageData.advantages.items"
    /&gt;

    &lt;!-- Цифры --&gt;
    &lt;MainNumbers
      :title="mainPageData.inNumbers.title.title"
      :items="mainPageData.inNumbers.items"
    /&gt;

    &lt;!-- Новости --&gt;
    &lt;MainNews
      v-if="newsData"
      :title="mainPageData.news.title"
      :newsData="newsData"
    /&gt;

    &lt;!-- Соцсети --&gt;
    &lt;MainSocials
      :instagram="mainPageData.instagram"
      :youtube="mainPageData.youtube"
    /&gt;

    &lt;!-- Форма заявки --&gt;
    &lt;MainForm
      :btnText="mainPageData.application.button.content"
      :image="mainPageData.application.title.image"
      :content="mainPageData.application.title.content"
      :subContent="mainPageData.application.description.content"
    /&gt;

    &lt;!-- FAQ --&gt;
    &lt;MainFaq
      :faqTitle="mainPageData.faqTitle"
      :faqQuestions="mainPageData.faqQuestions"
    /&gt;

    &lt;!-- Контакты --&gt;
    &lt;MainContacts v-if="contactsData" :contactsData="contactsData" /&gt;
  &lt;/div&gt;

  &lt;!-- Загрузка или ошибка --&gt;
  &lt;div v-else&gt;
    &lt;div
      v-if="mainPageError"
      class="xl:h-[100vh] flex flex-col items-center justify-center"
    &gt;
      &lt;img src="/img/error.svg" alt="" /&gt;
      &lt;p class="font-semibold text-[24px]"&gt;Страница не найдена&lt;/p&gt;
    &lt;/div&gt;
    &lt;div v-else&gt;
      &lt;UILoader /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h3>pages/news/index.vue (Список новостей)</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
import { ibg } from '~/utils/lib/ibg'

const { locale } = useI18n()

// Фильтры
const selectedValues = reactive({
  sort: '' as string | number,
  year: null as string | number | null,
  month: null as string | number | null,
  day: null as string | number | null,
})

const newsDataFetch = ref&lt;any&gt;(null)
const loading = ref(false)

// Загрузка новостей с фильтрами
const fetchData = async () =&gt; {
  loading.value = true

  let apiUrl = `https://api.example.com/api/news?lang=${locale.value}`

  if (selectedValues.year) apiUrl += `&amp;year=${selectedValues.year}`
  if (selectedValues.month) apiUrl += `&amp;month=${selectedValues.month}`
  if (selectedValues.day) apiUrl += `&amp;day=${selectedValues.day}`
  if (selectedValues.sort) apiUrl += `&amp;sort=${selectedValues.sort}`

  const { data, error } = await useFetch&lt;{ data: any }&gt;(apiUrl)

  newsDataFetch.value = data.value?.data
  loading.value = false
}

fetchData()

// Данные для фильтров
const exampleDate = {
  data: [
    {
      title: 'Новости',
      filters: [
        {
          id: 176,
          name: 'Упорядочить',
          child: [
            { id: 1, name: 'Сначала новые', value: 'new' },
            { id: 2, name: 'Сначала старые', value: 'old' },
          ],
        },
        {
          id: 177,
          name: 'Год',
          child: [
            { id: 1, name: 2024, value: 2024 },
            { id: 2, name: 2023, value: 2023 },
            { id: 3, name: 2022, value: 2022 },
          ],
        },
        {
          id: 178,
          name: 'Месяц',
          child: [
            { id: 1, name: 'Январь', value: 1 },
            { id: 2, name: 'Февраль', value: 2 },
            // ... остальные месяцы
            { id: 12, name: 'Декабрь', value: 12 },
          ],
        },
      ],
    },
  ],
}

// Обработка выбора фильтра
const handleChange = (type: string, value: string | number) =&gt; {
  if (type === 'год') selectedValues.year = value
  else if (type === 'месяц') selectedValues.month = value
  else if (type === 'число') selectedValues.day = value
  else if (type === 'упорядочить') selectedValues.sort = value

  fetchData()
}

// Сброс фильтров
const resetFilters = () =&gt; {
  selectedValues.sort = ''
  selectedValues.year = null
  selectedValues.month = null
  selectedValues.day = null
  fetchData()
}

// Отслеживание изменений
watch(
  () =&gt; selectedValues,
  () =&gt; fetchData(),
  { deep: true }
)

onMounted(() =&gt; {
  ibg()
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="paddingSection"&gt;
    &lt;div class="container"&gt;
      &lt;h2 class="title"&gt;Новости&lt;/h2&gt;

      &lt;!-- Фильтры --&gt;
      &lt;div class="filters-container flex items-center justify-center mb-[30px]"&gt;
        &lt;button
          class="py-[16px] px-[25px] border rounded-15 border-violet"
          @click="resetFilters"
        &gt;
          &lt;span class="font-semibold text-violet"&gt;Сбросить&lt;/span&gt;
        &lt;/button&gt;

        &lt;UIBtnFilter
          v-for="item in exampleDate.data[0].filters"
          :key="item.id"
        &gt;
          {{ item.name }}
          &lt;ul class="dropdown"&gt;
            &lt;li
              v-for="elem in item.child"
              :key="elem.id"
              @click="handleChange(item.name.toLowerCase(), elem.value)"
            &gt;
              {{ elem.name }}
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/UIBtnFilter&gt;
      &lt;/div&gt;

      &lt;!-- Загрузка --&gt;
      &lt;div v-if="loading" class="flex w-full items-center justify-center py-[50px]"&gt;
        &lt;img class="loading-animation" src="/img/loading.svg" alt="" /&gt;
      &lt;/div&gt;

      &lt;!-- Список новостей --&gt;
      &lt;div
        v-else-if="newsDataFetch &amp;&amp; newsDataFetch.length &gt; 0"
        class="flex flex-wrap gap-[50px]"
      &gt;
        &lt;MainNewsItem v-for="item in newsDataFetch" :key="item.id" :item="item" /&gt;
      &lt;/div&gt;

      &lt;!-- Пусто --&gt;
      &lt;div v-else class="flex w-full items-center justify-center py-[50px]"&gt;
        &lt;img src="/img/news-empty.svg" alt="" /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.loading-animation {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
&lt;/style&gt;</code></pre>
<hr>
<h2>Утилиты</h2>
<h3>utils/lib/ibg.ts</h3>
<pre><code class="language-typescript">// utils/lib/ibg.ts

export const ibg = () =&gt; {
  const ibgElements = document.querySelectorAll&lt;HTMLElement&gt;('.ibg')
  ibgElements.forEach((ibgElement) =&gt; {
    const img = ibgElement.querySelector('img')
    if (img) {
      ibgElement.style.backgroundImage = `url(${img.getAttribute('src')})`
    }
  })
}</code></pre>
<h3>utils/lib/fadeIn.ts</h3>
<pre><code class="language-typescript">// utils/lib/fadeIn.ts

const fadeIn = (direction: string, delay: number) =&gt; {
  return {
    hidden: {
      y: direction === 'up' ? 80 : direction === 'down' ? -80 : 0,
      opacity: 0,
      x: direction === 'left' ? 80 : direction === 'right' ? -80 : 0,
    },
    show: {
      y: 0,
      x: 0,
      opacity: 1,
      transition: {
        type: 'tween',
        delay: delay,
        duration: 1.2,
        ease: [0.25, 0.25, 0.25, 0.75],
      },
    },
  }
}

export default fadeIn</code></pre>
<hr>
<h2>CSS (assets/css/main.css)</h2>
<pre><code class="language-css">/* assets/css/main.css */

@tailwind base;
@tailwind components;
@tailwind utilities;

.container {
  @apply max-w-[1470px] mx-auto px-[15px];
}

.title {
  @apply text-[32px] md:text-[48px] font-bold text-violet mb-[30px] text-center;
}

.paddingSection {
  @apply py-[50px] md:py-[100px];
}

.ibg {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.ibg img {
  width: 0;
  height: 0;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  visibility: hidden;
}</code></pre>
<hr>
<h2>Запуск</h2>
<pre><code class="language-bash"># Разработка
npm run dev

# Сборка для production
npm run build

# Preview production build
npm run preview</code></pre>
<hr>
<h2>Чек-лист главы</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Создал проект Nuxt 3</li>
<li class="checklist"><input type="checkbox" disabled> Настроил nuxt.config.ts</li>
<li class="checklist"><input type="checkbox" disabled> Настроил Tailwind CSS</li>
<li class="checklist"><input type="checkbox" disabled> Создал файлы локализации (ru, en, kz)</li>
<li class="checklist"><input type="checkbox" disabled> Создал Pinia stores</li>
<li class="checklist"><input type="checkbox" disabled> Создал layout (default.vue)</li>
<li class="checklist"><input type="checkbox" disabled> Создал страницы (index, news)</li>
<li class="checklist"><input type="checkbox" disabled> Создал утилиты (ibg, fadeIn)</li>
<li class="checklist"><input type="checkbox" disabled> Проверил работу приложения</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../04-Интеграция/README.md">Интеграция →</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter2')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter4')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 04: Интеграция -->
        <section class="chapter" id="chapter4">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 04</span>
                <h1>Интеграция</h1>
            </div>

            <div class="content-section">
                <h2>Архитектура взаимодействия</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      СХЕМА ИНТЕГРАЦИИ                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   NUXT (Frontend)                     LARAVEL (Backend)                 │
│   ───────────────                     ─────────────────                 │
│                                                                         │
│   ┌─────────────┐     HTTP GET        ┌─────────────┐                   │
│   │ pages/      │ ──────────────────► │ routes/     │                   │
│   │ index.vue   │                     │ api.php     │                   │
│   └─────────────┘                     └──────┬──────┘                   │
│         │                                    │                          │
│         │                                    ▼                          │
│   ┌─────▼─────┐                       ┌─────────────┐                   │
│   │ useFetch  │                       │ ApiControl- │                   │
│   │ (SSR)     │                       │ ler.php     │                   │
│   └───────────┘                       └──────┬──────┘                   │
│         │                                    │                          │
│         │     ◄──── JSON Response ───────────┤                          │
│         │                                    │                          │
│   ┌─────▼─────┐                       ┌──────▼──────┐                   │
│   │ Component │                       │ Resources/  │                   │
│   │ Template  │                       │ *Resource   │                   │
│   └───────────┘                       └─────────────┘                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Настройка API URL</h2>
<h3>На стороне Frontend</h3>
<pre><code class="language-typescript">// nuxt.config.ts

export default defineNuxtConfig({
  runtimeConfig: {
    public: {
      apiBase: process.env.API_BASE || 'https://api.example.com/api'
    }
  }
})</code></pre>
<h3>Использование в компонентах</h3>
<pre><code class="language-xml">&lt;script setup&gt;
const config = useRuntimeConfig()
const apiBase = config.public.apiBase

const { data } = await useFetch(`${apiBase}/mainPage`)
&lt;/script&gt;</code></pre>
<h3>Переменные окружения</h3>
<pre><code class="language-ini"># .env (Frontend)
API_BASE=http://localhost:8000/api

# .env.production
API_BASE=https://api.example.com/api</code></pre>
<hr>
<h2>Работа с useFetch</h2>
<h3>Базовый запрос</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { locale } = useI18n()

const { data, error, pending, refresh } = await useFetch(
  `https://api.example.com/api/mainPage?lang=${locale.value}`
)

// data - полученные данные
// error - ошибка (если есть)
// pending - загрузка в процессе
// refresh - функция для повторного запроса
&lt;/script&gt;</code></pre>
<h3>С типизацией</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
interface MainPageData {
  banner: {
    title: string
    content: string
    image: string
  }
  educationProgram: {
    title: { title: string }
    items: Array&lt;{ title: string; content: string; image: string }&gt;
  }
  // ... остальные поля
}

const { data: mainPageData, error } = await useFetch&lt;MainPageData&gt;(
  `https://api.example.com/api/mainPage?lang=${locale.value}`
)

if (error.value) {
  console.error('Ошибка:', error.value.message)
}
&lt;/script&gt;</code></pre>
<h3>Динамический запрос с параметрами</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { locale } = useI18n()

const selectedValues = reactive({
  year: null as number | null,
  month: null as number | null,
  sort: 'new' as string
})

const newsDataFetch = ref&lt;any&gt;(null)

const fetchData = async () =&gt; {
  let apiUrl = `https://api.example.com/api/news?lang=${locale.value}`

  if (selectedValues.year) apiUrl += `&amp;year=${selectedValues.year}`
  if (selectedValues.month) apiUrl += `&amp;month=${selectedValues.month}`
  if (selectedValues.sort) apiUrl += `&amp;sort=${selectedValues.sort}`

  const { data } = await useFetch&lt;{ data: any }&gt;(apiUrl)
  newsDataFetch.value = data.value?.data
}

// Вызов при монтировании
fetchData()

// Отслеживание изменений фильтров
watch(selectedValues, () =&gt; {
  fetchData()
}, { deep: true })
&lt;/script&gt;</code></pre>
<hr>
<h2>Реактивность при смене языка</h2>
<h3>Layout с watch на locale</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { locale } = useI18n()

const headerNavBarData = ref&lt;any&gt;(null)
const footerNavBarData = ref&lt;any&gt;(null)

const fetchData = async () =&gt; {
  const { data } = await useFetch(
    `https://api.example.com/api/headerNavBar?lang=${locale.value}`
  )
  headerNavBarData.value = data.value?.data
}

const fetchFooterData = async () =&gt; {
  const { data } = await useFetch(
    `https://api.example.com/api/footerNavBar?lang=${locale.value}`
  )
  footerNavBarData.value = data.value
}

// Первоначальная загрузка
await fetchData()
await fetchFooterData()

// Перезагрузка при смене языка
watch(locale, async () =&gt; {
  await fetchData()
  await fetchFooterData()
})
&lt;/script&gt;</code></pre>
<hr>
<h2>CORS на Backend</h2>
<pre><code class="language-php">&lt;?php
// config/cors.php

return [
    // Пути, для которых включен CORS
    'paths' =&gt; ['api/*'],

    // Разрешённые методы
    'allowed_methods' =&gt; ['*'],

    // Разрешённые источники
    // Development: все
    'allowed_origins' =&gt; ['*'],

    // Production: только ваш домен
    // 'allowed_origins' =&gt; ['https://example.com'],

    'allowed_origins_patterns' =&gt; [],
    'allowed_headers' =&gt; ['*'],
    'exposed_headers' =&gt; [],
    'max_age' =&gt; 0,
    'supports_credentials' =&gt; false,
];</code></pre>
<hr>
<h2>Обработка ошибок</h2>
<h3>На Frontend</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { data, error, pending } = await useFetch('/api/mainPage')

// Показываем ошибку пользователю
if (error.value) {
  console.error('API Error:', error.value.message)
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div v-if="pending"&gt;
    &lt;UILoader /&gt;
  &lt;/div&gt;

  &lt;div v-else-if="error"&gt;
    &lt;div class="error-page"&gt;
      &lt;img src="/img/error.svg" alt="Error" /&gt;
      &lt;p&gt;Произошла ошибка при загрузке данных&lt;/p&gt;
      &lt;button @click="refresh()"&gt;Попробовать снова&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div v-else&gt;
    &lt;!-- Основной контент --&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h3>На Backend</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Controllers/Controller.php

protected static function response($status, $data, $message = null)
{
    return response()-&gt;json([
        'success' =&gt; boolval($status == 200 || $status == 201 || $status == 202),
        'status'  =&gt; $status,
        'message' =&gt; $message,
        'data'    =&gt; $data,
    ], $status);
}

// Использование
public function news(Request $request)
{
    try {
        $news = News::query()-&gt;with(['getName', 'getChild'])-&gt;get();
        return NewsResource::collection($news);
    } catch (\Exception $e) {
        return self::response(500, null, 'Ошибка при получении новостей');
    }
}</code></pre>
<hr>
<h2>Мультиязычность: Frontend + Backend</h2>
<h3>Запрос с параметром lang</h3>
<pre><code class="language-typescript">// Frontend
const { locale } = useI18n()

const { data } = await useFetch(
  `https://api.example.com/api/news?lang=${locale.value}`
)</code></pre>
<h3>Обработка на Backend (Resource)</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Resources/NewsResource.php

public function toArray($request)
{
    // Получаем язык из query параметра, по умолчанию ru
    $lang = in_array($request-&gt;lang, ['ru', 'en', 'kz']) ? $request-&gt;lang : 'ru';

    return [
        'id' =&gt; $this-&gt;id,
        // Берём перевод на нужном языке
        'name' =&gt; $this-&gt;getName ? $this-&gt;getName-&gt;{$lang} : '',
        'date' =&gt; $this-&gt;date,
        'image' =&gt; $this-&gt;background_image ? url($this-&gt;background_image) : '',
    ];
}</code></pre>
<hr>
<h2>Структура данных API</h2>
<h3>Пример ответа /api/mainPage</h3>
<pre><code class="language-json">{
  "banner": {
    "title": "Fullstack Demo",
    "content": "Качественное образование для вашего будущего",
    "image": "https://api.example.com/storage/images/banner.jpg"
  },
  "educationProgram": {
    "title": {
      "title": "Программы обучения"
    },
    "items": [
      {
        "title": "Бакалавриат",
        "content": "4 года обучения",
        "image": "https://api.example.com/storage/images/bachelor.jpg"
      },
      {
        "title": "Магистратура",
        "content": "2 года обучения",
        "image": "https://api.example.com/storage/images/master.jpg"
      }
    ]
  },
  "professionalSchools": {
    "title": {
      "title": "Профессиональные школы"
    },
    "item": [
      {
        "id": 1,
        "name": "Школа IT",
        "image": "https://api.example.com/storage/images/it.jpg"
      }
    ]
  }
}</code></pre>
<hr>
<h2>Типы TypeScript</h2>
<h3>types/mainPage.ts</h3>
<pre><code class="language-typescript">// utils/types/mainPage.ts

export interface MainPageData {
  banner: BannerData
  educationProgram: EducationProgram
  professionalSchools: ProfessionalSchools
  advantages: Advantages
  inNumbers: InNumbers
  news: NewsSection
  instagram: SocialSection
  youtube: SocialSection
  application: ApplicationSection
  faqTitle: TitleData
  faqQuestions: FaqQuestion[]
}

export interface BannerData {
  title: string
  content: string
  image: string
}

export interface EducationProgram {
  title: TitleData
  items: EducationProgramItem[]
}

export interface EducationProgramItem {
  title: string
  content: string
  image: string
}

export interface TitleData {
  title: string
  content?: string
  image?: string
}

// ... остальные типы</code></pre>
<hr>
<h2>Чек-лист главы</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Понимаю архитектуру взаимодействия</li>
<li class="checklist"><input type="checkbox" disabled> Настроил API URL через runtimeConfig</li>
<li class="checklist"><input type="checkbox" disabled> Умею использовать useFetch</li>
<li class="checklist"><input type="checkbox" disabled> Понимаю работу с CORS</li>
<li class="checklist"><input type="checkbox" disabled> Умею обрабатывать ошибки</li>
<li class="checklist"><input type="checkbox" disabled> Понимаю мультиязычность в связке</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../05-Деплой/README.md">Деплой →</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter3')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter5')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 05: Деплой -->
        <section class="chapter" id="chapter5">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 05</span>
                <h1>Деплой</h1>
            </div>

            <div class="content-section">
                <h2>Архитектура Production окружения</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      PRODUCTION АРХИТЕКТУРА                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                           ИНТЕРНЕТ                                      │
│                              │                                          │
│                              ▼                                          │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │                         NGINX                                    │  │
│   │   • Reverse Proxy                                                │  │
│   │   • SSL Termination (Let's Encrypt)                              │  │
│   │   • Static Files                                                 │  │
│   │   • Load Balancing (опционально)                                 │  │
│   └────────────────────────┬──────────────────┬──────────────────────┘  │
│                            │                  │                         │
│              ┌─────────────┘                  └────────────┐            │
│              │                                             │            │
│              ▼                                             ▼            │
│   ┌─────────────────────┐                    ┌─────────────────────┐    │
│   │   PM2               │                    │   PHP-FPM           │    │
│   │   (Node.js)         │                    │   (Laravel)         │    │
│   │                     │                    │                     │    │
│   │   example.com:3000   │                    │   api.example.com  │    │
│   │   Nuxt SSR          │                    │   Laravel API       │    │
│   └─────────────────────┘                    └──────────┬──────────┘    │
│                                                         │               │
│                                              ┌──────────▼──────────┐    │
│                                              │      MySQL          │    │
│                                              │      Database       │    │
│                                              └─────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Требования к серверу</h2>
<div class="table-wrapper"><table>
<thead><tr><th>Компонент</th><th>Минимум</th><th>Рекомендуется</th></tr></thead>
<tbody>
<tr><td>CPU</td><td>1 core</td><td>2+ cores</td></tr>
<tr><td>RAM</td><td>2 GB</td><td>4+ GB</td></tr>
<tr><td>Disk</td><td>20 GB SSD</td><td>40+ GB SSD</td></tr>
<tr><td>OS</td><td>Ubuntu 20.04</td><td>Ubuntu 22.04</td></tr>
</tbody></table></div>
<hr>
<h2>Шаг 1: Подготовка сервера</h2>
<h3>1.1 Подключение к серверу</h3>
<pre><code class="language-bash">ssh root@your_server_ip</code></pre>
<h3>1.2 Обновление системы</h3>
<pre><code class="language-bash">apt update &amp;&amp; apt upgrade -y</code></pre>
<h3>1.3 Создание пользователя</h3>
<pre><code class="language-bash"># Создаём пользователя
adduser deploy

# Добавляем в sudo группу
usermod -aG sudo deploy

# Переключаемся на пользователя
su - deploy</code></pre>
<h3>1.4 Настройка SSH ключей</h3>
<pre><code class="language-bash"># На локальной машине
ssh-keygen -t ed25519 -C "your_email@example.com"

# Копируем ключ на сервер
ssh-copy-id deploy@your_server_ip

# Теперь можно входить без пароля
ssh deploy@your_server_ip</code></pre>
<h3>1.5 Отключение входа по паролю (опционально)</h3>
<pre><code class="language-bash">sudo nano /etc/ssh/sshd_config

# Изменить:
PasswordAuthentication no

sudo systemctl restart sshd</code></pre>
<hr>
<h2>Шаг 2: Установка зависимостей</h2>
<h3>2.1 PHP 8.1</h3>
<pre><code class="language-bash"># Добавляем репозиторий
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update

# Устанавливаем PHP и расширения
sudo apt install -y php8.1 php8.1-fpm php8.1-cli php8.1-mysql php8.1-xml \
    php8.1-curl php8.1-mbstring php8.1-zip php8.1-gd php8.1-intl \
    php8.1-bcmath php8.1-redis

# Проверяем
php -v</code></pre>
<h3>2.2 Composer</h3>
<pre><code class="language-bash">curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer
composer --version</code></pre>
<h3>2.3 Node.js 18</h3>
<pre><code class="language-bash"># Используем NodeSource
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Проверяем
node -v
npm -v</code></pre>
<h3>2.4 PM2</h3>
<pre><code class="language-bash">sudo npm install -g pm2
pm2 --version</code></pre>
<h3>2.5 MySQL 8</h3>
<pre><code class="language-bash">sudo apt install -y mysql-server

# Безопасная настройка
sudo mysql_secure_installation

# Создаём базу данных
sudo mysql -u root -p

CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON myapp.* TO 'app_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;</code></pre>
<h3>2.6 Nginx</h3>
<pre><code class="language-bash">sudo apt install -y nginx

# Проверяем статус
sudo systemctl status nginx</code></pre>
<h3>2.7 Git</h3>
<pre><code class="language-bash">sudo apt install -y git</code></pre>
<hr>
<h2>Шаг 3: Деплой Laravel (Backend)</h2>
<h3>3.1 Клонирование репозитория</h3>
<pre><code class="language-bash"># Создаём директорию
sudo mkdir -p /var/www/api.example.com
sudo chown -R deploy:deploy /var/www/api.example.com

# Клонируем
cd /var/www/api.example.com
git clone https://github.com/your-repo/app-backend.git .</code></pre>
<h3>3.2 Установка зависимостей</h3>
<pre><code class="language-bash">composer install --no-dev --optimize-autoloader</code></pre>
<h3>3.3 Настройка окружения</h3>
<pre><code class="language-bash">cp .env.example .env

nano .env</code></pre>
<pre><code class="language-ini">APP_NAME=MyApp
APP_ENV=production
APP_KEY=
APP_DEBUG=false
APP_URL=https://api.example.com

LOG_CHANNEL=stack
LOG_LEVEL=error

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=myapp
DB_USERNAME=app_user
DB_PASSWORD=your_secure_password

CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync</code></pre>
<h3>3.4 Генерация ключа и миграции</h3>
<pre><code class="language-bash">php artisan key:generate
php artisan migrate --force
php artisan storage:link</code></pre>
<h3>3.5 Оптимизация</h3>
<pre><code class="language-bash">php artisan config:cache
php artisan route:cache
php artisan view:cache</code></pre>
<h3>3.6 Права доступа</h3>
<pre><code class="language-bash">sudo chown -R www-data:www-data /var/www/api.example.com
sudo chmod -R 755 /var/www/api.example.com
sudo chmod -R 775 /var/www/api.example.com/storage
sudo chmod -R 775 /var/www/api.example.com/bootstrap/cache</code></pre>
<h3>3.7 Nginx конфигурация для Laravel</h3>
<pre><code class="language-bash">sudo nano /etc/nginx/sites-available/api.example.com</code></pre>
<pre><code class="language-nginx">server {
    listen 80;
    server_name api.example.com;
    root /var/www/api.example.com/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php index.html;

    charset utf-8;

    # Максимальный размер загрузки
    client_max_body_size 100M;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }

    # Статические файлы
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|pdf|doc|docx)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}</code></pre>
<pre><code class="language-bash"># Активируем сайт
sudo ln -s /etc/nginx/sites-available/api.example.com /etc/nginx/sites-enabled/

# Проверяем конфигурацию
sudo nginx -t

# Перезапускаем
sudo systemctl reload nginx</code></pre>
<hr>
<h2>Шаг 4: Деплой Nuxt (Frontend)</h2>
<h3>4.1 Клонирование</h3>
<pre><code class="language-bash">sudo mkdir -p /var/www/example.com
sudo chown -R deploy:deploy /var/www/example.com

cd /var/www/example.com
git clone https://github.com/your-repo/app-frontend.git .</code></pre>
<h3>4.2 Установка и сборка</h3>
<pre><code class="language-bash">npm install
npm run build</code></pre>
<h3>4.3 Настройка PM2</h3>
<pre><code class="language-bash"># Создаём ecosystem файл
nano ecosystem.config.js</code></pre>
<pre><code class="language-javascript">// ecosystem.config.js

module.exports = {
  apps: [
    {
      name: 'app-frontend',
      port: 3000,
      exec_mode: 'cluster',
      instances: 'max',
      script: './.output/server/index.mjs',
      env: {
        NODE_ENV: 'production',
        NUXT_PUBLIC_API_BASE: 'https://api.example.com/api'
      }
    }
  ]
}</code></pre>
<h3>4.4 Запуск через PM2</h3>
<pre><code class="language-bash">pm2 start ecosystem.config.js

# Проверяем статус
pm2 status

# Логи
pm2 logs app-frontend

# Автозапуск при перезагрузке сервера
pm2 startup
pm2 save</code></pre>
<h3>4.5 Nginx конфигурация для Nuxt</h3>
<pre><code class="language-bash">sudo nano /etc/nginx/sites-available/example.com</code></pre>
<pre><code class="language-nginx">server {
    listen 80;
    server_name example.com www.example.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Статические ассеты Nuxt
    location /_nuxt/ {
        proxy_pass http://localhost:3000;
        proxy_cache_valid 200 365d;
        add_header Cache-Control "public, immutable";
    }
}</code></pre>
<pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx</code></pre>
<hr>
<h2>Шаг 5: SSL сертификаты (Let's Encrypt)</h2>
<h3>5.1 Установка Certbot</h3>
<pre><code class="language-bash">sudo apt install -y certbot python3-certbot-nginx</code></pre>
<h3>5.2 Получение сертификатов</h3>
<pre><code class="language-bash"># Для backend
sudo certbot --nginx -d api.example.com

# Для frontend
sudo certbot --nginx -d example.com -d www.example.com</code></pre>
<h3>5.3 Автопродление</h3>
<pre><code class="language-bash"># Проверяем автопродление
sudo certbot renew --dry-run

# Добавляем в cron (обычно certbot делает это автоматически)
sudo crontab -e

# Добавляем строку:
0 3 * * * certbot renew --quiet</code></pre>
<h3>5.4 Финальная конфигурация Nginx (после SSL)</h3>
<pre><code class="language-nginx"># /etc/nginx/sites-available/api.example.com

server {
    listen 80;
    server_name api.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.example.com;

    ssl_certificate /etc/letsencrypt/live/api.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.example.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;

    root /var/www/api.example.com/public;
    index index.php;

    client_max_body_size 100M;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}</code></pre>
<pre><code class="language-nginx"># /etc/nginx/sites-available/example.com

server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://example.com$request_uri;
}

server {
    listen 443 ssl http2;
    server_name www.example.com;
    return 301 https://example.com$request_uri;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;

    # HSTS
    add_header Strict-Transport-Security "max-age=63072000" always;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    location /_nuxt/ {
        proxy_pass http://localhost:3000;
        proxy_cache_valid 200 365d;
        add_header Cache-Control "public, immutable";
    }
}</code></pre>
<hr>
<h2>Шаг 6: Скрипты деплоя</h2>
<h3>6.1 deploy-backend.sh</h3>
<pre><code class="language-bash">#!/bin/bash
# /var/www/api.example.com/deploy.sh

set -e

echo "🚀 Deploying Laravel Backend..."

cd /var/www/api.example.com

echo "📥 Pulling latest changes..."
git pull origin main

echo "📦 Installing dependencies..."
composer install --no-dev --optimize-autoloader

echo "🔄 Running migrations..."
php artisan migrate --force

echo "🧹 Clearing caches..."
php artisan config:clear
php artisan route:clear
php artisan view:clear

echo "⚡ Caching..."
php artisan config:cache
php artisan route:cache
php artisan view:cache

echo "🔒 Setting permissions..."
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

echo "✅ Backend deployed successfully!"</code></pre>
<h3>6.2 deploy-frontend.sh</h3>
<pre><code class="language-bash">#!/bin/bash
# /var/www/example.com/deploy.sh

set -e

echo "🚀 Deploying Nuxt Frontend..."

cd /var/www/example.com

echo "📥 Pulling latest changes..."
git pull origin main

echo "📦 Installing dependencies..."
npm ci

echo "🔨 Building..."
npm run build

echo "🔄 Restarting PM2..."
pm2 restart app-frontend

echo "✅ Frontend deployed successfully!"</code></pre>
<h3>6.3 Права на выполнение</h3>
<pre><code class="language-bash">chmod +x /var/www/api.example.com/deploy.sh
chmod +x /var/www/example.com/deploy.sh</code></pre>
<hr>
<h2>Шаг 7: Мониторинг и логи</h2>
<h3>7.1 PM2 мониторинг</h3>
<pre><code class="language-bash"># Статус всех процессов
pm2 status

# Мониторинг в реальном времени
pm2 monit

# Логи
pm2 logs app-frontend

# Информация о процессе
pm2 show app-frontend</code></pre>
<h3>7.2 Nginx логи</h3>
<pre><code class="language-bash"># Access log
sudo tail -f /var/log/nginx/access.log

# Error log
sudo tail -f /var/log/nginx/error.log</code></pre>
<h3>7.3 Laravel логи</h3>
<pre><code class="language-bash">tail -f /var/www/api.example.com/storage/logs/laravel.log</code></pre>
<h3>7.4 Системные логи</h3>
<pre><code class="language-bash"># Journalctl
sudo journalctl -u nginx -f
sudo journalctl -u php8.1-fpm -f</code></pre>
<hr>
<h2>Шаг 8: Резервное копирование</h2>
<h3>8.1 Скрипт бэкапа базы данных</h3>
<pre><code class="language-bash">#!/bin/bash
# /home/deploy/backup.sh

DATE=$(date +%Y-%m-%d_%H-%M-%S)
BACKUP_DIR="/home/deploy/backups"
DB_NAME="myapp"
DB_USER="app_user"
DB_PASS="your_secure_password"

mkdir -p $BACKUP_DIR

# Бэкап базы данных
mysqldump -u$DB_USER -p$DB_PASS $DB_NAME | gzip &gt; $BACKUP_DIR/db_$DATE.sql.gz

# Бэкап файлов (storage)
tar -czf $BACKUP_DIR/storage_$DATE.tar.gz /var/www/api.example.com/storage

# Удаление старых бэкапов (старше 7 дней)
find $BACKUP_DIR -type f -mtime +7 -delete

echo "Backup completed: $DATE"</code></pre>
<h3>8.2 Cron для автоматического бэкапа</h3>
<pre><code class="language-bash">crontab -e

# Ежедневно в 3:00
0 3 * * * /home/deploy/backup.sh &gt;&gt; /home/deploy/backup.log 2&gt;&amp;1</code></pre>
<hr>
<h2>Шаг 9: Firewall (UFW)</h2>
<pre><code class="language-bash"># Включаем UFW
sudo ufw enable

# Разрешаем SSH
sudo ufw allow OpenSSH

# Разрешаем HTTP и HTTPS
sudo ufw allow 'Nginx Full'

# Проверяем статус
sudo ufw status</code></pre>
<hr>
<h2>Шаг 10: CI/CD с GitHub Actions</h2>
<h3>.github/workflows/deploy.yml</h3>
<pre><code class="language-yaml">name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/api.example.com
            ./deploy.sh

  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/example.com
            ./deploy.sh</code></pre>
<h3>Настройка секретов в GitHub</h3>
<ul class="styled-list">
<li>Перейдите в Settings → Secrets and variables → Actions</li>
<li>Добавьте:</li>
<li><code>SERVER_HOST</code> — IP сервера</li>
<li><code>SERVER_USER</code> — deploy</li>
<li><code>SSH_PRIVATE_KEY</code> — содержимое приватного ключа</li>
</ul>
<hr>
<h2>Альтернатива: Docker деплой</h2>
<h3>docker-compose.yml</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  # Laravel Backend
  backend:
    build:
      context: ./app-backend
      dockerfile: Dockerfile
    container_name: app-backend
    restart: unless-stopped
    volumes:
      - ./app-backend:/var/www/html
      - ./app-backend/storage:/var/www/html/storage
    environment:
      - APP_ENV=production
      - DB_HOST=db
    depends_on:
      - db
    networks:
      - app-network

  # Nuxt Frontend
  frontend:
    build:
      context: ./app-frontend
      dockerfile: Dockerfile
    container_name: app-frontend
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NUXT_PUBLIC_API_BASE=https://api.example.com/api
    networks:
      - app-network

  # MySQL Database
  db:
    image: mysql:8.0
    container_name: app-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - app-network

  # Nginx
  nginx:
    image: nginx:alpine
    container_name: app-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./certbot/www:/var/www/certbot
      - ./certbot/conf:/etc/letsencrypt
    depends_on:
      - backend
      - frontend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  mysql-data:</code></pre>
<h3>Dockerfile для Laravel</h3>
<pre><code class="language-dockerfile"># app-backend/Dockerfile

FROM php:8.1-fpm

# Установка зависимостей
RUN apt-get update &amp;&amp; apt-get install -y \
    git curl zip unzip libpng-dev libonig-dev libxml2-dev \
    &amp;&amp; docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

WORKDIR /var/www/html

COPY . .

RUN composer install --no-dev --optimize-autoloader

RUN chown -R www-data:www-data /var/www/html/storage /var/www/html/bootstrap/cache

EXPOSE 9000

CMD ["php-fpm"]</code></pre>
<h3>Dockerfile для Nuxt</h3>
<pre><code class="language-dockerfile"># app-frontend/Dockerfile

FROM node:18-alpine

WORKDIR /app

COPY package*.json ./

RUN npm ci

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["node", ".output/server/index.mjs"]</code></pre>
<hr>
<h2>Чек-лист деплоя</h2>
<h3>Сервер</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Создан пользователь deploy</li>
<li class="checklist"><input type="checkbox" disabled> Настроены SSH ключи</li>
<li class="checklist"><input type="checkbox" disabled> Установлен PHP 8.1 + расширения</li>
<li class="checklist"><input type="checkbox" disabled> Установлен Composer</li>
<li class="checklist"><input type="checkbox" disabled> Установлен Node.js 18</li>
<li class="checklist"><input type="checkbox" disabled> Установлен PM2</li>
<li class="checklist"><input type="checkbox" disabled> Установлен MySQL 8</li>
<li class="checklist"><input type="checkbox" disabled> Установлен Nginx</li>
<li class="checklist"><input type="checkbox" disabled> Настроен UFW</li>
</ul>
<h3>Backend (Laravel)</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Склонирован репозиторий</li>
<li class="checklist"><input type="checkbox" disabled> Установлены зависимости (composer install)</li>
<li class="checklist"><input type="checkbox" disabled> Настроен .env</li>
<li class="checklist"><input type="checkbox" disabled> Сгенерирован ключ</li>
<li class="checklist"><input type="checkbox" disabled> Выполнены миграции</li>
<li class="checklist"><input type="checkbox" disabled> Создан storage link</li>
<li class="checklist"><input type="checkbox" disabled> Настроен Nginx vhost</li>
<li class="checklist"><input type="checkbox" disabled> Настроены права доступа</li>
</ul>
<h3>Frontend (Nuxt)</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Склонирован репозиторий</li>
<li class="checklist"><input type="checkbox" disabled> Установлены зависимости (npm install)</li>
<li class="checklist"><input type="checkbox" disabled> Выполнена сборка (npm run build)</li>
<li class="checklist"><input type="checkbox" disabled> Настроен PM2 ecosystem</li>
<li class="checklist"><input type="checkbox" disabled> Запущен через PM2</li>
<li class="checklist"><input type="checkbox" disabled> Настроен Nginx vhost</li>
</ul>
<h3>SSL</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Установлен Certbot</li>
<li class="checklist"><input type="checkbox" disabled> Получены сертификаты для всех доменов</li>
<li class="checklist"><input type="checkbox" disabled> Настроено автопродление</li>
<li class="checklist"><input type="checkbox" disabled> Настроен редирект HTTP → HTTPS</li>
</ul>
<h3>Автоматизация</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Созданы скрипты деплоя</li>
<li class="checklist"><input type="checkbox" disabled> Настроен cron для бэкапов</li>
<li class="checklist"><input type="checkbox" disabled> (Опционально) Настроен CI/CD</li>
</ul>
<hr>
<h2>Полезные команды</h2>
<pre><code class="language-bash"># Перезапуск сервисов
sudo systemctl restart nginx
sudo systemctl restart php8.1-fpm
pm2 restart all

# Проверка статуса
sudo systemctl status nginx
sudo systemctl status php8.1-fpm
pm2 status

# Проверка портов
sudo netstat -tlnp

# Использование диска
df -h

# Использование памяти
free -m

# Процессы
htop</code></pre>
<hr>
<p><strong>Поздравляем! Ваше приложение развёрнуто на production сервере!</strong></p>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                         ГОТОВО К PRODUCTION                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ✅ https://example.com          — Frontend (Nuxt SSR)                  │
│   ✅ https://api.example.com    — Backend API (Laravel)                │
│   ✅ SSL сертификаты             — Let's Encrypt                        │
│   ✅ Автоматический деплой       — GitHub Actions                       │
│   ✅ Мониторинг                  — PM2                                   │
│   ✅ Резервное копирование       — Ежедневные бэкапы                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter4')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter6')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 06: Docker -->
        <section class="chapter" id="chapter6">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 06</span>
                <h1>Docker</h1>
            </div>

            <div class="content-section">
                <h2>Зачем Docker?</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      ПРЕИМУЩЕСТВА DOCKER                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   БЕЗ DOCKER                           С DOCKER                         │
│   ──────────                           ─────────                        │
│                                                                         │
│   "У меня работает"                    "Работает везде одинаково"       │
│   PHP 7.4 vs PHP 8.1                   Фиксированные версии             │
│   Разные конфиги                       Единый docker-compose.yml        │
│   Сложный деплой                       docker-compose up -d             │
│   Конфликты зависимостей               Изолированные контейнеры         │
│                                                                         │
│   АРХИТЕКТУРА:                                                          │
│   ────────────                                                          │
│                                                                         │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│   │  Nginx  │  │ PHP-FPM │  │  Node   │  │  MySQL  │  │  Redis  │       │
│   │  :80    │  │  :9000  │  │  :3000  │  │  :3306  │  │  :6379  │       │
│   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘       │
│        │            │            │            │            │            │
│        └────────────┴────────────┴────────────┴────────────┘            │
│                              │                                          │
│                     Docker Network                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Установка Docker</h2>
<h3>Ubuntu/Debian</h3>
<pre><code class="language-bash"># Удаляем старые версии
sudo apt remove docker docker-engine docker.io containerd runc

# Устанавливаем зависимости
sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release

# Добавляем GPG ключ Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# Добавляем репозиторий
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null

# Устанавливаем Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# Добавляем пользователя в группу docker
sudo usermod -aG docker $USER

# Перелогиниваемся или выполняем
newgrp docker

# Проверяем
docker --version
docker compose version</code></pre>
<h3>macOS</h3>
<pre><code class="language-bash"># Установите Docker Desktop с https://www.docker.com/products/docker-desktop
# Или через Homebrew:
brew install --cask docker</code></pre>
<h3>Windows</h3>
<p>Скачайте Docker Desktop с https://www.docker.com/products/docker-desktop</p>
<hr>
<h2>Структура проекта</h2>
<pre><code class="language-text">app-docker/
├── docker-compose.yml          # Главный файл оркестрации
├── docker-compose.override.yml # Переопределения для development
├── docker-compose.prod.yml     # Production конфигурация
├── .env                        # Переменные окружения
├── .env.example                # Пример переменных
│
├── backend/                    # Laravel приложение
│   ├── Dockerfile
│   ├── Dockerfile.prod
│   ├── .dockerignore
│   └── ... (Laravel файлы)
│
├── frontend/                   # Nuxt приложение
│   ├── Dockerfile
│   ├── Dockerfile.prod
│   ├── .dockerignore
│   └── ... (Nuxt файлы)
│
├── nginx/
│   ├── Dockerfile
│   ├── nginx.conf
│   └── conf.d/
│       ├── default.conf
│       ├── backend.conf
│       └── frontend.conf
│
├── mysql/
│   ├── my.cnf
│   └── init/
│       └── 01-create-database.sql
│
└── scripts/
    ├── deploy.sh
    ├── backup.sh
    └── restore.sh</code></pre>
<hr>
<h2>Переменные окружения</h2>
<h3>.env.example</h3>
<pre><code class="language-ini"># Application
APP_NAME=MyApp
APP_ENV=local
APP_DEBUG=true

# Domains
BACKEND_DOMAIN=api.app.local
FRONTEND_DOMAIN=app.local

# Database
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=myapp
DB_USERNAME=app_user
DB_PASSWORD=secret_password
DB_ROOT_PASSWORD=root_secret_password

# Redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=null

# Node
NODE_ENV=development
NUXT_PUBLIC_API_BASE=http://api.app.local/api

# PHP
PHP_VERSION=8.1
PHP_MEMORY_LIMIT=256M
PHP_UPLOAD_MAX_FILESIZE=100M
PHP_POST_MAX_SIZE=100M

# Nginx
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443</code></pre>
<h3>.env (скопируйте и настройте)</h3>
<pre><code class="language-bash">cp .env.example .env
nano .env</code></pre>
<hr>
<h2>Docker Compose (Development)</h2>
<h3>docker-compose.yml</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  # ===========================================
  # NGINX - Reverse Proxy
  # ===========================================
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: app-nginx
    restart: unless-stopped
    ports:
      - "${NGINX_HTTP_PORT:-80}:80"
      - "${NGINX_HTTPS_PORT:-443}:443"
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./backend:/var/www/backend:ro
      - ./certbot/www:/var/www/certbot:ro
      - ./certbot/conf:/etc/letsencrypt:ro
    depends_on:
      - backend
      - frontend
    networks:
      - app-network

  # ===========================================
  # BACKEND - Laravel + PHP-FPM
  # ===========================================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      args:
        PHP_VERSION: ${PHP_VERSION:-8.1}
    container_name: app-backend
    restart: unless-stopped
    working_dir: /var/www/backend
    volumes:
      - ./backend:/var/www/backend
      - ./backend/storage:/var/www/backend/storage
      - ./backend/bootstrap/cache:/var/www/backend/bootstrap/cache
    environment:
      APP_NAME: ${APP_NAME}
      APP_ENV: ${APP_ENV}
      APP_DEBUG: ${APP_DEBUG}
      APP_URL: http://${BACKEND_DOMAIN}
      DB_CONNECTION: ${DB_CONNECTION}
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT}
      DB_DATABASE: ${DB_DATABASE}
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_started
    networks:
      - app-network

  # ===========================================
  # FRONTEND - Nuxt 3
  # ===========================================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: app-frontend
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /app/.nuxt
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      NUXT_PUBLIC_API_BASE: ${NUXT_PUBLIC_API_BASE}
    ports:
      - "24678:24678"  # HMR порт для development
    command: npm run dev -- --host 0.0.0.0
    networks:
      - app-network

  # ===========================================
  # MySQL Database
  # ===========================================
  mysql:
    image: mysql:8.0
    container_name: app-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf:ro
      - ./mysql/init:/docker-entrypoint-initdb.d:ro
    ports:
      - "3306:3306"
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${DB_ROOT_PASSWORD}"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - app-network

  # ===========================================
  # Redis Cache
  # ===========================================
  redis:
    image: redis:7-alpine
    container_name: app-redis
    restart: unless-stopped
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    ports:
      - "6379:6379"
    networks:
      - app-network

  # ===========================================
  # phpMyAdmin (только для development)
  # ===========================================
  phpmyadmin:
    image: phpmyadmin:latest
    container_name: app-phpmyadmin
    restart: unless-stopped
    environment:
      PMA_HOST: mysql
      PMA_USER: root
      PMA_PASSWORD: ${DB_ROOT_PASSWORD}
      UPLOAD_LIMIT: 100M
    ports:
      - "8080:80"
    depends_on:
      - mysql
    networks:
      - app-network
    profiles:
      - dev

  # ===========================================
  # Mailhog (перехват email для development)
  # ===========================================
  mailhog:
    image: mailhog/mailhog
    container_name: app-mailhog
    restart: unless-stopped
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - app-network
    profiles:
      - dev

# ===========================================
# Networks
# ===========================================
networks:
  app-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

# ===========================================
# Volumes
# ===========================================
volumes:
  mysql-data:
    driver: local
  redis-data:
    driver: local</code></pre>
<hr>
<h2>Dockerfile для Laravel</h2>
<h3>backend/Dockerfile</h3>
<pre><code class="language-dockerfile"># ===========================================
# Laravel Backend Dockerfile (Development)
# ===========================================

ARG PHP_VERSION=8.1

FROM php:${PHP_VERSION}-fpm

LABEL maintainer="MyApp Development Team"

# Аргументы
ARG USER_ID=1000
ARG GROUP_ID=1000

# Установка системных зависимостей
RUN apt-get update &amp;&amp; apt-get install -y \
    git \
    curl \
    zip \
    unzip \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    libzip-dev \
    libfreetype6-dev \
    libjpeg62-turbo-dev \
    libwebp-dev \
    libxpm-dev \
    &amp;&amp; apt-get clean \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# Установка PHP расширений
RUN docker-php-ext-configure gd \
    --with-freetype \
    --with-jpeg \
    --with-webp \
    --with-xpm

RUN docker-php-ext-install \
    pdo_mysql \
    mbstring \
    exif \
    pcntl \
    bcmath \
    gd \
    zip \
    intl \
    opcache

# Установка Redis расширения
RUN pecl install redis &amp;&amp; docker-php-ext-enable redis

# Установка Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Настройка PHP
COPY docker/php.ini /usr/local/etc/php/conf.d/custom.ini

# Создание пользователя
RUN groupadd -g ${GROUP_ID} www \
    &amp;&amp; useradd -u ${USER_ID} -g www -m www \
    &amp;&amp; chown -R www:www /var/www

# Рабочая директория
WORKDIR /var/www/backend

# Переключаемся на пользователя
USER www

EXPOSE 9000

CMD ["php-fpm"]</code></pre>
<h3>backend/Dockerfile.prod</h3>
<pre><code class="language-dockerfile"># ===========================================
# Laravel Backend Dockerfile (Production)
# ===========================================

ARG PHP_VERSION=8.1

# Stage 1: Composer dependencies
FROM composer:latest AS composer

WORKDIR /app

COPY composer.json composer.lock ./

RUN composer install \
    --no-dev \
    --no-scripts \
    --no-autoloader \
    --prefer-dist \
    --ignore-platform-reqs

COPY . .

RUN composer dump-autoload --optimize --no-dev

# Stage 2: Production image
FROM php:${PHP_VERSION}-fpm-alpine

LABEL maintainer="MyApp Development Team"

# Установка зависимостей
RUN apk add --no-cache \
    git \
    curl \
    zip \
    unzip \
    libpng-dev \
    oniguruma-dev \
    libxml2-dev \
    libzip-dev \
    freetype-dev \
    libjpeg-turbo-dev \
    libwebp-dev

# Установка PHP расширений
RUN docker-php-ext-configure gd \
    --with-freetype \
    --with-jpeg \
    --with-webp

RUN docker-php-ext-install \
    pdo_mysql \
    mbstring \
    exif \
    pcntl \
    bcmath \
    gd \
    zip \
    intl \
    opcache

# Установка Redis
RUN apk add --no-cache --virtual .build-deps $PHPIZE_DEPS \
    &amp;&amp; pecl install redis \
    &amp;&amp; docker-php-ext-enable redis \
    &amp;&amp; apk del .build-deps

# Копирование конфигурации PHP
COPY docker/php.prod.ini /usr/local/etc/php/conf.d/custom.ini

# Рабочая директория
WORKDIR /var/www/backend

# Копирование приложения
COPY --from=composer /app /var/www/backend

# Права доступа
RUN chown -R www-data:www-data /var/www/backend \
    &amp;&amp; chmod -R 755 /var/www/backend/storage \
    &amp;&amp; chmod -R 755 /var/www/backend/bootstrap/cache

USER www-data

EXPOSE 9000

CMD ["php-fpm"]</code></pre>
<h3>backend/docker/php.ini</h3>
<pre><code class="language-ini">; PHP Configuration for Development

[PHP]
memory_limit = 256M
upload_max_filesize = 100M
post_max_size = 100M
max_execution_time = 300
max_input_time = 300

display_errors = On
display_startup_errors = On
error_reporting = E_ALL

[Date]
date.timezone = Asia/Almaty

[opcache]
opcache.enable = 0</code></pre>
<h3>backend/docker/php.prod.ini</h3>
<pre><code class="language-ini">; PHP Configuration for Production

[PHP]
memory_limit = 256M
upload_max_filesize = 100M
post_max_size = 100M
max_execution_time = 60
max_input_time = 60

display_errors = Off
display_startup_errors = Off
error_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT
log_errors = On

expose_php = Off

[Date]
date.timezone = Asia/Almaty

[opcache]
opcache.enable = 1
opcache.memory_consumption = 128
opcache.interned_strings_buffer = 8
opcache.max_accelerated_files = 10000
opcache.revalidate_freq = 0
opcache.validate_timestamps = 0
opcache.save_comments = 1
opcache.fast_shutdown = 1</code></pre>
<h3>backend/.dockerignore</h3>
<pre><code class="language-text">.git
.gitignore
.env
.env.example
docker-compose*.yml
Dockerfile*
README.md
node_modules
vendor
storage/logs/*
storage/framework/cache/*
storage/framework/sessions/*
storage/framework/views/*
bootstrap/cache/*
tests
phpunit.xml
.phpunit.result.cache</code></pre>
<hr>
<h2>Dockerfile для Nuxt</h2>
<h3>frontend/Dockerfile</h3>
<pre><code class="language-dockerfile"># ===========================================
# Nuxt Frontend Dockerfile (Development)
# ===========================================

FROM node:18-alpine

LABEL maintainer="MyApp Development Team"

# Установка зависимостей для node-gyp
RUN apk add --no-cache python3 make g++

# Рабочая директория
WORKDIR /app

# Копирование package files
COPY package*.json ./

# Установка зависимостей
RUN npm ci

# Копирование исходников
COPY . .

# Порты
EXPOSE 3000 24678

# Команда по умолчанию
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]</code></pre>
<h3>frontend/Dockerfile.prod</h3>
<pre><code class="language-dockerfile"># ===========================================
# Nuxt Frontend Dockerfile (Production)
# ===========================================

# Stage 1: Dependencies
FROM node:18-alpine AS deps

WORKDIR /app

COPY package*.json ./

RUN npm ci --only=production

# Stage 2: Build
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .

# Build arguments
ARG NUXT_PUBLIC_API_BASE
ENV NUXT_PUBLIC_API_BASE=$NUXT_PUBLIC_API_BASE

RUN npm run build

# Stage 3: Production
FROM node:18-alpine AS runner

LABEL maintainer="MyApp Development Team"

WORKDIR /app

ENV NODE_ENV=production

# Создаём пользователя
RUN addgroup --system --gid 1001 nodejs \
    &amp;&amp; adduser --system --uid 1001 nuxtjs

# Копирование билда
COPY --from=builder --chown=nuxtjs:nodejs /app/.output ./.output

USER nuxtjs

EXPOSE 3000

ENV HOST=0.0.0.0
ENV PORT=3000

CMD ["node", ".output/server/index.mjs"]</code></pre>
<h3>frontend/.dockerignore</h3>
<pre><code class="language-text">.git
.gitignore
.nuxt
.output
node_modules
npm-debug.log
Dockerfile*
docker-compose*.yml
README.md
.env*</code></pre>
<hr>
<h2>Nginx Configuration</h2>
<h3>nginx/Dockerfile</h3>
<pre><code class="language-dockerfile">FROM nginx:alpine

LABEL maintainer="MyApp Development Team"

# Удаляем дефолтный конфиг
RUN rm /etc/nginx/conf.d/default.conf

# Копируем наш конфиг
COPY nginx.conf /etc/nginx/nginx.conf
COPY conf.d/ /etc/nginx/conf.d/

EXPOSE 80 443

CMD ["nginx", "-g", "daemon off;"]</code></pre>
<h3>nginx/nginx.conf</h3>
<pre><code class="language-nginx">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main;

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Gzip
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml application/json application/javascript
               application/xml application/xml+rss text/javascript application/x-javascript;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;

    include /etc/nginx/conf.d/*.conf;
}</code></pre>
<h3>nginx/conf.d/backend.conf</h3>
<pre><code class="language-nginx"># Laravel Backend
server {
    listen 80;
    server_name api.app.local api.example.com;

    root /var/www/backend/public;
    index index.php;

    charset utf-8;
    client_max_body_size 100M;

    # API rate limiting
    location /api {
        limit_req zone=api burst=20 nodelay;
        try_files $uri $uri/ /index.php?$query_string;
    }

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass backend:9000;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    # Статика с кэшированием
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|pdf|doc|docx|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}</code></pre>
<h3>nginx/conf.d/frontend.conf</h3>
<pre><code class="language-nginx"># Nuxt Frontend
server {
    listen 80;
    server_name app.local example.com www.example.com;

    location / {
        proxy_pass http://frontend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 86400s;
        proxy_send_timeout 86400s;
    }

    # HMR WebSocket для development
    location /_nuxt/ {
        proxy_pass http://frontend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

    # Static assets caching
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
        proxy_pass http://frontend:3000;
        proxy_cache_valid 200 365d;
        add_header Cache-Control "public, immutable";
    }
}</code></pre>
<hr>
<h2>MySQL Configuration</h2>
<h3>mysql/my.cnf</h3>
<pre><code class="language-ini">[mysqld]
# Charset
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# InnoDB
innodb_buffer_pool_size = 256M
innodb_log_file_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# Query cache (deprecated in MySQL 8, но полезно знать)
# query_cache_type = 1
# query_cache_size = 32M

# Connections
max_connections = 200
wait_timeout = 600
interactive_timeout = 600

# Logging
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# Binary log (для репликации)
# log_bin = mysql-bin
# binlog_format = ROW
# expire_logs_days = 7

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4</code></pre>
<h3>mysql/init/01-create-database.sql</h3>
<pre><code class="language-sql">-- Создание базы данных (если не существует)
CREATE DATABASE IF NOT EXISTS `etu`
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

-- Права пользователя
GRANT ALL PRIVILEGES ON `myapp`.* TO 'app_user'@'%';
FLUSH PRIVILEGES;</code></pre>
<hr>
<h2>Production Docker Compose</h2>
<h3>docker-compose.prod.yml</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: app-nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./backend/public:/var/www/backend/public:ro
      - ./backend/storage/app/public:/var/www/backend/storage/app/public:ro
      - ./certbot/www:/var/www/certbot:ro
      - ./certbot/conf:/etc/letsencrypt:ro
    depends_on:
      - backend
      - frontend
    networks:
      - app-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.prod
    container_name: app-backend
    restart: always
    environment:
      APP_NAME: ${APP_NAME}
      APP_ENV: production
      APP_DEBUG: "false"
      APP_URL: https://${BACKEND_DOMAIN}
      DB_CONNECTION: ${DB_CONNECTION}
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT}
      DB_DATABASE: ${DB_DATABASE}
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      CACHE_DRIVER: redis
      SESSION_DRIVER: redis
      QUEUE_CONNECTION: redis
    volumes:
      - backend-storage:/var/www/backend/storage
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_started
    networks:
      - app-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
      args:
        NUXT_PUBLIC_API_BASE: https://${BACKEND_DOMAIN}/api
    container_name: app-frontend
    restart: always
    environment:
      NODE_ENV: production
    networks:
      - app-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  mysql:
    image: mysql:8.0
    container_name: app-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf:ro
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${DB_ROOT_PASSWORD}"]
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
      - app-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  redis:
    image: redis:7-alpine
    container_name: app-redis
    restart: always
    command: redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru
    volumes:
      - redis-data:/data
    networks:
      - app-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Certbot для SSL
  certbot:
    image: certbot/certbot
    container_name: app-certbot
    volumes:
      - ./certbot/www:/var/www/certbot
      - ./certbot/conf:/etc/letsencrypt
    entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $${!}; done;'"
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  mysql-data:
  redis-data:
  backend-storage:</code></pre>
<hr>
<h2>Скрипты управления</h2>
<h3>scripts/deploy.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

echo "🚀 Starting deployment..."

# Переходим в директорию проекта
cd /opt/app-docker

# Получаем последние изменения
echo "📥 Pulling latest changes..."
git pull origin main

# Останавливаем контейнеры
echo "🛑 Stopping containers..."
docker compose -f docker-compose.prod.yml down

# Пересобираем образы
echo "🔨 Building images..."
docker compose -f docker-compose.prod.yml build --no-cache

# Запускаем контейнеры
echo "🚀 Starting containers..."
docker compose -f docker-compose.prod.yml up -d

# Ждём пока MySQL будет готов
echo "⏳ Waiting for MySQL..."
sleep 10

# Выполняем миграции Laravel
echo "📦 Running migrations..."
docker compose -f docker-compose.prod.yml exec -T backend php artisan migrate --force

# Очищаем и кэшируем
echo "⚡ Caching..."
docker compose -f docker-compose.prod.yml exec -T backend php artisan config:cache
docker compose -f docker-compose.prod.yml exec -T backend php artisan route:cache
docker compose -f docker-compose.prod.yml exec -T backend php artisan view:cache

# Очищаем неиспользуемые образы
echo "🧹 Cleaning up..."
docker image prune -f

echo "✅ Deployment completed!"
docker compose -f docker-compose.prod.yml ps</code></pre>
<h3>scripts/backup.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

DATE=$(date +%Y-%m-%d_%H-%M-%S)
BACKUP_DIR="/opt/backups"
PROJECT_DIR="/opt/app-docker"

mkdir -p $BACKUP_DIR

echo "📦 Starting backup..."

# Бэкап базы данных
echo "💾 Backing up database..."
docker compose -f $PROJECT_DIR/docker-compose.prod.yml exec -T mysql \
    mysqldump -u root -p${DB_ROOT_PASSWORD} ${DB_DATABASE} | gzip &gt; $BACKUP_DIR/db_$DATE.sql.gz

# Бэкап файлов storage
echo "📁 Backing up storage..."
docker run --rm \
    -v app-docker_backend-storage:/data \
    -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/storage_$DATE.tar.gz -C /data .

# Удаление старых бэкапов (старше 7 дней)
echo "🧹 Removing old backups..."
find $BACKUP_DIR -type f -mtime +7 -delete

echo "✅ Backup completed: $DATE"
ls -lh $BACKUP_DIR</code></pre>
<h3>scripts/restore.sh</h3>
<pre><code class="language-bash">#!/bin/bash
set -e

if [ -z "$1" ]; then
    echo "Usage: ./restore.sh &lt;backup_date&gt;"
    echo "Example: ./restore.sh 2024-01-15_03-00-00"
    exit 1
fi

BACKUP_DATE=$1
BACKUP_DIR="/opt/backups"
PROJECT_DIR="/opt/app-docker"

DB_BACKUP="$BACKUP_DIR/db_$BACKUP_DATE.sql.gz"
STORAGE_BACKUP="$BACKUP_DIR/storage_$BACKUP_DATE.tar.gz"

if [ ! -f "$DB_BACKUP" ]; then
    echo "❌ Database backup not found: $DB_BACKUP"
    exit 1
fi

echo "⚠️  This will restore backup from $BACKUP_DATE"
read -p "Are you sure? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
fi

echo "🔄 Restoring database..."
gunzip &lt; $DB_BACKUP | docker compose -f $PROJECT_DIR/docker-compose.prod.yml exec -T mysql \
    mysql -u root -p${DB_ROOT_PASSWORD} ${DB_DATABASE}

if [ -f "$STORAGE_BACKUP" ]; then
    echo "🔄 Restoring storage..."
    docker run --rm \
        -v app-docker_backend-storage:/data \
        -v $BACKUP_DIR:/backup \
        alpine sh -c "rm -rf /data/* &amp;&amp; tar xzf /backup/storage_$BACKUP_DATE.tar.gz -C /data"
fi

echo "✅ Restore completed!"</code></pre>
<hr>
<h2>Команды Docker</h2>
<h3>Основные команды</h3>
<pre><code class="language-bash"># Запуск development
docker compose up -d

# Запуск с dev-профилем (phpMyAdmin, Mailhog)
docker compose --profile dev up -d

# Запуск production
docker compose -f docker-compose.prod.yml up -d

# Остановка
docker compose down

# Пересборка
docker compose build --no-cache

# Логи
docker compose logs -f
docker compose logs -f backend
docker compose logs -f frontend

# Статус
docker compose ps

# Выполнение команд в контейнере
docker compose exec backend php artisan migrate
docker compose exec backend php artisan tinker
docker compose exec mysql mysql -u root -p

# Перезапуск сервиса
docker compose restart backend
docker compose restart frontend</code></pre>
<h3>Полезные алиасы (~/.bashrc)</h3>
<pre><code class="language-bash"># Docker Compose
alias dc='docker compose'
alias dcup='docker compose up -d'
alias dcdown='docker compose down'
alias dclogs='docker compose logs -f'
alias dcps='docker compose ps'
alias dcbuild='docker compose build --no-cache'

# Laravel в Docker
alias dartisan='docker compose exec backend php artisan'
alias dcomposer='docker compose exec backend composer'

# Nuxt в Docker
alias dnpm='docker compose exec frontend npm'</code></pre>
<hr>
<h2>SSL в Docker (Let's Encrypt)</h2>
<h3>Первоначальная настройка</h3>
<pre><code class="language-bash"># 1. Создаём директории
mkdir -p certbot/www certbot/conf

# 2. Запускаем nginx без SSL
docker compose -f docker-compose.prod.yml up -d nginx

# 3. Получаем сертификат
docker compose -f docker-compose.prod.yml run --rm certbot certonly \
    --webroot \
    --webroot-path=/var/www/certbot \
    -d example.com \
    -d www.example.com \
    -d api.example.com \
    --email your@email.com \
    --agree-tos \
    --no-eff-email

# 4. Обновляем nginx конфиг для HTTPS
# 5. Перезапускаем
docker compose -f docker-compose.prod.yml restart nginx</code></pre>
<h3>nginx/conf.d/ssl.conf (после получения сертификата)</h3>
<pre><code class="language-nginx"># HTTP -&gt; HTTPS redirect
server {
    listen 80;
    server_name example.com www.example.com api.example.com;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}

# Frontend HTTPS
server {
    listen 443 ssl http2;
    server_name example.com www.example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;

    add_header Strict-Transport-Security "max-age=63072000" always;

    location / {
        proxy_pass http://frontend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Backend HTTPS
server {
    listen 443 ssl http2;
    server_name api.example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers off;

    root /var/www/backend/public;
    index index.php;

    client_max_body_size 100M;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass backend:9000;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }
}</code></pre>
<hr>
<h2>CI/CD Pipeline</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                         CI/CD ПРОЦЕСС                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐             │
│   │  PUSH   │───►│  TEST   │───►│  BUILD  │───►│ DEPLOY  │             │
│   │  CODE   │    │  CI     │    │  IMAGE  │    │  PROD   │             │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘             │
│        │              │              │              │                   │
│        ▼              ▼              ▼              ▼                   │
│   GitHub/GitLab  PHPUnit/Jest   Docker Hub    Production               │
│   Repository     Lint/Analyze   Registry      Server                   │
│                                                                         │
│   ТРИГГЕРЫ:                                                            │
│   ─────────                                                            │
│   • Push в main/master → автодеплой на production                      │
│   • Push в develop → автодеплой на staging                             │
│   • Pull Request → только тесты (без деплоя)                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h3>GitHub Actions</h3>
<h4>Структура директории</h4>
<pre><code class="language-text">.github/
└── workflows/
    ├── ci.yml           # Тесты при каждом push/PR
    ├── deploy.yml       # Деплой на production
    └── staging.yml      # Деплой на staging</code></pre>
<h4>.github/workflows/ci.yml (Тесты)</h4>
<pre><code class="language-yaml">name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  # ===========================================
  # Backend Tests (Laravel)
  # ===========================================
  backend-tests:
    name: Backend Tests
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: myapp_test
        ports:
          - 3306:3306
        options: &gt;-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3

      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: &gt;-
          --health-cmd="redis-cli ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'
          extensions: mbstring, pdo, pdo_mysql, gd, zip, bcmath, redis
          coverage: xdebug

      - name: Get Composer cache directory
        id: composer-cache
        run: echo "dir=$(composer config cache-files-dir)" &gt;&gt; $GITHUB_OUTPUT
        working-directory: backend

      - name: Cache Composer dependencies
        uses: actions/cache@v4
        with:
          path: ${{ steps.composer-cache.outputs.dir }}
          key: ${{ runner.os }}-composer-${{ hashFiles('backend/composer.lock') }}
          restore-keys: ${{ runner.os }}-composer-

      - name: Install dependencies
        run: composer install --no-progress --prefer-dist --optimize-autoloader
        working-directory: backend

      - name: Copy environment file
        run: cp .env.example .env
        working-directory: backend

      - name: Generate application key
        run: php artisan key:generate
        working-directory: backend

      - name: Run migrations
        run: php artisan migrate --force
        working-directory: backend
        env:
          DB_CONNECTION: mysql
          DB_HOST: 127.0.0.1
          DB_PORT: 3306
          DB_DATABASE: myapp_test
          DB_USERNAME: root
          DB_PASSWORD: root

      - name: Run PHPUnit tests
        run: php artisan test --coverage --min=60
        working-directory: backend
        env:
          DB_CONNECTION: mysql
          DB_HOST: 127.0.0.1
          DB_PORT: 3306
          DB_DATABASE: myapp_test
          DB_USERNAME: root
          DB_PASSWORD: root
          REDIS_HOST: 127.0.0.1

      - name: Run PHP Code Sniffer
        run: vendor/bin/phpcs --standard=PSR12 app/
        working-directory: backend
        continue-on-error: true

      - name: Run PHPStan
        run: vendor/bin/phpstan analyse --memory-limit=2G
        working-directory: backend
        continue-on-error: true

  # ===========================================
  # Frontend Tests (Nuxt)
  # ===========================================
  frontend-tests:
    name: Frontend Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        run: npm ci
        working-directory: frontend

      - name: Run ESLint
        run: npm run lint
        working-directory: frontend
        continue-on-error: true

      - name: Run TypeScript check
        run: npm run typecheck
        working-directory: frontend
        continue-on-error: true

      - name: Run Vitest tests
        run: npm run test
        working-directory: frontend
        continue-on-error: true

      - name: Build application
        run: npm run build
        working-directory: frontend
        env:
          NUXT_PUBLIC_API_BASE: https://api.example.com/api

  # ===========================================
  # Docker Build Test
  # ===========================================
  docker-build:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: [backend-tests, frontend-tests]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Backend image
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          file: ./backend/Dockerfile.prod
          push: false
          tags: app-backend:test
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Build Frontend image
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          file: ./frontend/Dockerfile.prod
          push: false
          tags: app-frontend:test
          build-args: |
            NUXT_PUBLIC_API_BASE=https://api.example.com/api
          cache-from: type=gha
          cache-to: type=gha,mode=max</code></pre>
<h4>.github/workflows/deploy.yml (Production Deployment)</h4>
<pre><code class="language-yaml">name: Deploy to Production

on:
  push:
    branches: [main]
  workflow_dispatch:  # Ручной запуск

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # ===========================================
  # Build and Push Docker Images
  # ===========================================
  build:
    name: Build and Push
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    outputs:
      backend-tag: ${{ steps.meta-backend.outputs.tags }}
      frontend-tag: ${{ steps.meta-frontend.outputs.tags }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Backend Image
      - name: Extract metadata for Backend
        id: meta-backend
        uses: docker/metadata-action@v5
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-backend
          tags: |
            type=sha,prefix=
            type=raw,value=latest

      - name: Build and push Backend
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          file: ./backend/Dockerfile.prod
          push: true
          tags: ${{ steps.meta-backend.outputs.tags }}
          labels: ${{ steps.meta-backend.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      # Frontend Image
      - name: Extract metadata for Frontend
        id: meta-frontend
        uses: docker/metadata-action@v5
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-frontend
          tags: |
            type=sha,prefix=
            type=raw,value=latest

      - name: Build and push Frontend
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          file: ./frontend/Dockerfile.prod
          push: true
          tags: ${{ steps.meta-frontend.outputs.tags }}
          labels: ${{ steps.meta-frontend.outputs.labels }}
          build-args: |
            NUXT_PUBLIC_API_BASE=https://api.example.com/api
          cache-from: type=gha
          cache-to: type=gha,mode=max

  # ===========================================
  # Deploy to Server
  # ===========================================
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build
    environment: production

    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PROD_HOST }}
          username: ${{ secrets.PROD_USER }}
          key: ${{ secrets.PROD_SSH_KEY }}
          port: ${{ secrets.PROD_PORT || 22 }}
          script: |
            cd /opt/app-docker

            # Pull latest changes
            git pull origin main

            # Login to registry
            echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin

            # Pull new images
            docker compose -f docker-compose.prod.yml pull

            # Deploy with zero-downtime
            docker compose -f docker-compose.prod.yml up -d --remove-orphans

            # Run migrations
            docker compose -f docker-compose.prod.yml exec -T backend php artisan migrate --force

            # Clear and cache
            docker compose -f docker-compose.prod.yml exec -T backend php artisan config:cache
            docker compose -f docker-compose.prod.yml exec -T backend php artisan route:cache
            docker compose -f docker-compose.prod.yml exec -T backend php artisan view:cache

            # Cleanup old images
            docker image prune -f

            # Health check
            sleep 10
            curl -f http://localhost/api/health || exit 1

            echo "✅ Deployment successful!"

      - name: Notify on success
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.repos.createCommitStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha: context.sha,
              state: 'success',
              description: 'Deployed to production',
              context: 'deployment/production'
            })

      - name: Notify on failure
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.repos.createCommitStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha: context.sha,
              state: 'failure',
              description: 'Deployment failed',
              context: 'deployment/production'
            })</code></pre>
<h4>.github/workflows/staging.yml (Staging Deployment)</h4>
<pre><code class="language-yaml">name: Deploy to Staging

on:
  push:
    branches: [develop]

jobs:
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    environment: staging

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.STAGING_HOST }}
          username: ${{ secrets.STAGING_USER }}
          key: ${{ secrets.STAGING_SSH_KEY }}
          script: |
            cd /opt/app-docker-staging
            git pull origin develop
            docker compose -f docker-compose.staging.yml down
            docker compose -f docker-compose.staging.yml build --no-cache
            docker compose -f docker-compose.staging.yml up -d
            docker compose -f docker-compose.staging.yml exec -T backend php artisan migrate --force
            echo "✅ Staging deployment successful!"</code></pre>
<hr>
<h3>GitLab CI/CD</h3>
<h4>.gitlab-ci.yml</h4>
<pre><code class="language-yaml">stages:
  - test
  - build
  - deploy

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"

  # Registry
  REGISTRY: registry.gitlab.com
  BACKEND_IMAGE: $CI_REGISTRY_IMAGE/backend
  FRONTEND_IMAGE: $CI_REGISTRY_IMAGE/frontend

# ===========================================
# Templates
# ===========================================
.docker-template: &amp;docker-template
  image: docker:24
  services:
    - docker:24-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY

# ===========================================
# Test Stage
# ===========================================
backend-test:
  stage: test
  image: php:8.1
  services:
    - mysql:8.0
    - redis:7-alpine
  variables:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: myapp_test
    DB_HOST: mysql
    REDIS_HOST: redis
  before_script:
    - apt-get update &amp;&amp; apt-get install -y git unzip libpng-dev libzip-dev
    - docker-php-ext-install pdo_mysql gd zip
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
  script:
    - cd backend
    - composer install --no-progress
    - cp .env.example .env
    - php artisan key:generate
    - php artisan migrate --force
    - php artisan test
  cache:
    key: ${CI_COMMIT_REF_SLUG}-backend
    paths:
      - backend/vendor/
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == "main"
    - if: $CI_COMMIT_BRANCH == "develop"

frontend-test:
  stage: test
  image: node:18-alpine
  script:
    - cd frontend
    - npm ci
    - npm run lint
    - npm run build
  cache:
    key: ${CI_COMMIT_REF_SLUG}-frontend
    paths:
      - frontend/node_modules/
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == "main"
    - if: $CI_COMMIT_BRANCH == "develop"

# ===========================================
# Build Stage
# ===========================================
build-backend:
  stage: build
  &lt;&lt;: *docker-template
  script:
    - docker build -f backend/Dockerfile.prod -t $BACKEND_IMAGE:$CI_COMMIT_SHA -t $BACKEND_IMAGE:latest backend/
    - docker push $BACKEND_IMAGE:$CI_COMMIT_SHA
    - docker push $BACKEND_IMAGE:latest
  rules:
    - if: $CI_COMMIT_BRANCH == "main"

build-frontend:
  stage: build
  &lt;&lt;: *docker-template
  script:
    - docker build
        --build-arg NUXT_PUBLIC_API_BASE=https://api.example.com/api
        -f frontend/Dockerfile.prod
        -t $FRONTEND_IMAGE:$CI_COMMIT_SHA
        -t $FRONTEND_IMAGE:latest
        frontend/
    - docker push $FRONTEND_IMAGE:$CI_COMMIT_SHA
    - docker push $FRONTEND_IMAGE:latest
  rules:
    - if: $CI_COMMIT_BRANCH == "main"

# ===========================================
# Deploy Stage
# ===========================================
deploy-production:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - echo "$SSH_KNOWN_HOSTS" &gt;&gt; ~/.ssh/known_hosts
  script:
    - |
      ssh $PROD_USER@$PROD_HOST &lt;&lt; 'ENDSSH'
        cd /opt/app-docker
        git pull origin main
        docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        docker compose -f docker-compose.prod.yml pull
        docker compose -f docker-compose.prod.yml up -d --remove-orphans
        docker compose -f docker-compose.prod.yml exec -T backend php artisan migrate --force
        docker compose -f docker-compose.prod.yml exec -T backend php artisan config:cache
        docker compose -f docker-compose.prod.yml exec -T backend php artisan route:cache
        docker image prune -f
        echo "✅ Deployment successful!"
      ENDSSH
  environment:
    name: production
    url: https://example.com
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      when: manual
  needs:
    - build-backend
    - build-frontend

deploy-staging:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - echo "$SSH_KNOWN_HOSTS" &gt;&gt; ~/.ssh/known_hosts
  script:
    - |
      ssh $STAGING_USER@$STAGING_HOST &lt;&lt; 'ENDSSH'
        cd /opt/app-docker-staging
        git pull origin develop
        docker compose -f docker-compose.staging.yml down
        docker compose -f docker-compose.staging.yml build --no-cache
        docker compose -f docker-compose.staging.yml up -d
        docker compose -f docker-compose.staging.yml exec -T backend php artisan migrate --force
        echo "✅ Staging deployment successful!"
      ENDSSH
  environment:
    name: staging
    url: https://staging.example.com
  rules:
    - if: $CI_COMMIT_BRANCH == "develop"</code></pre>
<hr>
<h3>Настройка Secrets</h3>
<h4>GitHub Secrets</h4>
<pre><code class="language-text"># Repository Settings → Secrets and variables → Actions

# Production Server
PROD_HOST=123.456.789.0
PROD_USER=deploy
PROD_SSH_KEY=-----BEGIN OPENSSH PRIVATE KEY-----...
PROD_PORT=22

# Staging Server
STAGING_HOST=staging.example.com
STAGING_USER=deploy
STAGING_SSH_KEY=-----BEGIN OPENSSH PRIVATE KEY-----...

# Docker Registry (если используете DockerHub)
DOCKERHUB_USERNAME=your-username
DOCKERHUB_TOKEN=your-token</code></pre>
<h4>GitLab CI/CD Variables</h4>
<pre><code class="language-text"># Settings → CI/CD → Variables

# SSH
SSH_PRIVATE_KEY=-----BEGIN OPENSSH PRIVATE KEY-----...
SSH_KNOWN_HOSTS=example.com ssh-rsa AAAA...

# Production
PROD_HOST=123.456.789.0
PROD_USER=deploy

# Staging
STAGING_HOST=staging.example.com
STAGING_USER=deploy</code></pre>
<hr>
<h3>Health Check Endpoint</h3>
<h4>backend/routes/api.php</h4>
<pre><code class="language-php">&lt;?php

// Health check для CI/CD
Route::get('/health', function () {
    try {
        // Проверка базы данных
        DB::connection()-&gt;getPdo();

        // Проверка Redis
        Cache::store('redis')-&gt;put('health_check', true, 10);

        return response()-&gt;json([
            'status' =&gt; 'healthy',
            'timestamp' =&gt; now()-&gt;toISOString(),
            'services' =&gt; [
                'database' =&gt; 'ok',
                'cache' =&gt; 'ok',
            ]
        ], 200);
    } catch (\Exception $e) {
        return response()-&gt;json([
            'status' =&gt; 'unhealthy',
            'error' =&gt; $e-&gt;getMessage(),
        ], 500);
    }
});</code></pre>
<hr>
<h3>docker-compose.prod.yml с Registry</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  backend:
    image: ghcr.io/your-org/app-backend:latest
    # или для GitLab:
    # image: registry.gitlab.com/your-group/myapp/backend:latest
    container_name: app-backend
    restart: always
    environment:
      APP_ENV: production
      # ...остальные переменные
    volumes:
      - backend-storage:/var/www/backend/storage
    networks:
      - app-network

  frontend:
    image: ghcr.io/your-org/app-frontend:latest
    # или для GitLab:
    # image: registry.gitlab.com/your-group/myapp/frontend:latest
    container_name: app-frontend
    restart: always
    environment:
      NODE_ENV: production
    networks:
      - app-network

  # nginx, mysql, redis - как и раньше
  # ...</code></pre>
<hr>
<h3>Rollback Script</h3>
<h4>scripts/rollback.sh</h4>
<pre><code class="language-bash">#!/bin/bash
set -e

if [ -z "$1" ]; then
    echo "Usage: ./rollback.sh &lt;commit_sha&gt;"
    echo "Example: ./rollback.sh abc1234"
    echo ""
    echo "Recent deployments:"
    docker images --format "{{.Repository}}:{{.Tag}}" | grep myapp | head -10
    exit 1
fi

COMMIT_SHA=$1
REGISTRY="ghcr.io/your-org"

echo "⚠️  Rolling back to commit: $COMMIT_SHA"
read -p "Are you sure? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
fi

cd /opt/app-docker

# Pull specific version
docker pull $REGISTRY/app-backend:$COMMIT_SHA
docker pull $REGISTRY/app-frontend:$COMMIT_SHA

# Update docker-compose to use specific tags
sed -i "s|app-backend:.*|app-backend:$COMMIT_SHA|g" docker-compose.prod.yml
sed -i "s|app-frontend:.*|app-frontend:$COMMIT_SHA|g" docker-compose.prod.yml

# Restart services
docker compose -f docker-compose.prod.yml up -d --remove-orphans

echo "✅ Rollback to $COMMIT_SHA completed!"
docker compose -f docker-compose.prod.yml ps</code></pre>
<hr>
<h3>Cron для автоматического бэкапа</h3>
<pre><code class="language-bash"># Добавить в crontab: crontab -e

# Ежедневный бэкап в 3:00
0 3 * * * /opt/app-docker/scripts/backup.sh &gt;&gt; /var/log/app-backup.log 2&gt;&amp;1

# Проверка здоровья каждые 5 минут
*/5 * * * * curl -sf http://localhost/api/health || docker compose -f /opt/app-docker/docker-compose.prod.yml restart backend frontend</code></pre>
<hr>
<h3>Notification (Telegram/Slack)</h3>
<h4>scripts/notify.sh</h4>
<pre><code class="language-bash">#!/bin/bash

# Telegram notification
TELEGRAM_BOT_TOKEN="your-bot-token"
TELEGRAM_CHAT_ID="your-chat-id"
MESSAGE="$1"

curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
    -d chat_id="${TELEGRAM_CHAT_ID}" \
    -d text="${MESSAGE}" \
    -d parse_mode="Markdown"</code></pre>
<h4>Использование в CI/CD</h4>
<pre><code class="language-yaml"># В GitHub Actions
- name: Notify Telegram
  if: always()
  run: |
    if [ "${{ job.status }}" == "success" ]; then
      MESSAGE="✅ *MyApp Deploy*: успешно развёрнуто на production"
    else
      MESSAGE="❌ *MyApp Deploy*: ошибка деплоя!"
    fi
    curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
      -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
      -d text="$MESSAGE" \
      -d parse_mode="Markdown"</code></pre>
<hr>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      CI/CD PIPELINE СХЕМА                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   Developer                                                             │
│      │                                                                  │
│      ▼                                                                  │
│   ┌──────────┐                                                         │
│   │  git     │                                                         │
│   │  push    │                                                         │
│   └────┬─────┘                                                         │
│        │                                                                │
│        ▼                                                                │
│   ┌──────────────────────────────────────────────────────┐             │
│   │                 GitHub Actions / GitLab CI            │             │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐           │             │
│   │  │   TEST   │  │   BUILD  │  │  DEPLOY  │           │             │
│   │  │ Backend  │  │  Docker  │  │   SSH    │           │             │
│   │  │ Frontend │  │  Images  │  │  Script  │           │             │
│   │  └────┬─────┘  └────┬─────┘  └────┬─────┘           │             │
│   │       │             │             │                  │             │
│   │       │    ✓        │    ✓        │    ✓             │             │
│   │       └─────────────┴─────────────┘                  │             │
│   └──────────────────────────┬───────────────────────────┘             │
│                              │                                          │
│                              ▼                                          │
│   ┌──────────────────────────────────────────────────────┐             │
│   │                  Production Server                    │             │
│   │                                                       │             │
│   │   docker compose pull                                 │             │
│   │   docker compose up -d                                │             │
│   │   php artisan migrate --force                        │             │
│   │                                                       │             │
│   └───────────────────────────────────────────────────────┘             │
│                              │                                          │
│                              ▼                                          │
│   ┌──────────┐  ┌──────────┐  ┌──────────┐                            │
│   │ Telegram │  │  Slack   │  │  Email   │   ← Notifications           │
│   └──────────┘  └──────────┘  └──────────┘                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Безопасность Docker</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      УРОВНИ БЕЗОПАСНОСТИ                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  1. HOST          Firewall, SSH, Updates, User permissions      │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │  2. DOCKER        Daemon config, Image scanning, Secrets        │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │  3. CONTAINER     Non-root, Read-only, Resource limits          │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │  4. NETWORK       Isolated networks, TLS, Firewall rules        │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │  5. APPLICATION   Headers, CORS, Input validation, Auth         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h3>Безопасность контейнеров</h3>
<h4>Запуск от непривилегированного пользователя</h4>
<pre><code class="language-dockerfile"># backend/Dockerfile.prod

FROM php:8.1-fpm-alpine

# Создаём пользователя с конкретным UID/GID
RUN addgroup -g 1000 -S www &amp;&amp; \
    adduser -u 1000 -S www -G www

# ... установка зависимостей ...

# Устанавливаем владельца файлов
COPY --chown=www:www . /var/www/backend

# Переключаемся на непривилегированного пользователя
USER www

EXPOSE 9000
CMD ["php-fpm"]</code></pre>
<pre><code class="language-dockerfile"># frontend/Dockerfile.prod

FROM node:18-alpine AS runner

# Создаём пользователя
RUN addgroup --system --gid 1001 nodejs &amp;&amp; \
    adduser --system --uid 1001 nuxtjs

# Копируем с правильным владельцем
COPY --from=builder --chown=nuxtjs:nodejs /app/.output ./.output

# Запуск от непривилегированного пользователя
USER nuxtjs

EXPOSE 3000
CMD ["node", ".output/server/index.mjs"]</code></pre>
<h4>Read-only файловая система</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  backend:
    image: app-backend:latest
    read_only: true
    tmpfs:
      - /tmp
      - /var/run
    volumes:
      # Только необходимые директории для записи
      - backend-storage:/var/www/backend/storage
      - backend-cache:/var/www/backend/bootstrap/cache

  frontend:
    image: app-frontend:latest
    read_only: true
    tmpfs:
      - /tmp</code></pre>
<h4>Ограничение ресурсов</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    # Для docker-compose без swarm:
    mem_limit: 512m
    memswap_limit: 512m
    cpus: 2

  frontend:
    mem_limit: 256m
    cpus: 1

  mysql:
    mem_limit: 1g
    cpus: 2

  redis:
    mem_limit: 128m
    cpus: 0.5</code></pre>
<h4>Отключение привилегий</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  backend:
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SMyAppID
      - SETGID

  nginx:
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE  # Для портов &lt; 1024
      - CHOWN</code></pre>
<hr>
<h3>Безопасность образов</h3>
<h4>Сканирование образов</h4>
<pre><code class="language-bash"># Использование Docker Scout (встроенный)
docker scout cves app-backend:latest
docker scout recommendations app-backend:latest

# Использование Trivy
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
    aquasec/trivy image app-backend:latest

# Сканирование с отчётом
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
    -v $(pwd)/reports:/reports \
    aquasec/trivy image \
    --format json \
    --output /reports/scan-report.json \
    app-backend:latest</code></pre>
<h4>CI/CD интеграция сканирования</h4>
<pre><code class="language-yaml"># .github/workflows/security.yml

name: Security Scan

on:
  push:
    branches: [main, develop]
  schedule:
    - cron: '0 0 * * *'  # Ежедневно

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build image
        run: docker build -t app-backend:scan ./backend

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'app-backend:scan'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH'

      - name: Upload Trivy scan results
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: 'trivy-results.sarif'

      - name: Fail on critical vulnerabilities
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'app-backend:scan'
          exit-code: '1'
          severity: 'CRITICAL'</code></pre>
<h4>Доверенные базовые образы</h4>
<pre><code class="language-dockerfile"># Используйте официальные образы
FROM php:8.1-fpm-alpine      # ✓ Официальный
FROM node:18-alpine          # ✓ Официальный
FROM nginx:alpine            # ✓ Официальный

# НЕ используйте непроверенные образы
# FROM random-user/php:latest  # ✗ Небезопасно

# Фиксируйте версии
FROM php:8.1.27-fpm-alpine3.19  # ✓ Конкретная версия
FROM node:18.19.0-alpine3.19     # ✓ Конкретная версия

# Используйте digest для максимальной безопасности
FROM php@sha256:abc123...  # ✓ Неизменяемый образ</code></pre>
<h4>.dockerignore для безопасности</h4>
<pre><code class="language-dockerignore"># .dockerignore

# Git
.git
.gitignore

# Секреты и конфигурация
.env
.env.*
*.pem
*.key
credentials.json
secrets/

# IDE
.idea
.vscode
*.swp

# Тесты и документация
tests/
docs/
*.md
README*

# Зависимости (устанавливаются при сборке)
vendor/
node_modules/

# Логи и кэш
*.log
storage/logs/*
storage/framework/cache/*
.nuxt/
.output/

# Docker файлы
Dockerfile*
docker-compose*.yml</code></pre>
<hr>
<h3>Управление секретами</h3>
<h4>Docker Secrets (Swarm mode)</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml (Swarm)

version: '3.8'

services:
  backend:
    image: app-backend:latest
    secrets:
      - db_password
      - app_key
    environment:
      DB_PASSWORD_FILE: /run/secrets/db_password
      APP_KEY_FILE: /run/secrets/app_key

secrets:
  db_password:
    external: true
  app_key:
    external: true</code></pre>
<pre><code class="language-bash"># Создание секретов
echo "super_secret_password" | docker secret create db_password -
echo "base64:your_app_key" | docker secret create app_key -

# Список секретов
docker secret ls</code></pre>
<h4>Использование секретов в Laravel</h4>
<pre><code class="language-php">&lt;?php
// config/database.php

'mysql' =&gt; [
    'password' =&gt; file_exists('/run/secrets/db_password')
        ? trim(file_get_contents('/run/secrets/db_password'))
        : env('DB_PASSWORD'),
],</code></pre>
<h4>Секреты через .env файлы (без Swarm)</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  backend:
    env_file:
      - .env.prod.secrets  # Файл НЕ в git!
    environment:
      # Переопределение несекретных переменных
      APP_ENV: production
      APP_DEBUG: "false"</code></pre>
<pre><code class="language-bash"># .env.prod.secrets (НЕ коммитить!)
DB_PASSWORD=super_secret_password
APP_KEY=base64:your_app_key
REDIS_PASSWORD=redis_secret</code></pre>
<pre><code class="language-gitignore"># .gitignore
.env.prod.secrets
*.secrets</code></pre>
<h4>HashiCorp Vault интеграция</h4>
<pre><code class="language-yaml"># docker-compose.yml

services:
  vault:
    image: hashicorp/vault:latest
    container_name: app-vault
    cap_add:
      - IPC_LOCK
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: myroot
      VAULT_DEV_LISTEN_ADDRESS: 0.0.0.0:8200
    ports:
      - "8200:8200"
    volumes:
      - vault-data:/vault/data
    networks:
      - app-network

volumes:
  vault-data:</code></pre>
<pre><code class="language-php">&lt;?php
// Получение секретов из Vault (Laravel)

use GuzzleHttp\Client;

class VaultSecrets
{
    public static function get(string $path): ?string
    {
        $client = new Client([
            'base_uri' =&gt; env('VAULT_ADDR', 'http://vault:8200'),
            'headers' =&gt; [
                'X-Vault-Token' =&gt; env('VAULT_TOKEN'),
            ],
        ]);

        try {
            $response = $client-&gt;get("/v1/secret/data/{$path}");
            $data = json_decode($response-&gt;getBody(), true);
            return $data['data']['data']['value'] ?? null;
        } catch (\Exception $e) {
            return null;
        }
    }
}</code></pre>
<hr>
<h3>Сетевая безопасность</h3>
<h4>Изолированные сети</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  nginx:
    networks:
      - frontend-net
      - backend-net

  frontend:
    networks:
      - frontend-net  # Только frontend сеть

  backend:
    networks:
      - backend-net   # Только backend сеть
      - db-net        # Доступ к БД

  mysql:
    networks:
      - db-net        # Изолированная сеть для БД

  redis:
    networks:
      - backend-net

networks:
  frontend-net:
    driver: bridge
  backend-net:
    driver: bridge
    internal: true   # Нет доступа в интернет
  db-net:
    driver: bridge
    internal: true   # Полностью изолированная</code></pre>
<h4>Ограничение портов</h4>
<pre><code class="language-yaml"># docker-compose.prod.yml

services:
  nginx:
    ports:
      - "80:80"
      - "443:443"
    # Только nginx доступен извне

  backend:
    # НЕТ ports - доступ только через nginx
    expose:
      - "9000"

  mysql:
    # НЕТ ports - только внутренний доступ
    expose:
      - "3306"

  redis:
    # НЕТ ports
    expose:
      - "6379"</code></pre>
<h4>UFW Firewall на хосте</h4>
<pre><code class="language-bash"># Базовые правила
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH (измените порт если нужно)
sudo ufw allow 22/tcp

# HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Запретить доступ к Docker портам напрямую
# Docker по умолчанию обходит UFW!

# Включить
sudo ufw enable
sudo ufw status verbose</code></pre>
<h4>Исправление Docker + UFW</h4>
<pre><code class="language-bash"># /etc/docker/daemon.json

{
  "iptables": false
}

# Перезапустить Docker
sudo systemctl restart docker

# Или использовать DOCKER-USER chain
sudo iptables -I DOCKER-USER -i eth0 -j DROP
sudo iptables -I DOCKER-USER -i eth0 -p tcp --dport 80 -j ACCEPT
sudo iptables -I DOCKER-USER -i eth0 -p tcp --dport 443 -j ACCEPT</code></pre>
<hr>
<h3>SSL/TLS безопасность</h3>
<h4>Nginx SSL конфигурация</h4>
<pre><code class="language-nginx"># nginx/conf.d/ssl.conf

# Современные SSL настройки
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers off;

# Рекомендуемые шифры
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

# DH параметры
ssl_dhparam /etc/nginx/ssl/dhparam.pem;

# SSL сессии
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;
ssl_session_tickets off;

# OCSP Stapling
ssl_stapling on;
ssl_stapling_verify on;
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;</code></pre>
<pre><code class="language-bash"># Генерация DH параметров
openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096</code></pre>
<h4>Security Headers</h4>
<pre><code class="language-nginx"># nginx/conf.d/security-headers.conf

# Защита от clickjacking
add_header X-Frame-Options "SAMEORIGIN" always;

# Защита от MIME sniffing
add_header X-Content-Type-Options "nosniff" always;

# XSS защита
add_header X-XSS-Protection "1; mode=block" always;

# Referrer Policy
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://api.example.com;" always;

# HSTS (только для production с валидным SSL)
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

# Permissions Policy
add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;</code></pre>
<h4>Проверка SSL конфигурации</h4>
<pre><code class="language-bash"># Использование testssl.sh
docker run --rm -ti drwetter/testssl.sh https://example.com

# SSL Labs (онлайн)
# https://www.ssllabs.com/ssltest/

# Mozilla Observatory
# https://observatory.mozilla.org/</code></pre>
<hr>
<h3>Безопасность приложения</h3>
<h4>Laravel Security</h4>
<pre><code class="language-php">&lt;?php
// config/app.php

return [
    // Отключить debug в production
    'debug' =&gt; env('APP_DEBUG', false),

    // Скрыть версию Laravel
    'version' =&gt; '',
];</code></pre>
<pre><code class="language-php">&lt;?php
// app/Http/Middleware/SecurityHeaders.php

namespace App\Http\Middleware;

use Closure;

class SecurityHeaders
{
    public function handle($request, Closure $next)
    {
        $response = $next($request);

        $response-&gt;headers-&gt;set('X-Content-Type-Options', 'nosniff');
        $response-&gt;headers-&gt;set('X-Frame-Options', 'SAMEORIGIN');
        $response-&gt;headers-&gt;set('X-XSS-Protection', '1; mode=block');
        $response-&gt;headers-&gt;remove('X-Powered-By');
        $response-&gt;headers-&gt;remove('Server');

        return $response;
    }
}</code></pre>
<pre><code class="language-php">&lt;?php
// config/cors.php (Production)

return [
    'paths' =&gt; ['api/*'],
    'allowed_methods' =&gt; ['GET', 'POST', 'PUT', 'DELETE'],
    'allowed_origins' =&gt; [
        'https://example.com',
        'https://www.example.com',
    ],
    'allowed_origins_patterns' =&gt; [],
    'allowed_headers' =&gt; ['Content-Type', 'Authorization', 'X-Requested-With'],
    'exposed_headers' =&gt; [],
    'max_age' =&gt; 86400,
    'supports_credentials' =&gt; false,
];</code></pre>
<h4>Rate Limiting</h4>
<pre><code class="language-php">&lt;?php
// app/Providers/RouteServiceProvider.php

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Support\Facades\RateLimiter;

public function boot()
{
    // API rate limiting
    RateLimiter::for('api', function ($request) {
        return Limit::perMinute(60)-&gt;by($request-&gt;ip());
    });

    // Строгий лимит для auth
    RateLimiter::for('auth', function ($request) {
        return Limit::perMinute(5)-&gt;by($request-&gt;ip());
    });

    // Лимит для загрузки файлов
    RateLimiter::for('uploads', function ($request) {
        return Limit::perMinute(10)-&gt;by($request-&gt;ip());
    });
}</code></pre>
<pre><code class="language-nginx"># nginx/conf.d/rate-limit.conf

# Зоны rate limiting
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=auth:10m rate=1r/s;
limit_req_zone $binary_remote_addr zone=general:10m rate=30r/s;

# Применение к location
location /api {
    limit_req zone=api burst=20 nodelay;
    # ...
}

location /api/login {
    limit_req zone=auth burst=5 nodelay;
    # ...
}

location / {
    limit_req zone=general burst=50 nodelay;
    # ...
}</code></pre>
<hr>
<h3>Docker Daemon безопасность</h3>
<h4>/etc/docker/daemon.json</h4>
<pre><code class="language-json">{
  "icc": false,
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "live-restore": true,
  "userland-proxy": false,
  "no-new-privileges": true,
  "seccomp-profile": "/etc/docker/seccomp-profile.json",
  "storage-driver": "overlay2",
  "userns-remap": "default"
}</code></pre>
<pre><code class="language-bash"># Применить изменения
sudo systemctl restart docker

# Проверить конфигурацию
docker info</code></pre>
<h4>Аудит безопасности Docker</h4>
<pre><code class="language-bash"># Docker Bench Security
docker run --rm --net host --pid host --userns host --cap-add audit_control \
    -e DOCKER_CONTENT_TRUST=$DOCKER_CONTENT_TRUST \
    -v /etc:/etc:ro \
    -v /lib/systemd/system:/lib/systemd/system:ro \
    -v /usr/bin/containerd:/usr/bin/containerd:ro \
    -v /usr/bin/runc:/usr/bin/runc:ro \
    -v /usr/lib/systemd:/usr/lib/systemd:ro \
    -v /var/lib:/var/lib:ro \
    -v /var/run/docker.sock:/var/run/docker.sock:ro \
    --label docker_bench_security \
    docker/docker-bench-security</code></pre>
<hr>
<h3>Полный безопасный docker-compose.prod.yml</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  nginx:
    image: nginx:1.25-alpine
    container_name: app-nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./certbot/conf:/etc/letsencrypt:ro
      - ./certbot/www:/var/www/certbot:ro
      - backend-public:/var/www/backend/public:ro
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
      - CHOWN
      - SMyAppID
      - SETGID
    networks:
      - frontend-net
      - backend-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    healthcheck:
      test: ["CMD", "nginx", "-t"]
      interval: 30s
      timeout: 10s
      retries: 3

  backend:
    image: app-backend:${VERSION:-latest}
    container_name: app-backend
    restart: always
    read_only: true
    tmpfs:
      - /tmp
      - /var/run
    volumes:
      - backend-storage:/var/www/backend/storage
      - backend-cache:/var/www/backend/bootstrap/cache
    env_file:
      - .env.prod.secrets
    environment:
      APP_ENV: production
      APP_DEBUG: "false"
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SMyAppID
      - SETGID
    mem_limit: 512m
    cpus: 2
    networks:
      - backend-net
      - db-net
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_started
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "php", "-v"]
      interval: 30s
      timeout: 10s
      retries: 3

  frontend:
    image: app-frontend:${VERSION:-latest}
    container_name: app-frontend
    restart: always
    read_only: true
    tmpfs:
      - /tmp
    environment:
      NODE_ENV: production
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    mem_limit: 256m
    cpus: 1
    networks:
      - frontend-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('ok')"]
      interval: 30s
      timeout: 10s
      retries: 3

  mysql:
    image: mysql:8.0
    container_name: app-mysql
    restart: always
    env_file:
      - .env.prod.secrets
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf:ro
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SMyAppID
      - SETGID
      - DAC_OVERRIDE
    mem_limit: 1g
    cpus: 2
    networks:
      - db-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 30s
      timeout: 10s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: app-redis
    restart: always
    command: redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis-data:/data
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    mem_limit: 128m
    cpus: 0.5
    networks:
      - backend-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  frontend-net:
    driver: bridge
  backend-net:
    driver: bridge
    internal: true
  db-net:
    driver: bridge
    internal: true

volumes:
  mysql-data:
  redis-data:
  backend-storage:
  backend-cache:
  backend-public:</code></pre>
<hr>
<h3>Чек-лист безопасности</h3>
<h4>Контейнеры</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Запуск от непривилегированного пользователя (USER)</li>
<li class="checklist"><input type="checkbox" disabled> Отключены лишние capabilities (cap_drop: ALL)</li>
<li class="checklist"><input type="checkbox" disabled> Включен no-new-privileges</li>
<li class="checklist"><input type="checkbox" disabled> Read-only файловая система где возможно</li>
<li class="checklist"><input type="checkbox" disabled> Установлены лимиты ресурсов (memory, cpu)</li>
</ul>
<h4>Образы</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Используются официальные базовые образы</li>
<li class="checklist"><input type="checkbox" disabled> Версии образов зафиксированы</li>
<li class="checklist"><input type="checkbox" disabled> Настроен .dockerignore</li>
<li class="checklist"><input type="checkbox" disabled> Регулярное сканирование на уязвимости</li>
<li class="checklist"><input type="checkbox" disabled> Multi-stage builds для минимизации размера</li>
</ul>
<h4>Сеть</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Изолированные сети для разных компонентов</li>
<li class="checklist"><input type="checkbox" disabled> Только nginx доступен извне</li>
<li class="checklist"><input type="checkbox" disabled> Настроен firewall на хосте</li>
<li class="checklist"><input type="checkbox" disabled> Internal networks для БД</li>
</ul>
<h4>Секреты</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Секреты не в docker-compose.yml</li>
<li class="checklist"><input type="checkbox" disabled> .env.secrets не в git</li>
<li class="checklist"><input type="checkbox" disabled> Используются Docker secrets или Vault</li>
</ul>
<h4>SSL/TLS</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Только TLS 1.2/1.3</li>
<li class="checklist"><input type="checkbox" disabled> Сильные шифры</li>
<li class="checklist"><input type="checkbox" disabled> HSTS включен</li>
<li class="checklist"><input type="checkbox" disabled> Регулярное обновление сертификатов</li>
</ul>
<h4>Приложение</h4>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Security headers настроены</li>
<li class="checklist"><input type="checkbox" disabled> CORS ограничен</li>
<li class="checklist"><input type="checkbox" disabled> Rate limiting включен</li>
<li class="checklist"><input type="checkbox" disabled> APP_DEBUG=false в production</li>
</ul>
<hr>
<h2>Мониторинг и Логирование</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      СТЕК МОНИТОРИНГА                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│   │   COLLECT   │  │   STORE     │  │  VISUALIZE  │                    │
│   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                    │
│          │                │                │                            │
│          ▼                ▼                ▼                            │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│   │ Promtail    │  │ Loki        │  │ Grafana     │   ← Логи           │
│   │ Filebeat    │  │ Elastic     │  │ Kibana      │                    │
│   └─────────────┘  └─────────────┘  └─────────────┘                    │
│                                                                         │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│   │ Prometheus  │  │ Prometheus  │  │ Grafana     │   ← Метрики        │
│   │ Exporters   │  │ TSDB        │  │ Dashboards  │                    │
│   └─────────────┘  └─────────────┘  └─────────────┘                    │
│                                                                         │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│   │ Healthcheck │  │ Alertmanager│  │ Telegram    │   ← Алерты         │
│   │ Probes      │  │ Rules       │  │ Slack/Email │                    │
│   └─────────────┘  └─────────────┘  └─────────────┘                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h3>Docker Logging</h3>
<h4>Настройка драйвера логов</h4>
<pre><code class="language-yaml"># docker-compose.yml

services:
  backend:
    # ... остальная конфигурация
    logging:
      driver: "json-file"
      options:
        max-size: "10m"      # Максимальный размер файла
        max-file: "5"        # Количество файлов ротации
        labels: "service"
        tag: "{{.Name}}/{{.ID}}"

  frontend:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  nginx:
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"</code></pre>
<h4>Просмотр логов</h4>
<pre><code class="language-bash"># Логи всех сервисов
docker compose logs

# Логи конкретного сервиса
docker compose logs backend

# Последние 100 строк
docker compose logs --tail=100 backend

# В реальном времени
docker compose logs -f backend

# С временными метками
docker compose logs -t backend

# Несколько сервисов
docker compose logs -f backend frontend nginx

# Фильтрация по времени
docker compose logs --since="2024-01-01T00:00:00" backend
docker compose logs --since="1h" backend  # За последний час</code></pre>
<hr>
<h3>Prometheus + Grafana (Метрики)</h3>
<h4>docker-compose.monitoring.yml</h4>
<pre><code class="language-yaml">version: '3.8'

services:
  # ===========================================
  # Prometheus - Сбор метрик
  # ===========================================
  prometheus:
    image: prom/prometheus:latest
    container_name: app-prometheus
    restart: unless-stopped
    volumes:
      - ./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - ./monitoring/prometheus/rules:/etc/prometheus/rules:ro
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'
      - '--web.enable-lifecycle'
    ports:
      - "9090:9090"
    networks:
      - app-network
      - monitoring

  # ===========================================
  # Grafana - Визуализация
  # ===========================================
  grafana:
    image: grafana/grafana:latest
    container_name: app-grafana
    restart: unless-stopped
    environment:
      GF_SECURITY_ADMIN_USER: ${GRAFANA_USER:-admin}
      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD:-admin}
      GF_USERS_ALLOW_SIGN_UP: "false"
      GF_SERVER_ROOT_URL: https://monitoring.example.com
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning:ro
      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards:ro
    ports:
      - "3001:3000"
    depends_on:
      - prometheus
    networks:
      - app-network
      - monitoring

  # ===========================================
  # Node Exporter - Метрики хоста
  # ===========================================
  node-exporter:
    image: prom/node-exporter:latest
    container_name: app-node-exporter
    restart: unless-stopped
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--path.rootfs=/rootfs'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    ports:
      - "9100:9100"
    networks:
      - monitoring

  # ===========================================
  # cAdvisor - Метрики контейнеров
  # ===========================================
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: app-cadvisor
    restart: unless-stopped
    privileged: true
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
      - /dev/disk/:/dev/disk:ro
    ports:
      - "8081:8080"
    networks:
      - monitoring

  # ===========================================
  # MySQL Exporter
  # ===========================================
  mysql-exporter:
    image: prom/mysqld-exporter:latest
    container_name: app-mysql-exporter
    restart: unless-stopped
    environment:
      DATA_SOURCE_NAME: "exporter:${MYSQL_EXPORTER_PASSWORD}@(mysql:3306)/"
    ports:
      - "9104:9104"
    depends_on:
      - mysql
    networks:
      - app-network
      - monitoring

  # ===========================================
  # Redis Exporter
  # ===========================================
  redis-exporter:
    image: oliver006/redis_exporter:latest
    container_name: app-redis-exporter
    restart: unless-stopped
    environment:
      REDIS_ADDR: "redis:6379"
    ports:
      - "9121:9121"
    depends_on:
      - redis
    networks:
      - app-network
      - monitoring

  # ===========================================
  # Nginx Exporter
  # ===========================================
  nginx-exporter:
    image: nginx/nginx-prometheus-exporter:latest
    container_name: app-nginx-exporter
    restart: unless-stopped
    command:
      - '-nginx.scrape-uri=http://nginx:80/nginx_status'
    ports:
      - "9113:9113"
    depends_on:
      - nginx
    networks:
      - app-network
      - monitoring

  # ===========================================
  # Alertmanager - Уведомления
  # ===========================================
  alertmanager:
    image: prom/alertmanager:latest
    container_name: app-alertmanager
    restart: unless-stopped
    volumes:
      - ./monitoring/alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml:ro
      - alertmanager-data:/alertmanager
    command:
      - '--config.file=/etc/alertmanager/alertmanager.yml'
      - '--storage.path=/alertmanager'
    ports:
      - "9093:9093"
    networks:
      - monitoring

networks:
  monitoring:
    driver: bridge

volumes:
  prometheus-data:
  grafana-data:
  alertmanager-data:</code></pre>
<h4>monitoring/prometheus/prometheus.yml</h4>
<pre><code class="language-yaml">global:
  scrape_interval: 15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

rule_files:
  - /etc/prometheus/rules/*.yml

scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Node Exporter (Host metrics)
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']

  # cAdvisor (Container metrics)
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']

  # MySQL
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redis
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']

  # Nginx
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx-exporter:9113']

  # Laravel application (custom metrics)
  - job_name: 'laravel'
    metrics_path: /api/metrics
    static_configs:
      - targets: ['nginx:80']
    scheme: http</code></pre>
<h4>monitoring/prometheus/rules/alerts.yml</h4>
<pre><code class="language-yaml">groups:
  - name: app-alerts
    rules:
      # ===========================================
      # Доступность сервисов
      # ===========================================
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Сервис {{ $labels.job }} недоступен"
          description: "Сервис {{ $labels.instance }} не отвечает более 1 минуты"

      # ===========================================
      # CPU
      # ===========================================
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) &gt; 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Высокая загрузка CPU ({{ $value }}%)"
          description: "CPU загружен более 80% на протяжении 5 минут"

      - alert: CriticalCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) &gt; 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Критическая загрузка CPU ({{ $value }}%)"

      # ===========================================
      # Memory
      # ===========================================
      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 &gt; 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Высокое использование памяти ({{ $value }}%)"

      - alert: CriticalMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 &gt; 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Критическое использование памяти ({{ $value }}%)"

      # ===========================================
      # Disk
      # ===========================================
      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes) * 100 &lt; 20
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Мало места на диске ({{ $value }}% свободно)"
          description: "На диске {{ $labels.mountpoint }} осталось менее 20% места"

      - alert: DiskSpaceCritical
        expr: (node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes) * 100 &lt; 10
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Критически мало места на диске ({{ $value }}% свободно)"

      # ===========================================
      # Container
      # ===========================================
      - alert: ContainerHighCPU
        expr: (sum(rate(container_cpu_usage_seconds_total{name!=""}[3m])) BY (name) * 100) &gt; 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Контейнер {{ $labels.name }} использует много CPU ({{ $value }}%)"

      - alert: ContainerHighMemory
        expr: (container_memory_usage_bytes{name!=""} / container_spec_memory_limit_bytes{name!=""}) * 100 &gt; 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Контейнер {{ $labels.name }} использует много памяти ({{ $value }}%)"

      - alert: ContainerRestarting
        expr: increase(container_restart_count{name!=""}[1h]) &gt; 3
        labels:
          severity: warning
        annotations:
          summary: "Контейнер {{ $labels.name }} перезапускается слишком часто"

      # ===========================================
      # MySQL
      # ===========================================
      - alert: MySQLDown
        expr: mysql_up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MySQL недоступен"

      - alert: MySQLTooManyConnections
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections &gt; 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL: много подключений ({{ $value }}%)"

      - alert: MySQLSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) &gt; 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL: много медленных запросов"

      # ===========================================
      # Redis
      # ===========================================
      - alert: RedisDown
        expr: redis_up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Redis недоступен"

      - alert: RedisHighMemory
        expr: redis_memory_used_bytes / redis_memory_max_bytes &gt; 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis использует много памяти ({{ $value }}%)"

      # ===========================================
      # HTTP / Application
      # ===========================================
      - alert: HighErrorRate
        expr: sum(rate(nginx_http_requests_total{status=~"5.."}[5m])) / sum(rate(nginx_http_requests_total[5m])) &gt; 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Высокий процент ошибок ({{ $value }}%)"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, sum(rate(nginx_http_request_duration_seconds_bucket[5m])) by (le)) &gt; 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Высокое время ответа (p95 = {{ $value }}s)"</code></pre>
<h4>monitoring/alertmanager/alertmanager.yml</h4>
<pre><code class="language-yaml">global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'severity']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'telegram'

  routes:
    - match:
        severity: critical
      receiver: 'telegram'
      repeat_interval: 15m

    - match:
        severity: warning
      receiver: 'telegram'
      repeat_interval: 1h

receivers:
  - name: 'telegram'
    telegram_configs:
      - bot_token: 'YOUR_BOT_TOKEN'
        chat_id: YOUR_CHAT_ID
        api_url: 'https://api.telegram.org'
        parse_mode: 'HTML'
        message: |
          {{ range .Alerts }}
          &lt;b&gt;{{ .Status | toUpper }}&lt;/b&gt;: {{ .Labels.alertname }}
          &lt;b&gt;Severity:&lt;/b&gt; {{ .Labels.severity }}
          &lt;b&gt;Summary:&lt;/b&gt; {{ .Annotations.summary }}
          &lt;b&gt;Description:&lt;/b&gt; {{ .Annotations.description }}
          {{ end }}

  - name: 'slack'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts'
        send_resolved: true
        title: '{{ .Status | toUpper }}: {{ .CommonLabels.alertname }}'
        text: '{{ .CommonAnnotations.summary }}'

  - name: 'email'
    email_configs:
      - to: 'admin@example.com'
        from: 'alertmanager@example.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'your@gmail.com'
        auth_password: 'your-app-password'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname']</code></pre>
<hr>
<h3>Loki + Promtail (Логи)</h3>
<h4>Добавить в docker-compose.monitoring.yml</h4>
<pre><code class="language-yaml">services:
  # ===========================================
  # Loki - Хранение логов
  # ===========================================
  loki:
    image: grafana/loki:latest
    container_name: app-loki
    restart: unless-stopped
    volumes:
      - ./monitoring/loki/loki-config.yml:/etc/loki/local-config.yaml:ro
      - loki-data:/loki
    command: -config.file=/etc/loki/local-config.yaml
    ports:
      - "3100:3100"
    networks:
      - monitoring

  # ===========================================
  # Promtail - Сбор логов
  # ===========================================
  promtail:
    image: grafana/promtail:latest
    container_name: app-promtail
    restart: unless-stopped
    volumes:
      - ./monitoring/promtail/promtail-config.yml:/etc/promtail/config.yml:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/log:/var/log:ro
    command: -config.file=/etc/promtail/config.yml
    depends_on:
      - loki
    networks:
      - monitoring
      - app-network

volumes:
  loki-data:</code></pre>
<h4>monitoring/loki/loki-config.yml</h4>
<pre><code class="language-yaml">auth_enabled: false

server:
  http_listen_port: 3100

ingester:
  lifecycler:
    address: 127.0.0.1
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 5m
  chunk_retain_period: 30s

schema_config:
  configs:
    - from: 2020-10-24
      store: boltdb-shipper
      object_store: filesystem
      schema: v11
      index:
        prefix: index_
        period: 24h

storage_config:
  boltdb_shipper:
    active_index_directory: /loki/index
    cache_location: /loki/cache
    shared_store: filesystem
  filesystem:
    directory: /loki/chunks

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h  # 7 days

chunk_store_config:
  max_look_back_period: 0s

table_manager:
  retention_deletes_enabled: true
  retention_period: 720h  # 30 days</code></pre>
<h4>monitoring/promtail/promtail-config.yml</h4>
<pre><code class="language-yaml">server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  # Docker container logs
  - job_name: docker
    static_configs:
      - targets:
          - localhost
        labels:
          job: docker
          __path__: /var/lib/docker/containers/*/*-json.log

    pipeline_stages:
      - json:
          expressions:
            stream: stream
            log: log
            time: time
            attrs: attrs
      - labels:
          stream:
      - timestamp:
          source: time
          format: RFC3339Nano
      - output:
          source: log

  # Laravel logs
  - job_name: laravel
    static_configs:
      - targets:
          - localhost
        labels:
          job: laravel
          __path__: /var/log/laravel/*.log

    pipeline_stages:
      - multiline:
          firstline: '^\[\d{4}-\d{2}-\d{2}'
          max_wait_time: 3s
      - regex:
          expression: '^\[(?P&lt;timestamp&gt;\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\] (?P&lt;env&gt;\w+)\.(?P&lt;level&gt;\w+): (?P&lt;message&gt;.*)'
      - labels:
          level:
          env:
      - timestamp:
          source: timestamp
          format: '2006-01-02 15:04:05'

  # Nginx access logs
  - job_name: nginx-access
    static_configs:
      - targets:
          - localhost
        labels:
          job: nginx
          type: access
          __path__: /var/log/nginx/access.log

    pipeline_stages:
      - regex:
          expression: '^(?P&lt;remote_addr&gt;[\d.]+) - (?P&lt;remote_user&gt;\S+) \[(?P&lt;time_local&gt;[^\]]+)\] "(?P&lt;request&gt;[^"]+)" (?P&lt;status&gt;\d+) (?P&lt;body_bytes_sent&gt;\d+) "(?P&lt;http_referer&gt;[^"]*)" "(?P&lt;http_user_agent&gt;[^"]*)"'
      - labels:
          status:
          remote_addr:

  # Nginx error logs
  - job_name: nginx-error
    static_configs:
      - targets:
          - localhost
        labels:
          job: nginx
          type: error
          __path__: /var/log/nginx/error.log</code></pre>
<hr>
<h3>Laravel Logging</h3>
<h4>config/logging.php</h4>
<pre><code class="language-php">&lt;?php

return [
    'default' =&gt; env('LOG_CHANNEL', 'stack'),

    'channels' =&gt; [
        'stack' =&gt; [
            'driver' =&gt; 'stack',
            'channels' =&gt; ['daily', 'stderr'],
            'ignore_exceptions' =&gt; false,
        ],

        'daily' =&gt; [
            'driver' =&gt; 'daily',
            'path' =&gt; storage_path('logs/laravel.log'),
            'level' =&gt; env('LOG_LEVEL', 'debug'),
            'days' =&gt; 14,
        ],

        'stderr' =&gt; [
            'driver' =&gt; 'monolog',
            'level' =&gt; env('LOG_LEVEL', 'debug'),
            'handler' =&gt; StreamHandler::class,
            'formatter' =&gt; env('LOG_STDERR_FORMATTER'),
            'with' =&gt; [
                'stream' =&gt; 'php://stderr',
            ],
        ],

        // JSON формат для Loki/ELK
        'json' =&gt; [
            'driver' =&gt; 'daily',
            'path' =&gt; storage_path('logs/laravel-json.log'),
            'level' =&gt; 'debug',
            'days' =&gt; 7,
            'formatter' =&gt; \Monolog\Formatter\JsonFormatter::class,
        ],
    ],
];</code></pre>
<h4>app/Http/Middleware/LogRequests.php</h4>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;

class LogRequests
{
    public function handle(Request $request, Closure $next)
    {
        $startTime = microtime(true);

        $response = $next($request);

        $duration = round((microtime(true) - $startTime) * 1000, 2);

        Log::channel('json')-&gt;info('HTTP Request', [
            'method' =&gt; $request-&gt;method(),
            'url' =&gt; $request-&gt;fullUrl(),
            'status' =&gt; $response-&gt;getStatusCode(),
            'duration_ms' =&gt; $duration,
            'ip' =&gt; $request-&gt;ip(),
            'user_agent' =&gt; $request-&gt;userAgent(),
            'user_id' =&gt; auth()-&gt;id(),
        ]);

        return $response;
    }
}</code></pre>
<h4>Prometheus Metrics Endpoint</h4>
<pre><code class="language-php">&lt;?php
// routes/api.php

use Prometheus\CollectorRegistry;
use Prometheus\RenderTextFormat;
use Prometheus\Storage\Redis;

Route::get('/metrics', function () {
    $adapter = new Redis([
        'host' =&gt; env('REDIS_HOST', 'redis'),
        'port' =&gt; env('REDIS_PORT', 6379),
    ]);

    $registry = new CollectorRegistry($adapter);

    // Request counter
    $counter = $registry-&gt;getOrRegisterCounter(
        'myapp',
        'http_requests_total',
        'Total HTTP requests',
        ['method', 'endpoint', 'status']
    );

    // Response time histogram
    $histogram = $registry-&gt;getOrRegisterHistogram(
        'myapp',
        'http_request_duration_seconds',
        'HTTP request duration',
        ['method', 'endpoint'],
        [0.01, 0.05, 0.1, 0.5, 1, 2, 5]
    );

    $renderer = new RenderTextFormat();
    $result = $renderer-&gt;render($registry-&gt;getMetricFamilySamples());

    return response($result, 200)
        -&gt;header('Content-Type', RenderTextFormat::MIME_TYPE);
});</code></pre>
<hr>
<h3>Grafana Dashboards</h3>
<h4>monitoring/grafana/provisioning/datasources/datasources.yml</h4>
<pre><code class="language-yaml">apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true

  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100</code></pre>
<h4>Полезные запросы для Grafana</h4>
<pre><code class="language-promql"># CPU Usage по контейнерам
sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) by (name) * 100

# Memory Usage по контейнерам
container_memory_usage_bytes{name!=""} / 1024 / 1024

# Запросы в секунду (Nginx)
sum(rate(nginx_http_requests_total[5m])) by (status)

# Ошибки 5xx
sum(rate(nginx_http_requests_total{status=~"5.."}[5m]))

# MySQL Queries per second
rate(mysql_global_status_queries[5m])

# Redis Memory
redis_memory_used_bytes / 1024 / 1024

# Disk Usage
100 - ((node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes) * 100)</code></pre>
<h4>LogQL запросы для Loki</h4>
<pre><code class="language-logql"># Все логи Laravel
{job="laravel"}

# Ошибки Laravel
{job="laravel"} |= "ERROR"

# Nginx 5xx ошибки
{job="nginx", type="access"} | json | status &gt;= 500

# Поиск по тексту
{job="laravel"} |~ "(?i)exception"

# Медленные запросы (&gt; 1s)
{job="laravel"} | json | duration_ms &gt; 1000

# Запросы конкретного пользователя
{job="laravel"} | json | user_id = "123"

# Статистика по статус-кодам
sum by (status) (count_over_time({job="nginx"}[5m] | json))</code></pre>
<hr>
<h3>Health Check API</h3>
<h4>backend/routes/api.php</h4>
<pre><code class="language-php">&lt;?php

Route::get('/health', function () {
    $checks = [];
    $healthy = true;

    // Database check
    try {
        DB::connection()-&gt;getPdo();
        $checks['database'] = [
            'status' =&gt; 'ok',
            'latency_ms' =&gt; round((microtime(true) - LARAVEL_START) * 1000, 2)
        ];
    } catch (\Exception $e) {
        $checks['database'] = ['status' =&gt; 'error', 'message' =&gt; $e-&gt;getMessage()];
        $healthy = false;
    }

    // Redis check
    try {
        $start = microtime(true);
        Cache::store('redis')-&gt;put('health_check', true, 10);
        Cache::store('redis')-&gt;get('health_check');
        $checks['redis'] = [
            'status' =&gt; 'ok',
            'latency_ms' =&gt; round((microtime(true) - $start) * 1000, 2)
        ];
    } catch (\Exception $e) {
        $checks['redis'] = ['status' =&gt; 'error', 'message' =&gt; $e-&gt;getMessage()];
        $healthy = false;
    }

    // Disk check
    $diskFree = disk_free_space('/');
    $diskTotal = disk_total_space('/');
    $diskUsedPercent = round((1 - $diskFree / $diskTotal) * 100, 2);
    $checks['disk'] = [
        'status' =&gt; $diskUsedPercent &lt; 90 ? 'ok' : 'warning',
        'used_percent' =&gt; $diskUsedPercent,
        'free_gb' =&gt; round($diskFree / 1024 / 1024 / 1024, 2)
    ];

    // Memory check
    $memInfo = [];
    if (is_readable('/proc/meminfo')) {
        $data = file_get_contents('/proc/meminfo');
        preg_match_all('/^(\w+):\s+(\d+)/m', $data, $matches, PREG_SET_ORDER);
        foreach ($matches as $match) {
            $memInfo[$match[1]] = (int)$match[2];
        }
        $memUsedPercent = round((1 - $memInfo['MemAvailable'] / $memInfo['MemTotal']) * 100, 2);
        $checks['memory'] = [
            'status' =&gt; $memUsedPercent &lt; 90 ? 'ok' : 'warning',
            'used_percent' =&gt; $memUsedPercent
        ];
    }

    return response()-&gt;json([
        'status' =&gt; $healthy ? 'healthy' : 'unhealthy',
        'timestamp' =&gt; now()-&gt;toISOString(),
        'version' =&gt; config('app.version', '1.0.0'),
        'checks' =&gt; $checks
    ], $healthy ? 200 : 503);
});

Route::get('/health/live', fn() =&gt; response('OK', 200));
Route::get('/health/ready', function () {
    try {
        DB::connection()-&gt;getPdo();
        return response('OK', 200);
    } catch (\Exception $e) {
        return response('NOT READY', 503);
    }
});</code></pre>
<hr>
<h3>Запуск мониторинга</h3>
<pre><code class="language-bash"># Запуск всего стека мониторинга
docker compose -f docker-compose.yml -f docker-compose.monitoring.yml up -d

# Проверка статуса
docker compose -f docker-compose.yml -f docker-compose.monitoring.yml ps

# Доступ к сервисам:
# - Grafana:      http://localhost:3001 (admin/admin)
# - Prometheus:   http://localhost:9090
# - Alertmanager: http://localhost:9093
# - Loki:         http://localhost:3100

# Проверить targets в Prometheus
curl http://localhost:9090/api/v1/targets

# Проверить алерты
curl http://localhost:9090/api/v1/alerts</code></pre>
<hr>
<h3>Чек-лист мониторинга</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Настроен сбор логов (json-file driver)</li>
<li class="checklist"><input type="checkbox" disabled> Развёрнут Prometheus</li>
<li class="checklist"><input type="checkbox" disabled> Настроены exporters (node, cadvisor, mysql, redis, nginx)</li>
<li class="checklist"><input type="checkbox" disabled> Развёрнут Grafana с дашбордами</li>
<li class="checklist"><input type="checkbox" disabled> Настроен Alertmanager с уведомлениями</li>
<li class="checklist"><input type="checkbox" disabled> Развёрнут Loki + Promtail для логов</li>
<li class="checklist"><input type="checkbox" disabled> Настроен health check endpoint</li>
<li class="checklist"><input type="checkbox" disabled> Созданы правила алертов</li>
<li class="checklist"><input type="checkbox" disabled> Настроена ротация логов</li>
</ul>
<hr>
<h2>Troubleshooting (Частые ошибки)</h2>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      ДИАГНОСТИКА ПРОБЛЕМ                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   1. Проверить логи:     docker compose logs -f [service]              │
│   2. Проверить статус:   docker compose ps                             │
│   3. Войти в контейнер:  docker compose exec [service] sh              │
│   4. Перезапустить:      docker compose restart [service]              │
│   5. Пересобрать:        docker compose build --no-cache [service]     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h3>Docker & Docker Compose</h3>
<h4>Ошибка: "Cannot connect to the Docker daemon"</h4>
<pre><code class="language-bash"># Причина: Docker daemon не запущен

# Решение (Linux):
sudo systemctl start docker
sudo systemctl enable docker

# Проверка:
docker info</code></pre>
<h4>Ошибка: "Permission denied while trying to connect to Docker"</h4>
<pre><code class="language-bash"># Причина: пользователь не в группе docker

# Решение:
sudo usermod -aG docker $USER
newgrp docker

# Или перелогиниться</code></pre>
<h4>Ошибка: "port is already allocated"</h4>
<pre><code class="language-bash"># Причина: порт уже занят другим процессом

# Найти процесс:
sudo lsof -i :80
sudo lsof -i :3306

# Остановить процесс:
sudo kill -9 &lt;PID&gt;

# Или изменить порт в docker-compose.yml:
ports:
  - "8080:80"  # вместо 80:80</code></pre>
<h4>Ошибка: "no space left on device"</h4>
<pre><code class="language-bash"># Причина: закончилось место на диске

# Очистка Docker:
docker system prune -a --volumes

# Удалить неиспользуемые образы:
docker image prune -a

# Удалить остановленные контейнеры:
docker container prune

# Удалить неиспользуемые volumes:
docker volume prune

# Проверить использование:
docker system df</code></pre>
<h4>Ошибка: "network not found"</h4>
<pre><code class="language-bash"># Причина: сеть была удалена или не создана

# Решение:
docker compose down
docker compose up -d

# Или создать сеть вручную:
docker network create app-network</code></pre>
<hr>
<h3>Laravel (Backend)</h3>
<h4>Ошибка: "SQLSTATE[HY000] [2002] Connection refused"</h4>
<pre><code class="language-bash"># Причина: Laravel не может подключиться к MySQL

# Проверить что MySQL запущен:
docker compose ps mysql

# Проверить переменные в .env:
DB_HOST=mysql          # НЕ localhost, а имя сервиса!
DB_PORT=3306
DB_DATABASE=myapp
DB_USERNAME=app_user
DB_PASSWORD=secret_password

# Проверить healthcheck MySQL:
docker compose logs mysql

# Подождать пока MySQL полностью запустится:
docker compose exec mysql mysqladmin ping -h localhost -u root -p</code></pre>
<h4>Ошибка: "The stream or file could not be opened: Permission denied"</h4>
<pre><code class="language-bash"># Причина: неправильные права на storage/logs

# Решение внутри контейнера:
docker compose exec backend chmod -R 775 storage bootstrap/cache
docker compose exec backend chown -R www-data:www-data storage bootstrap/cache

# Или в Dockerfile добавить:
RUN chown -R www-data:www-data /var/www/backend/storage</code></pre>
<h4>Ошибка: "Class not found" после деплоя</h4>
<pre><code class="language-bash"># Причина: autoload не обновлён

# Решение:
docker compose exec backend composer dump-autoload
docker compose exec backend php artisan clear-compiled
docker compose exec backend php artisan optimize:clear</code></pre>
<h4>Ошибка: "419 Page Expired" (CSRF)</h4>
<pre><code class="language-bash"># Причина: проблема с сессиями или CSRF токеном

# Для API - отключить CSRF для api routes (уже сделано по умолчанию)
# Проверить app/Http/Middleware/VerifyCsrfToken.php:

protected $except = [
    'api/*',
];

# Очистить кэш:
docker compose exec backend php artisan cache:clear
docker compose exec backend php artisan config:clear</code></pre>
<h4>Ошибка: "Maximum execution time exceeded"</h4>
<pre><code class="language-bash"># Причина: долгий запрос превышает лимит

# Решение в php.ini:
max_execution_time = 300

# Или в docker/php.ini:
[PHP]
max_execution_time = 300

# Перезапустить:
docker compose restart backend</code></pre>
<hr>
<h3>Nuxt (Frontend)</h3>
<h4>Ошибка: "ECONNREFUSED" при запросах к API</h4>
<pre><code class="language-bash"># Причина: неправильный API URL или backend недоступен

# Проверить переменную окружения:
NUXT_PUBLIC_API_BASE=http://backend:9000/api  # Для SSR внутри Docker
# или
NUXT_PUBLIC_API_BASE=http://api.app.local/api  # Через Nginx

# Проверить что backend работает:
docker compose exec frontend curl http://backend:9000/api/health

# В nuxt.config.ts для SSR:
runtimeConfig: {
  public: {
    apiBase: process.env.NUXT_PUBLIC_API_BASE || 'http://nginx/api'
  }
}</code></pre>
<h4>Ошибка: "FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed"</h4>
<pre><code class="language-bash"># Причина: недостаточно памяти для Node.js

# Решение - увеличить лимит памяти:
# В Dockerfile или docker-compose.yml:
environment:
  NODE_OPTIONS: "--max-old-space-size=4096"

# Или в package.json:
"scripts": {
  "build": "NODE_OPTIONS='--max-old-space-size=4096' nuxt build"
}</code></pre>
<h4>Ошибка: HMR (Hot Module Replacement) не работает</h4>
<pre><code class="language-bash"># Причина: WebSocket соединение блокируется

# 1. Проверить что порт 24678 проброшен:
ports:
  - "24678:24678"

# 2. В nuxt.config.ts:
vite: {
  server: {
    hmr: {
      protocol: 'ws',
      host: 'localhost',
      port: 24678
    }
  }
}

# 3. В nginx добавить поддержку WebSocket:
location /_nuxt/ {
    proxy_pass http://frontend:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}</code></pre>
<h4>Ошибка: "Cannot find module" при билде</h4>
<pre><code class="language-bash"># Причина: node_modules не синхронизированы

# Решение:
docker compose exec frontend rm -rf node_modules .nuxt .output
docker compose exec frontend npm ci
docker compose exec frontend npm run build

# Или пересобрать контейнер:
docker compose build --no-cache frontend</code></pre>
<hr>
<h3>Nginx</h3>
<h4>Ошибка: "502 Bad Gateway"</h4>
<pre><code class="language-bash"># Причина: upstream сервис недоступен

# Проверить что backend/frontend работают:
docker compose ps

# Проверить логи nginx:
docker compose logs nginx

# Проверить что имена сервисов правильные в конфиге:
# nginx/conf.d/backend.conf
fastcgi_pass backend:9000;  # имя сервиса из docker-compose

# nginx/conf.d/frontend.conf
proxy_pass http://frontend:3000;  # имя сервиса из docker-compose

# Перезагрузить nginx:
docker compose exec nginx nginx -s reload</code></pre>
<h4>Ошибка: "413 Request Entity Too Large"</h4>
<pre><code class="language-bash"># Причина: файл превышает лимит загрузки

# В nginx.conf или server block:
client_max_body_size 100M;

# В php.ini:
upload_max_filesize = 100M
post_max_size = 100M

# Перезапустить:
docker compose restart nginx backend</code></pre>
<h4>Ошибка: "SSL: error:0A000086:SSL routines::certificate verify failed"</h4>
<pre><code class="language-bash"># Причина: проблема с SSL сертификатом

# Проверить сертификаты:
docker compose exec nginx ls -la /etc/letsencrypt/live/

# Проверить срок действия:
docker compose exec nginx openssl x509 -enddate -noout -in /etc/letsencrypt/live/example.com/fullchain.pem

# Обновить сертификат:
docker compose run --rm certbot renew

# Перезагрузить nginx:
docker compose exec nginx nginx -s reload</code></pre>
<hr>
<h3>MySQL</h3>
<h4>Ошибка: "Access denied for user"</h4>
<pre><code class="language-bash"># Причина: неправильные credentials

# Проверить переменные в .env:
DB_USERNAME=app_user
DB_PASSWORD=secret_password

# Войти как root и проверить пользователя:
docker compose exec mysql mysql -u root -p

# В MySQL:
SELECT user, host FROM mysql.user;
SHOW GRANTS FOR 'app_user'@'%';

# Пересоздать пользователя:
DROP USER IF EXISTS 'app_user'@'%';
CREATE USER 'app_user'@'%' IDENTIFIED BY 'secret_password';
GRANT ALL PRIVILEGES ON etu.* TO 'app_user'@'%';
FLUSH PRIVILEGES;</code></pre>
<h4>Ошибка: "MySQL server has gone away"</h4>
<pre><code class="language-bash"># Причина: соединение разорвано из-за таймаута или большого пакета

# В mysql/my.cnf:
[mysqld]
wait_timeout = 600
interactive_timeout = 600
max_allowed_packet = 256M

# Перезапустить MySQL:
docker compose restart mysql</code></pre>
<h4>Ошибка: "Table doesn't exist" после миграций</h4>
<pre><code class="language-bash"># Причина: миграции не применились

# Проверить статус миграций:
docker compose exec backend php artisan migrate:status

# Запустить миграции:
docker compose exec backend php artisan migrate --force

# Если нужно откатить и заново:
docker compose exec backend php artisan migrate:fresh --seed
# ⚠️ ВНИМАНИЕ: удалит все данные!</code></pre>
<hr>
<h3>CI/CD</h3>
<h4>Ошибка: "Permission denied (publickey)" при SSH деплое</h4>
<pre><code class="language-bash"># Причина: SSH ключ не настроен или неправильный

# 1. Сгенерировать ключ (если нет):
ssh-keygen -t ed25519 -C "deploy@example.com"

# 2. Добавить публичный ключ на сервер:
ssh-copy-id -i ~/.ssh/id_ed25519.pub deploy@your-server.com

# 3. Добавить приватный ключ в GitHub Secrets:
# Settings → Secrets → PROD_SSH_KEY
# Скопировать содержимое ~/.ssh/id_ed25519

# 4. Проверить подключение:
ssh -i ~/.ssh/id_ed25519 deploy@your-server.com</code></pre>
<h4>Ошибка: "docker: command not found" в CI/CD</h4>
<pre><code class="language-bash"># Причина: Docker не установлен в runner

# GitHub Actions - использовать правильный runner:
runs-on: ubuntu-latest

# Или установить Docker:
- name: Install Docker
  run: |
    curl -fsSL https://get.docker.com | sh</code></pre>
<h4>Ошибка: "Rate limit exceeded" при pull образов</h4>
<pre><code class="language-bash"># Причина: лимит Docker Hub

# Решение 1 - залогиниться:
- name: Login to Docker Hub
  uses: docker/login-action@v3
  with:
    username: ${{ secrets.DOCKERHUB_USERNAME }}
    password: ${{ secrets.DOCKERHUB_TOKEN }}

# Решение 2 - использовать GitHub Container Registry:
image: ghcr.io/your-org/your-image:latest</code></pre>
<h4>Ошибка: Health check failed после деплоя</h4>
<pre><code class="language-bash"># Причина: приложение не успело запуститься

# Увеличить таймаут в CI/CD:
sleep 30  # вместо 10

# Добавить retry логику:
for i in {1..5}; do
  curl -sf http://localhost/api/health &amp;&amp; break
  echo "Attempt $i failed, retrying..."
  sleep 10
done

# Проверить логи:
docker compose -f docker-compose.prod.yml logs backend</code></pre>
<hr>
<h3>Полезные команды для диагностики</h3>
<pre><code class="language-bash"># Общая информация о Docker
docker info
docker system df

# Статус всех контейнеров
docker compose ps -a

# Логи конкретного сервиса (последние 100 строк)
docker compose logs --tail=100 backend

# Логи в реальном времени
docker compose logs -f

# Войти в контейнер
docker compose exec backend bash
docker compose exec frontend sh
docker compose exec mysql mysql -u root -p

# Проверить сеть
docker network ls
docker network inspect app-network

# Проверить volumes
docker volume ls
docker volume inspect app-docker_mysql-data

# Статистика ресурсов
docker stats

# Проверить конфигурацию nginx
docker compose exec nginx nginx -t

# Тест подключения между контейнерами
docker compose exec frontend ping backend
docker compose exec backend ping mysql

# Проверить открытые порты
docker compose exec nginx netstat -tlnp</code></pre>
<hr>
<h3>Быстрые решения (Quick Fixes)</h3>
<pre><code class="language-bash"># 🔄 Полный перезапуск (сброс всего):
docker compose down -v
docker compose build --no-cache
docker compose up -d

# 🧹 Очистка и перезапуск:
docker system prune -af
docker compose up -d --force-recreate

# 🔧 Пересоздать один сервис:
docker compose up -d --force-recreate --no-deps backend

# 📦 Обновить зависимости Laravel:
docker compose exec backend composer install
docker compose exec backend php artisan optimize:clear

# 📦 Обновить зависимости Nuxt:
docker compose exec frontend npm ci
docker compose exec frontend npm run build

# 🔑 Сбросить кэш Laravel:
docker compose exec backend php artisan cache:clear
docker compose exec backend php artisan config:clear
docker compose exec backend php artisan route:clear
docker compose exec backend php artisan view:clear

# 🗃️ Сбросить базу данных (ОСТОРОЖНО!):
docker compose exec backend php artisan migrate:fresh --seed</code></pre>
<hr>
<h2>Чек-лист Docker деплоя</h2>
<h3>Базовая настройка</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Установлен Docker и Docker Compose</li>
<li class="checklist"><input type="checkbox" disabled> Создана структура проекта</li>
<li class="checklist"><input type="checkbox" disabled> Настроен .env файл</li>
<li class="checklist"><input type="checkbox" disabled> Созданы Dockerfile для backend и frontend</li>
<li class="checklist"><input type="checkbox" disabled> Настроен Nginx</li>
<li class="checklist"><input type="checkbox" disabled> Настроен MySQL</li>
<li class="checklist"><input type="checkbox" disabled> Проверена работа в development</li>
<li class="checklist"><input type="checkbox" disabled> Созданы production конфигурации</li>
<li class="checklist"><input type="checkbox" disabled> Получены SSL сертификаты</li>
<li class="checklist"><input type="checkbox" disabled> Настроены скрипты деплоя и бэкапа</li>
<li class="checklist"><input type="checkbox" disabled> Настроен автоматический бэкап (cron)</li>
</ul>
<h3>CI/CD Pipeline</h3>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Выбрана платформа (GitHub Actions / GitLab CI)</li>
<li class="checklist"><input type="checkbox" disabled> Созданы workflow/pipeline файлы</li>
<li class="checklist"><input type="checkbox" disabled> Настроены secrets (SSH ключи, токены)</li>
<li class="checklist"><input type="checkbox" disabled> Настроен health check endpoint</li>
<li class="checklist"><input type="checkbox" disabled> Тесты запускаются при каждом push/PR</li>
<li class="checklist"><input type="checkbox" disabled> Docker образы собираются автоматически</li>
<li class="checklist"><input type="checkbox" disabled> Автодеплой на staging (develop branch)</li>
<li class="checklist"><input type="checkbox" disabled> Деплой на production (main branch)</li>
<li class="checklist"><input type="checkbox" disabled> Настроен rollback скрипт</li>
<li class="checklist"><input type="checkbox" disabled> Настроены уведомления (Telegram/Slack)</li>
</ul>
<hr>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────────────────┐
│                      DOCKER АРХИТЕКТУРА MyApp                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                         NGINX :80/:443                          │   │
│   │                    (Reverse Proxy + SSL)                        │   │
│   └────────────────────────┬──────────────────┬─────────────────────┘   │
│                            │                  │                         │
│              example.com    │                  │   api.example.com      │
│                            ▼                  ▼                         │
│   ┌─────────────────────────────┐  ┌─────────────────────────────┐      │
│   │     FRONTEND (Nuxt)         │  │     BACKEND (Laravel)       │      │
│   │     Container :3000         │  │     Container :9000         │      │
│   │     Node.js 18              │  │     PHP-FPM 8.1             │      │
│   └─────────────────────────────┘  └──────────────┬──────────────┘      │
│                                                   │                     │
│                            ┌──────────────────────┼──────────────┐      │
│                            │                      │              │      │
│                            ▼                      ▼              ▼      │
│   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
│   │     MYSQL       │  │     REDIS       │  │    CERTBOT      │        │
│   │   Container     │  │   Container     │  │   Container     │        │
│   │   :3306         │  │   :6379         │  │   (SSL renew)   │        │
│   └─────────────────┘  └─────────────────┘  └─────────────────┘        │
│                                                                         │
│                         Docker Network: app-network                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter5')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter7')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 07: Laravel 12 API -->
        <section class="chapter" id="chapter7">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 07</span>
                <h1>Laravel 12 API</h1>
            </div>

            <div class="content-section">
                <h2>Что нового в Laravel 12</h2>
<p>Laravel 12 выпущен <strong>24 февраля 2025</strong> года. Это "maintenance release" с минимальными breaking changes.</p>
<h3>Требования</h3>
<div class="table-wrapper"><table>
<thead><tr><th>Требование</th><th>Версия</th></tr></thead>
<tbody>
<tr><td>PHP</td><td>8.2 - 8.5</td></tr>
<tr><td>Bug fixes</td><td>до 13 августа 2026</td></tr>
<tr><td>Security fixes</td><td>до 24 февраля 2027</td></tr>
</tbody></table></div>
<h3>Ключевые изменения</h3>
<ul class="styled-list">
<li>Новые Starter Kits (React, Vue, Livewire)</li>
<li>Поддержка Inertia 2, TypeScript, shadcn/ui</li>
<li>WorkOS AuthKit интеграция (SSO, passkeys)</li>
<li>Laravel Breeze и Jetstream больше не обновляются</li>
</ul>
<hr>
<h2>Установка Laravel 12</h2>
<pre><code class="language-bash"># Создание нового проекта
composer create-project laravel/laravel my-api

# Переход в директорию
cd my-api</code></pre>
<h3>Настройка .env</h3>
<pre><code class="language-ini">APP_NAME=MyAPI
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=my_api
DB_USERNAME=root
DB_PASSWORD=</code></pre>
<hr>
<h2>Установка API маршрутизации</h2>
<p>В Laravel 12 API маршруты устанавливаются отдельной командой:</p>
<pre><code class="language-bash">php artisan install:api</code></pre>
<p>Эта команда:</p>
<ul class="styled-list">
<li>Устанавливает <strong>Laravel Sanctum</strong> для аутентификации</li>
<li>Создаёт файл <code>routes/api.php</code></li>
<li>Автоматически добавляет префикс <code>/api</code> ко всем маршрутам</li>
<li>Настраивает <code>api</code> middleware group (stateless)</li>
</ul>
<hr>
<h2>Структура API маршрутов</h2>
<h3>routes/api.php</h3>
<pre><code class="language-php">&lt;?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\UserController;
use App\Http\Controllers\Api\PostController;

// Защищённый маршрут (требует токен)
Route::get('/user', function (Request $request) {
    return $request-&gt;user();
})-&gt;middleware('auth:sanctum');

// Группа маршрутов с контроллером
Route::controller(UserController::class)-&gt;group(function () {
    Route::get('/users', 'index');
    Route::get('/users/{user}', 'show');
    Route::post('/users', 'store');
    Route::put('/users/{user}', 'update');
    Route::delete('/users/{user}', 'destroy');
});

// Ресурсные маршруты
Route::apiResource('posts', PostController::class);

// Группа с префиксом и middleware
Route::prefix('admin')-&gt;middleware(['auth:sanctum', 'abilities:admin'])-&gt;group(function () {
    Route::get('/stats', [AdminController::class, 'stats']);
    Route::get('/users', [AdminController::class, 'users']);
});</code></pre>
<h3>Изменение API префикса</h3>
<p>В <code>bootstrap/app.php</code>:</p>
<pre><code class="language-php">-&gt;withRouting(
    api: __DIR__.'/../routes/api.php',
    apiPrefix: 'api/v1',  // Меняем с 'api' на 'api/v1'
)</code></pre>
<hr>
<h2>Создание моделей и миграций</h2>
<h3>Создание модели с миграцией</h3>
<pre><code class="language-bash">php artisan make:model Post -m</code></pre>
<h3>Миграция</h3>
<pre><code class="language-php">&lt;?php
// database/migrations/xxxx_create_posts_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('posts', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;foreignId('user_id')-&gt;constrained()-&gt;onDelete('cascade');
            $table-&gt;string('title');
            $table-&gt;string('slug')-&gt;unique();
            $table-&gt;text('content');
            $table-&gt;string('image')-&gt;nullable();
            $table-&gt;boolean('published')-&gt;default(false);
            $table-&gt;timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('posts');
    }
};</code></pre>
<h3>Модель</h3>
<pre><code class="language-php">&lt;?php
// app/Models/Post.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Post extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'title',
        'slug',
        'content',
        'image',
        'published',
    ];

    protected $casts = [
        'published' =&gt; 'boolean',
    ];

    public function user(): BelongsTo
    {
        return $this-&gt;belongsTo(User::class);
    }
}</code></pre>
<pre><code class="language-bash">php artisan migrate</code></pre>
<hr>
<h2>API Resources (Laravel 12)</h2>
<h3>Создание ресурса</h3>
<pre><code class="language-bash">php artisan make:resource PostResource
php artisan make:resource PostCollection</code></pre>
<h3>PostResource.php</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Resources/PostResource.php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class PostResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' =&gt; $this-&gt;id,
            'title' =&gt; $this-&gt;title,
            'slug' =&gt; $this-&gt;slug,
            'content' =&gt; $this-&gt;content,
            'image' =&gt; $this-&gt;image ? url($this-&gt;image) : null,
            'published' =&gt; $this-&gt;published,
            'created_at' =&gt; $this-&gt;created_at-&gt;toISOString(),
            'updated_at' =&gt; $this-&gt;updated_at-&gt;toISOString(),

            // Условная загрузка отношения
            'author' =&gt; new UserResource($this-&gt;whenLoaded('user')),

            // Условный атрибут (только для админов)
            'admin_notes' =&gt; $this-&gt;when(
                $request-&gt;user()?-&gt;isAdmin(),
                $this-&gt;admin_notes
            ),

            // Количество связей
            'comments_count' =&gt; $this-&gt;whenCounted('comments'),
        ];
    }
}</code></pre>
<h3>PostCollection.php</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Resources/PostCollection.php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\ResourceCollection;

class PostCollection extends ResourceCollection
{
    public function toArray(Request $request): array
    {
        return [
            'data' =&gt; $this-&gt;collection,
            'meta' =&gt; [
                'total' =&gt; $this-&gt;collection-&gt;count(),
            ],
        ];
    }

    // Добавление мета-данных
    public function with(Request $request): array
    {
        return [
            'api_version' =&gt; '1.0',
            'api_author' =&gt; 'MyApp',
        ];
    }
}</code></pre>
<h3>Новые методы в Laravel 12</h3>
<pre><code class="language-php">// Быстрое преобразование модели в ресурс
return User::findOrFail($id)-&gt;toResource();

// Быстрое преобразование коллекции
return User::all()-&gt;toResourceCollection();

// С пагинацией
return User::paginate()-&gt;toResourceCollection();</code></pre>
<hr>
<h2>API Controller</h2>
<h3>Создание контроллера</h3>
<pre><code class="language-bash">php artisan make:controller Api/PostController --api</code></pre>
<h3>PostController.php</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Controllers/Api/PostController.php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Http\Resources\PostResource;
use App\Http\Resources\PostCollection;
use App\Models\Post;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class PostController extends Controller
{
    /**
     * Список постов с пагинацией
     */
    public function index(Request $request): PostCollection
    {
        $posts = Post::query()
            -&gt;with('user')
            -&gt;withCount('comments')
            -&gt;when($request-&gt;search, function ($query, $search) {
                $query-&gt;where('title', 'like', "%{$search}%");
            })
            -&gt;when($request-&gt;published, function ($query) {
                $query-&gt;where('published', true);
            })
            -&gt;latest()
            -&gt;paginate($request-&gt;per_page ?? 15);

        return new PostCollection($posts);
    }

    /**
     * Создание поста
     */
    public function store(Request $request): JsonResponse
    {
        $validated = $request-&gt;validate([
            'title' =&gt; 'required|string|max:255',
            'content' =&gt; 'required|string',
            'image' =&gt; 'nullable|image|max:2048',
            'published' =&gt; 'boolean',
        ]);

        $validated['user_id'] = $request-&gt;user()-&gt;id;
        $validated['slug'] = str($validated['title'])-&gt;slug();

        if ($request-&gt;hasFile('image')) {
            $validated['image'] = $request-&gt;file('image')
                -&gt;store('posts', 'public');
        }

        $post = Post::create($validated);

        return response()-&gt;json([
            'message' =&gt; 'Post created successfully',
            'data' =&gt; new PostResource($post),
        ], 201);
    }

    /**
     * Просмотр поста
     */
    public function show(Post $post): PostResource
    {
        return new PostResource($post-&gt;load('user'));
    }

    /**
     * Обновление поста
     */
    public function update(Request $request, Post $post): JsonResponse
    {
        // Проверка авторизации
        $this-&gt;authorize('update', $post);

        $validated = $request-&gt;validate([
            'title' =&gt; 'sometimes|string|max:255',
            'content' =&gt; 'sometimes|string',
            'image' =&gt; 'nullable|image|max:2048',
            'published' =&gt; 'boolean',
        ]);

        if (isset($validated['title'])) {
            $validated['slug'] = str($validated['title'])-&gt;slug();
        }

        if ($request-&gt;hasFile('image')) {
            $validated['image'] = $request-&gt;file('image')
                -&gt;store('posts', 'public');
        }

        $post-&gt;update($validated);

        return response()-&gt;json([
            'message' =&gt; 'Post updated successfully',
            'data' =&gt; new PostResource($post),
        ]);
    }

    /**
     * Удаление поста
     */
    public function destroy(Post $post): JsonResponse
    {
        $this-&gt;authorize('delete', $post);

        $post-&gt;delete();

        return response()-&gt;json([
            'message' =&gt; 'Post deleted successfully',
        ]);
    }
}</code></pre>
<hr>
<h2>Laravel Sanctum — Аутентификация</h2>
<h3>Настройка модели User</h3>
<pre><code class="language-php">&lt;?php
// app/Models/User.php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, Notifiable;

    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected function casts(): array
    {
        return [
            'email_verified_at' =&gt; 'datetime',
            'password' =&gt; 'hashed',
        ];
    }

    public function isAdmin(): bool
    {
        return $this-&gt;role === 'admin';
    }
}</code></pre>
<h3>AuthController.php</h3>
<pre><code class="language-php">&lt;?php
// app/Http/Controllers/Api/AuthController.php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\ValidationException;

class AuthController extends Controller
{
    /**
     * Регистрация
     */
    public function register(Request $request): JsonResponse
    {
        $validated = $request-&gt;validate([
            'name' =&gt; 'required|string|max:255',
            'email' =&gt; 'required|email|unique:users',
            'password' =&gt; 'required|string|min:8|confirmed',
        ]);

        $user = User::create([
            'name' =&gt; $validated['name'],
            'email' =&gt; $validated['email'],
            'password' =&gt; Hash::make($validated['password']),
        ]);

        $token = $user-&gt;createToken('auth-token')-&gt;plainTextToken;

        return response()-&gt;json([
            'message' =&gt; 'Registration successful',
            'user' =&gt; $user,
            'token' =&gt; $token,
        ], 201);
    }

    /**
     * Авторизация
     */
    public function login(Request $request): JsonResponse
    {
        $request-&gt;validate([
            'email' =&gt; 'required|email',
            'password' =&gt; 'required',
        ]);

        $user = User::where('email', $request-&gt;email)-&gt;first();

        if (!$user || !Hash::check($request-&gt;password, $user-&gt;password)) {
            throw ValidationException::withMessages([
                'email' =&gt; ['The provided credentials are incorrect.'],
            ]);
        }

        // Удаляем старые токены (опционально)
        // $user-&gt;tokens()-&gt;delete();

        $token = $user-&gt;createToken(
            'auth-token',
            ['*'],                    // abilities
            now()-&gt;addDays(7)        // срок действия
        )-&gt;plainTextToken;

        return response()-&gt;json([
            'message' =&gt; 'Login successful',
            'user' =&gt; $user,
            'token' =&gt; $token,
        ]);
    }

    /**
     * Выход (удаление токена)
     */
    public function logout(Request $request): JsonResponse
    {
        $request-&gt;user()-&gt;currentAccessToken()-&gt;delete();

        return response()-&gt;json([
            'message' =&gt; 'Logged out successfully',
        ]);
    }

    /**
     * Выход со всех устройств
     */
    public function logoutAll(Request $request): JsonResponse
    {
        $request-&gt;user()-&gt;tokens()-&gt;delete();

        return response()-&gt;json([
            'message' =&gt; 'Logged out from all devices',
        ]);
    }

    /**
     * Текущий пользователь
     */
    public function me(Request $request): JsonResponse
    {
        return response()-&gt;json($request-&gt;user());
    }
}</code></pre>
<h3>Маршруты аутентификации</h3>
<pre><code class="language-php">&lt;?php
// routes/api.php

use App\Http\Controllers\Api\AuthController;

// Публичные маршруты
Route::post('/register', [AuthController::class, 'register']);
Route::post('/login', [AuthController::class, 'login']);

// Защищённые маршруты
Route::middleware('auth:sanctum')-&gt;group(function () {
    Route::get('/me', [AuthController::class, 'me']);
    Route::post('/logout', [AuthController::class, 'logout']);
    Route::post('/logout-all', [AuthController::class, 'logoutAll']);
});</code></pre>
<hr>
<h2>Token Abilities (Права доступа)</h2>
<h3>Создание токена с правами</h3>
<pre><code class="language-php">// Токен только для чтения
$token = $user-&gt;createToken('read-only', ['read'])-&gt;plainTextToken;

// Токен с полным доступом
$token = $user-&gt;createToken('full-access', ['create', 'read', 'update', 'delete'])-&gt;plainTextToken;

// Админский токен
$token = $user-&gt;createToken('admin', ['*'])-&gt;plainTextToken;</code></pre>
<h3>Проверка прав в контроллере</h3>
<pre><code class="language-php">public function update(Request $request, Post $post)
{
    if ($request-&gt;user()-&gt;tokenCan('update')) {
        // Разрешено обновление
    }

    if ($request-&gt;user()-&gt;tokenCant('delete')) {
        // Удаление запрещено
    }
}</code></pre>
<h3>Middleware для проверки прав</h3>
<p>В <code>bootstrap/app.php</code>:</p>
<pre><code class="language-php">use Laravel\Sanctum\Http\Middleware\CheckAbilities;
use Laravel\Sanctum\Http\Middleware\CheckForAnyAbility;

-&gt;withMiddleware(function (Middleware $middleware): void {
    $middleware-&gt;alias([
        'abilities' =&gt; CheckAbilities::class,
        'ability' =&gt; CheckForAnyAbility::class,
    ]);
})</code></pre>
<p>Использование:</p>
<pre><code class="language-php">// Требуются ВСЕ указанные права
Route::put('/posts/{post}', [PostController::class, 'update'])
    -&gt;middleware(['auth:sanctum', 'abilities:update,publish']);

// Требуется ХОТЯ БЫ ОДНО право
Route::get('/posts', [PostController::class, 'index'])
    -&gt;middleware(['auth:sanctum', 'ability:read,admin']);</code></pre>
<hr>
<h2>Rate Limiting (Ограничение запросов)</h2>
<h3>Настройка лимитов</h3>
<p>В <code>app/Providers/AppServiceProvider.php</code>:</p>
<pre><code class="language-php">&lt;?php

namespace App\Providers;

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        // Стандартный лимит API
        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)-&gt;by($request-&gt;user()?-&gt;id ?: $request-&gt;ip());
        });

        // Лимит для аутентификации
        RateLimiter::for('auth', function (Request $request) {
            return Limit::perMinute(5)-&gt;by($request-&gt;ip());
        });

        // VIP пользователи без лимита
        RateLimiter::for('uploads', function (Request $request) {
            return $request-&gt;user()?-&gt;isPremium()
                ? Limit::none()
                : Limit::perHour(10)-&gt;by($request-&gt;user()-&gt;id);
        });

        // Множественные лимиты
        RateLimiter::for('api-strict', function (Request $request) {
            return [
                Limit::perMinute(60)-&gt;by($request-&gt;user()?-&gt;id),
                Limit::perDay(1000)-&gt;by($request-&gt;user()?-&gt;id),
            ];
        });
    }
}</code></pre>
<h3>Применение лимитов к маршрутам</h3>
<pre><code class="language-php">Route::middleware(['throttle:api'])-&gt;group(function () {
    Route::apiResource('posts', PostController::class);
});

Route::post('/login', [AuthController::class, 'login'])
    -&gt;middleware('throttle:auth');</code></pre>
<hr>
<h2>Обработка ошибок API</h2>
<h3>Handler.php (Laravel 12)</h3>
<p>В <code>bootstrap/app.php</code>:</p>
<pre><code class="language-php">-&gt;withExceptions(function (Exceptions $exceptions): void {
    $exceptions-&gt;shouldRenderJsonWhen(function (Request $request, Throwable $e) {
        return $request-&gt;is('api/*') || $request-&gt;expectsJson();
    });

    $exceptions-&gt;render(function (NotFoundHttpException $e, Request $request) {
        if ($request-&gt;is('api/*')) {
            return response()-&gt;json([
                'success' =&gt; false,
                'message' =&gt; 'Resource not found',
            ], 404);
        }
    });

    $exceptions-&gt;render(function (ValidationException $e, Request $request) {
        if ($request-&gt;is('api/*')) {
            return response()-&gt;json([
                'success' =&gt; false,
                'message' =&gt; 'Validation failed',
                'errors' =&gt; $e-&gt;errors(),
            ], 422);
        }
    });

    $exceptions-&gt;render(function (AuthenticationException $e, Request $request) {
        if ($request-&gt;is('api/*')) {
            return response()-&gt;json([
                'success' =&gt; false,
                'message' =&gt; 'Unauthenticated',
            ], 401);
        }
    });
})</code></pre>
<hr>
<h2>CORS настройка</h2>
<pre><code class="language-bash">php artisan config:publish cors</code></pre>
<pre><code class="language-php">&lt;?php
// config/cors.php

return [
    'paths' =&gt; ['api/*', 'sanctum/csrf-cookie'],

    'allowed_methods' =&gt; ['*'],

    'allowed_origins' =&gt; [
        'http://localhost:3000',      // Nuxt dev
        'https://your-frontend.com',  // Production
    ],

    'allowed_origins_patterns' =&gt; [],

    'allowed_headers' =&gt; ['*'],

    'exposed_headers' =&gt; [],

    'max_age' =&gt; 0,

    'supports_credentials' =&gt; true,
];</code></pre>
<hr>
<h2>Тестирование API</h2>
<h3>Пример теста</h3>
<pre><code class="language-php">&lt;?php
// tests/Feature/Api/PostTest.php

namespace Tests\Feature\Api;

use App\Models\Post;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Laravel\Sanctum\Sanctum;
use Tests\TestCase;

class PostTest extends TestCase
{
    use RefreshDatabase;

    public function test_can_get_posts_list(): void
    {
        Post::factory()-&gt;count(5)-&gt;create();

        $response = $this-&gt;getJson('/api/posts');

        $response-&gt;assertOk()
            -&gt;assertJsonCount(5, 'data');
    }

    public function test_authenticated_user_can_create_post(): void
    {
        Sanctum::actingAs(User::factory()-&gt;create());

        $response = $this-&gt;postJson('/api/posts', [
            'title' =&gt; 'Test Post',
            'content' =&gt; 'Test content',
        ]);

        $response-&gt;assertCreated()
            -&gt;assertJsonPath('data.title', 'Test Post');

        $this-&gt;assertDatabaseHas('posts', [
            'title' =&gt; 'Test Post',
        ]);
    }

    public function test_guest_cannot_create_post(): void
    {
        $response = $this-&gt;postJson('/api/posts', [
            'title' =&gt; 'Test Post',
            'content' =&gt; 'Test content',
        ]);

        $response-&gt;assertUnauthorized();
    }

    public function test_user_can_only_update_own_post(): void
    {
        $user = User::factory()-&gt;create();
        $post = Post::factory()-&gt;create(['user_id' =&gt; $user-&gt;id]);

        Sanctum::actingAs($user);

        $response = $this-&gt;putJson("/api/posts/{$post-&gt;id}", [
            'title' =&gt; 'Updated Title',
        ]);

        $response-&gt;assertOk();
    }
}</code></pre>
<h3>Запуск тестов</h3>
<pre><code class="language-bash">php artisan test --filter=PostTest</code></pre>
<hr>
<h2>Проверка API</h2>
<pre><code class="language-bash"># Регистрация
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d '{"name":"Test","email":"test@test.com","password":"password","password_confirmation":"password"}'

# Авторизация
curl -X POST http://localhost:8000/api/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"password"}'

# Получение постов (с токеном)
curl http://localhost:8000/api/posts \
  -H "Authorization: Bearer YOUR_TOKEN"

# Создание поста
curl -X POST http://localhost:8000/api/posts \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title":"New Post","content":"Content here"}'</code></pre>
<hr>
<h2>Чек-лист главы</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Установил Laravel 12</li>
<li class="checklist"><input type="checkbox" disabled> Выполнил <code>php artisan install:api</code></li>
<li class="checklist"><input type="checkbox" disabled> Создал модели и миграции</li>
<li class="checklist"><input type="checkbox" disabled> Создал API Resources</li>
<li class="checklist"><input type="checkbox" disabled> Написал API контроллеры</li>
<li class="checklist"><input type="checkbox" disabled> Настроил Sanctum аутентификацию</li>
<li class="checklist"><input type="checkbox" disabled> Добавил Token Abilities</li>
<li class="checklist"><input type="checkbox" disabled> Настроил Rate Limiting</li>
<li class="checklist"><input type="checkbox" disabled> Настроил CORS</li>
<li class="checklist"><input type="checkbox" disabled> Написал тесты</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../README.md">На главную</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter6')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter8')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 08: Nuxt 4 -->
        <section class="chapter" id="chapter8">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 08</span>
                <h1>Nuxt 4</h1>
            </div>

            <div class="content-section">
                <h2>Что нового в Nuxt 4</h2>
<p>Nuxt 4.0 выпущен <strong>15 июля 2025</strong> года. Это stability-focused релиз с улучшенной производительностью и Developer Experience.</p>
<h3>Ключевые изменения</h3>
<div class="table-wrapper"><table>
<thead><tr><th>Изменение</th><th>Описание</th></tr></thead>
<tbody>
<tr><td>Новая структура <code>app/</code></td><td>Разделение кода приложения</td></tr>
<tr><td>Улучшенный Data Fetching</td><td>Shared refs, автоочистка</td></tr>
<tr><td>TypeScript</td><td>Раздельные проекты по контексту</td></tr>
<tr><td>Производительность</td><td>Быстрый CLI, сокеты</td></tr>
<tr><td>Vue DevTools</td><td>Консистентные имена компонентов</td></tr>
</tbody></table></div>
<hr>
<h2>Установка Nuxt 4</h2>
<h3>Новый проект</h3>
<pre><code class="language-bash">npx nuxi@latest init my-nuxt4-app
cd my-nuxt4-app
npm install
npm run dev</code></pre>
<h3>Обновление существующего проекта</h3>
<pre><code class="language-bash"># Обновление до Nuxt 4
npx nuxt upgrade --dedupe

# Автоматическая миграция структуры
npx codemod@latest nuxt/4/migration-recipe

# Миграция только файловой структуры
npx codemod@latest nuxt/4/file-structure</code></pre>
<hr>
<h2>Новая структура проекта</h2>
<h3>Nuxt 3 (старая)</h3>
<pre><code class="language-text">my-app/
├── assets/
├── components/
├── composables/
├── layouts/
├── middleware/
├── pages/
├── plugins/
├── utils/
├── public/
├── server/
├── nuxt.config.ts
└── package.json</code></pre>
<h3>Nuxt 4 (новая)</h3>
<pre><code class="language-text">my-app/
├── app/                    # ← Весь код приложения
│   ├── assets/
│   ├── components/
│   ├── composables/
│   ├── layouts/
│   ├── middleware/
│   ├── pages/
│   ├── plugins/
│   └── utils/
├── content/                # Nuxt Content (остаётся)
├── layers/                 # Layers (остаётся)
├── public/                 # Статика (остаётся)
├── server/                 # Серверный код (остаётся)
├── shared/                 # ← НОВОЕ: Общий код
├── nuxt.config.ts          # Конфиг (остаётся)
└── package.json</code></pre>
<h3>Преимущества новой структуры</h3>
<ul class="styled-list">
<li><strong>Быстрее file watching</strong> — Chokidar работает эффективнее</li>
<li><strong>Чище root</strong> — меньше папок в корне</li>
<li><strong>Shared код</strong> — общие типы и утилиты для app и server</li>
<li><strong>TypeScript</strong> — раздельные tsconfig по контексту</li>
</ul>
<hr>
<h2>Конфигурация nuxt.config.ts</h2>
<h3>Базовый конфиг Nuxt 4</h3>
<pre><code class="language-typescript">// nuxt.config.ts
export default defineNuxtConfig({
  // Новые опции Nuxt 4
  future: {
    compatibilityVersion: 4,  // Включить все фичи v4
  },

  // Модули
  modules: [
    '@nuxtjs/tailwindcss',
    '@pinia/nuxt',
    '@nuxtjs/i18n',
  ],

  // Настройки приложения
  app: {
    head: {
      title: 'My Nuxt 4 App',
      meta: [
        { charset: 'utf-8' },
        { name: 'viewport', content: 'width=device-width, initial-scale=1' },
      ],
    },
  },

  // Runtime config
  runtimeConfig: {
    apiSecret: process.env.API_SECRET,
    public: {
      apiBase: process.env.API_BASE || 'http://localhost:8000/api',
    },
  },

  // TypeScript
  typescript: {
    strict: true,
    typeCheck: true,
  },

  // SSR настройки
  ssr: true,

  // Экспериментальные опции
  experimental: {
    payloadExtraction: true,
    typedPages: true,
  },
})</code></pre>
<h3>Совместимость с Nuxt 3</h3>
<pre><code class="language-typescript">// nuxt.config.ts - для постепенной миграции
export default defineNuxtConfig({
  // Использовать старую структуру
  srcDir: '.',

  // Отключить новые функции
  experimental: {
    normalizeComponentNames: false,
    purgeCachedData: false,
  },
})</code></pre>
<hr>
<h2>Data Fetching (улучшения)</h2>
<h3>useAsyncData - новые возможности</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
// Базовое использование
const { data: posts, status, error, refresh } = await useAsyncData(
  'posts',
  () =&gt; $fetch('/api/posts')
)

// Реактивные ключи (НОВОЕ в Nuxt 4)
const page = ref(1)
const { data } = await useAsyncData(
  () =&gt; `posts-page-${page.value}`,  // Реактивный ключ
  () =&gt; $fetch(`/api/posts?page=${page.value}`)
)

// При изменении page автоматически рефетчится!
&lt;/script&gt;</code></pre>
<h3>useFetch - улучшенное кэширование</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
// Несколько компонентов с одинаковым ключом
// теперь РАЗДЕЛЯЮТ данные автоматически
const { data: user } = await useFetch('/api/user', {
  key: 'current-user',
})

// getCachedData теперь получает причину вызова
const { data } = await useFetch('/api/data', {
  getCachedData(key, nuxtApp, ctx) {
    // ctx.cause: 'initial' | 'refresh' | 'watch'
    if (ctx.cause === 'refresh') {
      return null  // Всегда рефетчить при refresh
    }
    return nuxtApp.payload.data[key]
  },
})

// Автоматическая очистка при unmount
// Данные удаляются когда компонент размонтируется
&lt;/script&gt;</code></pre>
<h3>Shared Data между компонентами</h3>
<pre><code class="language-xml">&lt;!-- ComponentA.vue --&gt;
&lt;script setup lang="ts"&gt;
const { data: user } = await useFetch('/api/user', { key: 'user' })
&lt;/script&gt;

&lt;!-- ComponentB.vue --&gt;
&lt;script setup lang="ts"&gt;
// Использует ТЕ ЖЕ данные, без повторного запроса!
const { data: user } = await useFetch('/api/user', { key: 'user' })
&lt;/script&gt;</code></pre>
<h3>Shallow Reactivity (ВАЖНО!)</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
// В Nuxt 4 data - это shallowRef, не ref!
const { data } = await useAsyncData('items', () =&gt; $fetch('/api/items'))

// ❌ Не работает - не реактивно
data.value.items.push(newItem)

// ✅ Правильно - заменяем весь объект
data.value = {
  ...data.value,
  items: [...data.value.items, newItem]
}

// Или используйте triggerRef
import { triggerRef } from 'vue'
data.value.items.push(newItem)
triggerRef(data)
&lt;/script&gt;</code></pre>
<hr>
<h2>Компоненты</h2>
<h3>Создание компонента</h3>
<pre><code class="language-xml">&lt;!-- app/components/UserCard.vue --&gt;
&lt;script setup lang="ts"&gt;
interface Props {
  user: {
    id: number
    name: string
    email: string
    avatar?: string
  }
}

const props = defineProps&lt;Props&gt;()

const emit = defineEmits&lt;{
  click: [userId: number]
}&gt;()
&lt;/script&gt;

&lt;template&gt;
  &lt;div
    class="user-card p-4 rounded-lg border hover:shadow-lg transition-shadow cursor-pointer"
    @click="emit('click', user.id)"
  &gt;
    &lt;img
      v-if="user.avatar"
      :src="user.avatar"
      :alt="user.name"
      class="w-16 h-16 rounded-full"
    /&gt;
    &lt;h3 class="font-bold text-lg"&gt;{{ user.name }}&lt;/h3&gt;
    &lt;p class="text-gray-600"&gt;{{ user.email }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h3>Авто-импорт компонентов</h3>
<pre><code class="language-xml">&lt;!-- app/pages/index.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;!-- Авто-импорт из components/ --&gt;
    &lt;UserCard
      v-for="user in users"
      :key="user.id"
      :user="user"
      @click="handleUserClick"
    /&gt;

    &lt;!-- Вложенные компоненты --&gt;
    &lt;BaseButton&gt;Click me&lt;/BaseButton&gt;
    &lt;FormInput v-model="email" placeholder="Email" /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h3>Именование компонентов (Nuxt 4)</h3>
<pre><code class="language-xml">&lt;!-- app/components/base/Button.vue --&gt;
&lt;!--
  В Nuxt 4: имя в DevTools = BaseButton
  В Nuxt 3: имя в DevTools = button

  Теперь консистентно с auto-import!
--&gt;
&lt;script setup lang="ts"&gt;
// Для KeepAlive теперь можно использовать BaseButton
&lt;/script&gt;

&lt;template&gt;
  &lt;button class="btn"&gt;
    &lt;slot /&gt;
  &lt;/button&gt;
&lt;/template&gt;</code></pre>
<hr>
<h2>Страницы и роутинг</h2>
<h3>Создание страниц</h3>
<pre><code class="language-xml">&lt;!-- app/pages/index.vue --&gt;
&lt;script setup lang="ts"&gt;
// Главная страница
const { data: featured } = await useFetch('/api/featured')
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;h1&gt;Главная&lt;/h1&gt;
    &lt;FeaturedSection :items="featured" /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<pre><code class="language-xml">&lt;!-- app/pages/posts/index.vue --&gt;
&lt;script setup lang="ts"&gt;
// Список постов /posts
const { data: posts, status } = await useFetch('/api/posts')
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;h1&gt;Посты&lt;/h1&gt;
    &lt;div v-if="status === 'pending'"&gt;Загрузка...&lt;/div&gt;
    &lt;PostList v-else :posts="posts" /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<pre><code class="language-xml">&lt;!-- app/pages/posts/[slug].vue --&gt;
&lt;script setup lang="ts"&gt;
// Динамический роут /posts/:slug
const route = useRoute()
const { data: post, error } = await useFetch(`/api/posts/${route.params.slug}`)

if (error.value) {
  throw createError({
    statusCode: 404,
    statusMessage: 'Post not found'
  })
}
&lt;/script&gt;

&lt;template&gt;
  &lt;article&gt;
    &lt;h1&gt;{{ post.title }}&lt;/h1&gt;
    &lt;div v-html="post.content" /&gt;
  &lt;/article&gt;
&lt;/template&gt;</code></pre>
<h3>Вложенные роуты</h3>
<pre><code class="language-text">app/pages/
├── users/
│   ├── index.vue          # /users
│   ├── [id].vue           # /users/:id
│   └── [id]/
│       ├── posts.vue      # /users/:id/posts
│       └── settings.vue   # /users/:id/settings</code></pre>
<h3>Typed Routes (Nuxt 4)</h3>
<pre><code class="language-typescript">// nuxt.config.ts
export default defineNuxtConfig({
  experimental: {
    typedPages: true,
  },
})</code></pre>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
// TypeScript автодополнение для роутов!
const router = useRouter()

// Проверка типов для параметров
router.push({
  name: 'posts-slug',
  params: { slug: 'my-post' }  // TS проверит что slug - string
})
&lt;/script&gt;</code></pre>
<hr>
<h2>Composables</h2>
<h3>Создание composable</h3>
<pre><code class="language-typescript">// app/composables/useUser.ts
export function useUser() {
  const user = useState&lt;User | null&gt;('user', () =&gt; null)
  const isLoggedIn = computed(() =&gt; !!user.value)

  async function login(email: string, password: string) {
    const { data } = await useFetch('/api/auth/login', {
      method: 'POST',
      body: { email, password },
    })
    user.value = data.value
  }

  async function logout() {
    await useFetch('/api/auth/logout', { method: 'POST' })
    user.value = null
  }

  async function fetchUser() {
    const { data } = await useFetch('/api/user')
    user.value = data.value
  }

  return {
    user: readonly(user),
    isLoggedIn,
    login,
    logout,
    fetchUser,
  }
}</code></pre>
<h3>Использование</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { user, isLoggedIn, login, logout } = useUser()
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;template v-if="isLoggedIn"&gt;
      &lt;span&gt;{{ user.name }}&lt;/span&gt;
      &lt;button @click="logout"&gt;Выйти&lt;/button&gt;
    &lt;/template&gt;
    &lt;template v-else&gt;
      &lt;LoginForm @submit="login" /&gt;
    &lt;/template&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<hr>
<h2>Shared директория (НОВОЕ)</h2>
<pre><code class="language-text">my-app/
├── app/
├── server/
└── shared/              # ← Общий код
    ├── types/
    │   └── index.ts
    └── utils/
        └── validators.ts</code></pre>
<h3>shared/types/index.ts</h3>
<pre><code class="language-typescript">// Типы доступны и в app/, и в server/
export interface User {
  id: number
  name: string
  email: string
  role: 'admin' | 'user'
}

export interface Post {
  id: number
  title: string
  slug: string
  content: string
  authorId: number
}

export interface ApiResponse&lt;T&gt; {
  data: T
  meta?: {
    total: number
    page: number
    perPage: number
  }
}</code></pre>
<h3>shared/utils/validators.ts</h3>
<pre><code class="language-typescript">// Валидаторы доступны везде
export function isValidEmail(email: string): boolean {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
}

export function isValidSlug(slug: string): boolean {
  return /^[a-z0-9-]+$/.test(slug)
}</code></pre>
<h3>Использование в app/</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
import type { User, Post } from '~/shared/types'
import { isValidEmail } from '~/shared/utils/validators'

const email = ref('')
const isValid = computed(() =&gt; isValidEmail(email.value))
&lt;/script&gt;</code></pre>
<h3>Использование в server/</h3>
<pre><code class="language-typescript">// server/api/users/[id].get.ts
import type { User } from '~/shared/types'

export default defineEventHandler(async (event): Promise&lt;User&gt; =&gt; {
  const id = getRouterParam(event, 'id')
  // ...
})</code></pre>
<hr>
<h2>Server API</h2>
<h3>Создание API endpoint</h3>
<pre><code class="language-typescript">// server/api/posts/index.get.ts
import type { Post, ApiResponse } from '~/shared/types'

export default defineEventHandler(async (event): Promise&lt;ApiResponse&lt;Post[]&gt;&gt; =&gt; {
  const query = getQuery(event)
  const page = Number(query.page) || 1
  const perPage = Number(query.perPage) || 10

  // Fetch from database or external API
  const posts = await $fetch('http://laravel-api.local/api/posts', {
    query: { page, perPage }
  })

  return {
    data: posts.data,
    meta: {
      total: posts.total,
      page,
      perPage,
    }
  }
})</code></pre>
<pre><code class="language-typescript">// server/api/posts/index.post.ts
export default defineEventHandler(async (event) =&gt; {
  const body = await readBody(event)

  // Валидация
  if (!body.title || !body.content) {
    throw createError({
      statusCode: 400,
      message: 'Title and content are required'
    })
  }

  // Создание
  const post = await $fetch('http://laravel-api.local/api/posts', {
    method: 'POST',
    body,
    headers: {
      Authorization: `Bearer ${event.context.token}`
    }
  })

  return post
})</code></pre>
<pre><code class="language-typescript">// server/api/posts/[slug].get.ts
export default defineEventHandler(async (event) =&gt; {
  const slug = getRouterParam(event, 'slug')

  const post = await $fetch(`http://laravel-api.local/api/posts/${slug}`)

  if (!post) {
    throw createError({
      statusCode: 404,
      message: 'Post not found'
    })
  }

  return post
})</code></pre>
<hr>
<h2>Middleware</h2>
<h3>Route Middleware</h3>
<pre><code class="language-typescript">// app/middleware/auth.ts
export default defineNuxtRouteMiddleware((to, from) =&gt; {
  const { isLoggedIn } = useUser()

  if (!isLoggedIn.value &amp;&amp; to.path !== '/login') {
    return navigateTo('/login')
  }
})</code></pre>
<pre><code class="language-typescript">// app/middleware/admin.ts
export default defineNuxtRouteMiddleware((to, from) =&gt; {
  const { user } = useUser()

  if (user.value?.role !== 'admin') {
    throw createError({
      statusCode: 403,
      message: 'Access denied'
    })
  }
})</code></pre>
<h3>Применение к страницам</h3>
<pre><code class="language-xml">&lt;!-- app/pages/admin/index.vue --&gt;
&lt;script setup lang="ts"&gt;
definePageMeta({
  middleware: ['auth', 'admin']
})
&lt;/script&gt;</code></pre>
<h3>Server Middleware</h3>
<pre><code class="language-typescript">// server/middleware/auth.ts
export default defineEventHandler((event) =&gt; {
  const token = getHeader(event, 'authorization')?.replace('Bearer ', '')

  if (token) {
    // Verify token and set user context
    event.context.token = token
    event.context.user = verifyToken(token)
  }
})</code></pre>
<hr>
<h2>Plugins</h2>
<h3>Client Plugin</h3>
<pre><code class="language-typescript">// app/plugins/toast.client.ts
import Toast from 'vue-toastification'

export default defineNuxtPlugin((nuxtApp) =&gt; {
  nuxtApp.vueApp.use(Toast, {
    position: 'top-right',
    timeout: 3000,
  })
})</code></pre>
<h3>Universal Plugin</h3>
<pre><code class="language-typescript">// app/plugins/api.ts
export default defineNuxtPlugin((nuxtApp) =&gt; {
  const config = useRuntimeConfig()

  const api = $fetch.create({
    baseURL: config.public.apiBase,
    onRequest({ options }) {
      const token = useCookie('token')
      if (token.value) {
        options.headers = {
          ...options.headers,
          Authorization: `Bearer ${token.value}`
        }
      }
    },
    onResponseError({ response }) {
      if (response.status === 401) {
        navigateTo('/login')
      }
    },
  })

  return {
    provide: {
      api,
    },
  }
})</code></pre>
<h3>Использование</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { $api } = useNuxtApp()

const { data } = await useAsyncData('posts', () =&gt;
  $api('/posts')
)
&lt;/script&gt;</code></pre>
<hr>
<h2>i18n (Локализация)</h2>
<h3>Установка</h3>
<pre><code class="language-bash">npm install @nuxtjs/i18n</code></pre>
<h3>Конфигурация</h3>
<pre><code class="language-typescript">// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxtjs/i18n'],

  i18n: {
    locales: [
      { code: 'ru', file: 'ru.json', name: 'Русский' },
      { code: 'en', file: 'en.json', name: 'English' },
      { code: 'kk', file: 'kk.json', name: 'Қазақша' },
    ],
    defaultLocale: 'ru',
    lazy: true,
    langDir: 'locales/',
    strategy: 'prefix_except_default',
  },
})</code></pre>
<h3>Файлы переводов</h3>
<pre><code class="language-json">// app/locales/ru.json
{
  "nav": {
    "home": "Главная",
    "about": "О нас",
    "news": "Новости"
  },
  "common": {
    "loading": "Загрузка...",
    "error": "Произошла ошибка",
    "save": "Сохранить"
  }
}</code></pre>
<h3>Использование</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { t, locale, locales, setLocale } = useI18n()
&lt;/script&gt;

&lt;template&gt;
  &lt;nav&gt;
    &lt;NuxtLink :to="localePath('/')"&gt;{{ t('nav.home') }}&lt;/NuxtLink&gt;
    &lt;NuxtLink :to="localePath('/about')"&gt;{{ t('nav.about') }}&lt;/NuxtLink&gt;

    &lt;!-- Переключатель языка --&gt;
    &lt;select v-model="locale" @change="setLocale($event.target.value)"&gt;
      &lt;option v-for="loc in locales" :key="loc.code" :value="loc.code"&gt;
        {{ loc.name }}
      &lt;/option&gt;
    &lt;/select&gt;
  &lt;/nav&gt;
&lt;/template&gt;</code></pre>
<hr>
<h2>SEO и Meta</h2>
<h3>useSeoMeta</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
useSeoMeta({
  title: 'Главная страница',
  description: 'Описание сайта для поисковиков',
  ogTitle: 'Заголовок для соцсетей',
  ogDescription: 'Описание для соцсетей',
  ogImage: '/og-image.jpg',
  twitterCard: 'summary_large_image',
})
&lt;/script&gt;</code></pre>
<h3>Динамические мета-теги</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const { data: post } = await useFetch(`/api/posts/${route.params.slug}`)

useSeoMeta({
  title: () =&gt; post.value?.title,
  description: () =&gt; post.value?.excerpt,
  ogImage: () =&gt; post.value?.image,
})
&lt;/script&gt;</code></pre>
<hr>
<h2>TypeScript в Nuxt 4</h2>
<h3>Раздельные tsconfig</h3>
<p>Nuxt 4 создаёт отдельные TypeScript проекты:</p>
<pre><code class="language-text">.nuxt/
├── tsconfig.app.json     # Для app/
├── tsconfig.server.json  # Для server/
├── tsconfig.shared.json  # Для shared/
└── tsconfig.json         # Общий</code></pre>
<h3>Строгая типизация</h3>
<pre><code class="language-typescript">// nuxt.config.ts
export default defineNuxtConfig({
  typescript: {
    strict: true,
    typeCheck: true,
  },
})</code></pre>
<h3>Типизация API ответов</h3>
<pre><code class="language-typescript">// app/composables/usePosts.ts
import type { Post, ApiResponse } from '~/shared/types'

export function usePosts() {
  return useFetch&lt;ApiResponse&lt;Post[]&gt;&gt;('/api/posts')
}

export function usePost(slug: string) {
  return useFetch&lt;Post&gt;(`/api/posts/${slug}`)
}</code></pre>
<hr>
<h2>Чек-лист миграции на Nuxt 4</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Обновил Nuxt: <code>npx nuxt upgrade --dedupe</code></li>
<li class="checklist"><input type="checkbox" disabled> Запустил миграцию: <code>npx codemod@latest nuxt/4/migration-recipe</code></li>
<li class="checklist"><input type="checkbox" disabled> Переместил файлы в <code>app/</code> директорию</li>
<li class="checklist"><input type="checkbox" disabled> Создал <code>shared/</code> для общих типов</li>
<li class="checklist"><input type="checkbox" disabled> Обновил импорты</li>
<li class="checklist"><input type="checkbox" disabled> Проверил data fetching (shallowRef!)</li>
<li class="checklist"><input type="checkbox" disabled> Проверил KeepAlive компоненты</li>
<li class="checklist"><input type="checkbox" disabled> Обновил TypeScript конфиги</li>
<li class="checklist"><input type="checkbox" disabled> Протестировал все страницы</li>
<li class="checklist"><input type="checkbox" disabled> Проверил SEO мета-теги</li>
</ul>
<hr>
<p><strong>Следующая глава:</strong> <a href="../09-Tailwind4/README.md">Tailwind CSS 4 →</a></p>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter7')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('chapter9')">
                    Далее
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>
        <!-- Chapter 09: Tailwind CSS 4 -->
        <section class="chapter" id="chapter9">
            <div class="chapter-header">
                <span class="chapter-badge">Глава 09</span>
                <h1>Tailwind CSS 4</h1>
            </div>

            <div class="content-section">
                <p>Tailwind CSS 4 — это крупнейшее обновление фреймворка с момента его создания. Полностью переписанный движок обеспечивает до 5x более быструю полную сборку и более 100x быструю инкрементальную сборку.</p>
<h2>Ключевые изменения в Tailwind CSS 4</h2>
<h3>Высокопроизводительный движок</h3>
<p>Tailwind CSS 4 построен на новом движке Oxide, написанном на Rust:</p>
<ul class="styled-list">
<li><strong>5x быстрее</strong> полная сборка</li>
<li><strong>100x+ быстрее</strong> инкрементальная сборка</li>
<li>Уменьшенный размер установки</li>
<li>Унифицированный тулчейн (Lightning CSS встроен)</li>
</ul>
<h3>CSS-first конфигурация</h3>
<p>Главное изменение — конфигурация теперь происходит в CSS, а не в JavaScript:</p>
<pre><code class="language-css">/* app.css */
@import "tailwindcss";

@theme {
  --font-display: "Satoshi", "sans-serif";

  --breakpoint-3xl: 1920px;

  --color-primary: #3490dc;
  --color-secondary: #ffed4a;
  --color-danger: #e3342f;

  --ease-fluid: cubic-bezier(0.3, 0, 0, 1);
  --ease-snappy: cubic-bezier(0.2, 0, 0, 1);

  --animate-fade-in: fade-in 0.5s var(--ease-fluid);
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}</code></pre>
<h3>Установка</h3>
<pre><code class="language-bash"># Установка через npm
npm install tailwindcss @tailwindcss/postcss

# Или через CLI
npm install tailwindcss @tailwindcss/cli</code></pre>
<h3>Настройка PostCSS</h3>
<pre><code class="language-javascript">// postcss.config.js
export default {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};</code></pre>
<h3>Импорт в CSS</h3>
<pre><code class="language-css">/* Новый способ - один импорт */
@import "tailwindcss";

/* Старый способ (deprecated) */
@tailwind base;
@tailwind components;
@tailwind utilities;</code></pre>
<h2>Директива @theme</h2>
<p>Директива <code>@theme</code> заменяет объект <code>theme</code> из <code>tailwind.config.js</code>:</p>
<pre><code class="language-css">@import "tailwindcss";

@theme {
  /* Цвета */
  --color-*: initial; /* Сброс всех цветов */
  --color-primary: oklch(0.84 0.18 117.33);
  --color-secondary: oklch(0.83 0.14 254.13);
  --color-accent: oklch(0.7 0.2 30);

  /* Шрифты */
  --font-sans: "Inter", system-ui, sans-serif;
  --font-mono: "Fira Code", monospace;

  /* Размеры текста */
  --text-tiny: 0.625rem;
  --text-tiny--line-height: 1rem;

  /* Брейкпоинты */
  --breakpoint-xs: 475px;
  --breakpoint-3xl: 1920px;

  /* Радиусы */
  --radius-4xl: 2rem;

  /* Тени */
  --shadow-glow: 0 0 20px oklch(0.7 0.2 30 / 0.5);

  /* Анимации */
  --animate-bounce-in: bounce-in 0.5s ease-out;
}

@keyframes bounce-in {
  0% { transform: scale(0); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}</code></pre>
<h2>Новые утилиты</h2>
<h3>Container Queries</h3>
<p>Контейнерные запросы теперь встроены:</p>
<pre><code class="language-xml">&lt;div class="@container"&gt;
  &lt;div class="flex flex-col @md:flex-row @lg:grid @lg:grid-cols-3"&gt;
    &lt;!-- Реагирует на размер контейнера, не viewport --&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Именованные контейнеры --&gt;
&lt;div class="@container/sidebar"&gt;
  &lt;nav class="@md/sidebar:flex-row"&gt;...&lt;/nav&gt;
&lt;/div&gt;</code></pre>
<h3>3D Transforms</h3>
<pre><code class="language-xml">&lt;!-- Поворот в 3D --&gt;
&lt;div class="rotate-x-45 rotate-y-12"&gt;
  3D Card
&lt;/div&gt;

&lt;!-- Перспектива --&gt;
&lt;div class="perspective-500"&gt;
  &lt;div class="rotate-y-45 preserve-3d"&gt;
    Content with perspective
  &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Transform origin в 3D --&gt;
&lt;div class="origin-top-left transform-3d"&gt;
  ...
&lt;/div&gt;</code></pre>
<h3>Расширенные градиенты</h3>
<pre><code class="language-xml">&lt;!-- Градиенты с интерполяцией в oklch --&gt;
&lt;div class="bg-linear-to-r/oklch from-blue-500 to-green-500"&gt;
  Более насыщенный градиент
&lt;/div&gt;

&lt;!-- Конические градиенты --&gt;
&lt;div class="bg-conic from-red-500 via-yellow-500 to-green-500"&gt;
  Conic gradient
&lt;/div&gt;

&lt;!-- Радиальные градиенты с позицией --&gt;
&lt;div class="bg-radial-at-tl from-purple-500 to-transparent"&gt;
  Radial from top-left
&lt;/div&gt;</code></pre>
<h3>Расширенные тени</h3>
<pre><code class="language-xml">&lt;!-- Inset shadow --&gt;
&lt;div class="inset-shadow-sm inset-shadow-black/10"&gt;
  Внутренняя тень
&lt;/div&gt;

&lt;!-- Ring с inset --&gt;
&lt;div class="inset-ring inset-ring-white/20"&gt;
  Внутреннее кольцо
&lt;/div&gt;

&lt;!-- Цветные тени --&gt;
&lt;div class="shadow-lg shadow-blue-500/50"&gt;
  Синяя тень
&lt;/div&gt;</code></pre>
<h3>Field Sizing</h3>
<pre><code class="language-xml">&lt;!-- Автоматический размер textarea --&gt;
&lt;textarea class="field-sizing-content"&gt;
  Высота подстраивается под контент
&lt;/textarea&gt;</code></pre>
<h3>Новые цветовые утилиты</h3>
<pre><code class="language-xml">&lt;!-- Color scheme для dark mode --&gt;
&lt;html class="scheme-dark"&gt;
  &lt;!-- Браузерные элементы тоже темные --&gt;
&lt;/html&gt;

&lt;!-- currentColor --&gt;
&lt;div class="border-current bg-current/10"&gt;
  Использует текущий цвет текста
&lt;/div&gt;</code></pre>
<h3>Логические свойства</h3>
<pre><code class="language-xml">&lt;!-- Start/End вместо Left/Right --&gt;
&lt;div class="ms-4 me-2 ps-6 pe-4"&gt;
  Margin/Padding start/end
&lt;/div&gt;

&lt;div class="rounded-s-lg border-e-2"&gt;
  Border/Radius start/end
&lt;/div&gt;

&lt;!-- Для RTL языков автоматически меняется --&gt;</code></pre>
<h2>Варианты состояний</h2>
<h3>Новые варианты</h3>
<pre><code class="language-xml">&lt;!-- Starting style (для анимаций появления) --&gt;
&lt;div class="starting:opacity-0 starting:scale-95 transition"&gt;
  Анимация появления
&lt;/div&gt;

&lt;!-- Not варианты --&gt;
&lt;div class="not-first:mt-4 not-last:mb-4"&gt;
  Все кроме первого/последнего
&lt;/div&gt;

&lt;!-- Inert --&gt;
&lt;div class="inert:opacity-50 inert:pointer-events-none"&gt;
  Состояние inert
&lt;/div&gt;

&lt;!-- nth-child --&gt;
&lt;div class="nth-3:bg-blue-500 nth-odd:bg-gray-100"&gt;
  Каждый третий синий
&lt;/div&gt;

&lt;!-- Open state --&gt;
&lt;details class="open:bg-blue-50"&gt;
  &lt;summary&gt;Details&lt;/summary&gt;
&lt;/details&gt;</code></pre>
<h3>Группировка вариантов</h3>
<pre><code class="language-xml">&lt;!-- Несколько вариантов одновременно --&gt;
&lt;div class="group-hover:group-focus:text-blue-500"&gt;
  ...
&lt;/div&gt;

&lt;!-- Вложенные группы --&gt;
&lt;div class="group/outer"&gt;
  &lt;div class="group/inner"&gt;
    &lt;span class="group-hover/inner:text-blue-500"&gt;
      Inner hover
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<h2>Работа с темами</h2>
<h3>Темная тема</h3>
<pre><code class="language-css">@import "tailwindcss";

@variant dark (&amp;:where(.dark, .dark *));</code></pre>
<pre><code class="language-xml">&lt;html class="dark"&gt;
  &lt;body class="bg-white dark:bg-gray-900"&gt;
    &lt;h1 class="text-gray-900 dark:text-white"&gt;
      Темная тема
    &lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<h3>Кастомные варианты</h3>
<pre><code class="language-css">@import "tailwindcss";

/* Вариант для режима высокой контрастности */
@variant hc (&amp;:where(.high-contrast, .high-contrast *));

/* Медиа запрос вариант */
@variant touch (@media (hover: none));</code></pre>
<pre><code class="language-xml">&lt;button class="hc:border-2 hc:border-black touch:p-4"&gt;
  Адаптивная кнопка
&lt;/button&gt;</code></pre>
<h2>Плагины и расширения</h2>
<h3>Использование плагинов</h3>
<pre><code class="language-css">@import "tailwindcss";
@plugin "@tailwindcss/typography";
@plugin "@tailwindcss/forms";</code></pre>
<h3>Создание утилит</h3>
<pre><code class="language-css">@import "tailwindcss";

@utility scrollbar-hidden {
  -ms-overflow-style: none;
  scrollbar-width: none;
  &amp;::-webkit-scrollbar {
    display: none;
  }
}

@utility text-balance {
  text-wrap: balance;
}</code></pre>
<h3>Создание компонентов</h3>
<pre><code class="language-css">@import "tailwindcss";

@layer components {
  .btn {
    @apply px-4 py-2 rounded-lg font-medium transition;
  }

  .btn-primary {
    @apply btn bg-blue-500 text-white hover:bg-blue-600;
  }

  .card {
    @apply bg-white rounded-xl shadow-lg p-6;
  }
}</code></pre>
<h2>Миграция с Tailwind CSS 3</h2>
<h3>Изменения в конфигурации</h3>
<pre><code class="language-css">/* Было: tailwind.config.js */
/* module.exports = {
  theme: {
    extend: {
      colors: {
        primary: '#3490dc'
      }
    }
  }
} */

/* Стало: app.css */
@import "tailwindcss";

@theme {
  --color-primary: #3490dc;
}</code></pre>
<h3>Переименованные утилиты</h3>
<div class="table-wrapper"><table>
<thead><tr><th>Tailwind CSS 3</th><th>Tailwind CSS 4</th></tr></thead>
<tbody>
<tr><td><code>shadow-sm</code></td><td><code>shadow-xs</code></td></tr>
<tr><td><code>shadow</code></td><td><code>shadow-sm</code></td></tr>
<tr><td><code>shadow-md</code></td><td><code>shadow-md</code> (без изменений)</td></tr>
<tr><td><code>drop-shadow-sm</code></td><td><code>drop-shadow-xs</code></td></tr>
<tr><td><code>drop-shadow</code></td><td><code>drop-shadow-sm</code></td></tr>
<tr><td><code>blur-sm</code></td><td><code>blur-xs</code></td></tr>
<tr><td><code>blur</code></td><td><code>blur-sm</code></td></tr>
<tr><td><code>rounded-sm</code></td><td><code>rounded-xs</code></td></tr>
<tr><td><code>rounded</code></td><td><code>rounded-sm</code></td></tr>
<tr><td><code>outline-none</code></td><td><code>outline-hidden</code></td></tr>
</tbody></table></div>
<h3>Изменения в Ring</h3>
<pre><code class="language-xml">&lt;!-- Tailwind CSS 3 --&gt;
&lt;div class="ring"&gt;
  По умолчанию 3px ring
&lt;/div&gt;

&lt;!-- Tailwind CSS 4 --&gt;
&lt;div class="ring"&gt;
  По умолчанию 1px ring
&lt;/div&gt;

&lt;!-- Для 3px как раньше --&gt;
&lt;div class="ring-3"&gt;
  3px ring
&lt;/div&gt;</code></pre>
<h3>Изменения в градиентах</h3>
<pre><code class="language-xml">&lt;!-- Tailwind CSS 3 --&gt;
&lt;div class="bg-gradient-to-r from-blue-500 to-green-500"&gt;

&lt;!-- Tailwind CSS 4 --&gt;
&lt;div class="bg-linear-to-r from-blue-500 to-green-500"&gt;</code></pre>
<h3>Удаленные deprecated классы</h3>
<pre><code class="language-xml">&lt;!-- Удалены в v4 --&gt;
flex-grow → grow
flex-shrink → shrink
overflow-ellipsis → text-ellipsis
decoration-slice → box-decoration-slice
decoration-clone → box-decoration-clone</code></pre>
<h2>Интеграция с Nuxt</h2>
<h3>Настройка</h3>
<pre><code class="language-bash">npm install tailwindcss @tailwindcss/postcss</code></pre>
<pre><code class="language-typescript">// nuxt.config.ts
export default defineNuxtConfig({
  css: ['~/assets/css/main.css'],

  postcss: {
    plugins: {
      '@tailwindcss/postcss': {},
    },
  },
})</code></pre>
<pre><code class="language-css">/* assets/css/main.css */
@import "tailwindcss";

@theme {
  --color-primary: oklch(0.7 0.15 250);
  --color-secondary: oklch(0.8 0.12 150);
  --font-sans: "Inter", system-ui, sans-serif;
}</code></pre>
<h3>Использование в компонентах</h3>
<pre><code class="language-xml">&lt;template&gt;
  &lt;div class="min-h-screen bg-gray-50 dark:bg-gray-900"&gt;
    &lt;header class="bg-white dark:bg-gray-800 shadow-sm"&gt;
      &lt;nav class="@container"&gt;
        &lt;div class="@md:flex @md:items-center @md:justify-between"&gt;
          &lt;Logo class="h-8" /&gt;
          &lt;Navigation /&gt;
        &lt;/div&gt;
      &lt;/nav&gt;
    &lt;/header&gt;

    &lt;main class="container mx-auto px-4 py-8"&gt;
      &lt;slot /&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h3>Темная тема с Nuxt</h3>
<pre><code class="language-xml">&lt;script setup lang="ts"&gt;
const colorMode = useColorMode()

function toggleDark() {
  colorMode.preference = colorMode.value === 'dark' ? 'light' : 'dark'
}
&lt;/script&gt;

&lt;template&gt;
  &lt;html :class="{ dark: colorMode.value === 'dark' }"&gt;
    &lt;body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white"&gt;
      &lt;button @click="toggleDark" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"&gt;
        &lt;SunIcon v-if="colorMode.value === 'dark'" class="w-5 h-5" /&gt;
        &lt;MoonIcon v-else class="w-5 h-5" /&gt;
      &lt;/button&gt;
    &lt;/body&gt;
  &lt;/html&gt;
&lt;/template&gt;</code></pre>
<h2>Оптимизация производительности</h2>
<h3>Автоматическое tree-shaking</h3>
<p>Tailwind CSS 4 автоматически включает только используемые стили:</p>
<pre><code class="language-css">/* Указание путей для сканирования (опционально) */
@import "tailwindcss";
@source "../components/**/*.vue";
@source "../pages/**/*.vue";
@source "../layouts/**/*.vue";</code></pre>
<h3>Кэширование</h3>
<p>Новый движок эффективно кэширует результаты:</p>
<ul class="styled-list">
<li>Инкрементальные сборки практически мгновенные</li>
<li>Hot reload работает без задержек</li>
<li>Первая сборка значительно быстрее</li>
</ul>
<h2>Практический пример: Карточка товара</h2>
<pre><code class="language-xml">&lt;template&gt;
  &lt;article class="group @container"&gt;
    &lt;div class="
      relative overflow-hidden rounded-2xl bg-white
      shadow-sm hover:shadow-lg
      ring-1 ring-black/5
      transition duration-300
      dark:bg-gray-800 dark:ring-white/10
    "&gt;
      &lt;!-- Изображение --&gt;
      &lt;div class="aspect-square overflow-hidden"&gt;
        &lt;img
          :src="product.image"
          :alt="product.name"
          class="
            h-full w-full object-cover
            transition duration-500
            group-hover:scale-105
          "
        /&gt;
      &lt;/div&gt;

      &lt;!-- Бейдж скидки --&gt;
      &lt;div
        v-if="product.discount"
        class="
          absolute top-4 right-4
          rounded-full bg-red-500 px-3 py-1
          text-xs font-bold text-white
          shadow-lg shadow-red-500/30
        "
      &gt;
        -{{ product.discount }}%
      &lt;/div&gt;

      &lt;!-- Контент --&gt;
      &lt;div class="p-4 @md:p-6"&gt;
        &lt;h3 class="
          text-lg font-semibold text-gray-900
          @lg:text-xl
          dark:text-white
        "&gt;
          {{ product.name }}
        &lt;/h3&gt;

        &lt;p class="mt-2 text-sm text-gray-600 dark:text-gray-400"&gt;
          {{ product.description }}
        &lt;/p&gt;

        &lt;div class="mt-4 flex items-center justify-between"&gt;
          &lt;div class="flex items-baseline gap-2"&gt;
            &lt;span class="text-2xl font-bold text-primary"&gt;
              {{ formatPrice(product.price) }}
            &lt;/span&gt;
            &lt;span
              v-if="product.oldPrice"
              class="text-sm text-gray-400 line-through"
            &gt;
              {{ formatPrice(product.oldPrice) }}
            &lt;/span&gt;
          &lt;/div&gt;

          &lt;button class="
            rounded-xl bg-primary px-4 py-2
            text-sm font-medium text-white
            transition
            hover:bg-primary/90
            active:scale-95
          "&gt;
            В корзину
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/article&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
interface Product {
  name: string
  description: string
  image: string
  price: number
  oldPrice?: number
  discount?: number
}

defineProps&lt;{
  product: Product
}&gt;()

function formatPrice(price: number) {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'KZT',
    maximumFractionDigits: 0,
  }).format(price)
}
&lt;/script&gt;</code></pre>
<h2>Чеклист миграции</h2>
<ul class="styled-list">
<li class="checklist"><input type="checkbox" disabled> Установить <code>tailwindcss</code> v4 и <code>@tailwindcss/postcss</code></li>
<li class="checklist"><input type="checkbox" disabled> Заменить <code>tailwind.config.js</code> на <code>@theme</code> в CSS</li>
<li class="checklist"><input type="checkbox" disabled> Обновить импорт с <code>@tailwind</code> на <code>@import "tailwindcss"</code></li>
<li class="checklist"><input type="checkbox" disabled> Переименовать утилиты (shadow-sm → shadow-xs и т.д.)</li>
<li class="checklist"><input type="checkbox" disabled> Обновить градиенты (bg-gradient → bg-linear)</li>
<li class="checklist"><input type="checkbox" disabled> Проверить ring утилиты (по умолчанию теперь 1px)</li>
<li class="checklist"><input type="checkbox" disabled> Заменить deprecated классы (flex-grow → grow)</li>
<li class="checklist"><input type="checkbox" disabled> Обновить плагины через <code>@plugin</code></li>
<li class="checklist"><input type="checkbox" disabled> Протестировать темную тему</li>
<li class="checklist"><input type="checkbox" disabled> Проверить container queries (@container)</li>
</ul>
<h2>Ресурсы</h2>
<ul class="styled-list">
<li><a href="https://tailwindcss.com/docs">Официальная документация Tailwind CSS 4</a></li>
<li><a href="https://tailwindcss.com/docs/upgrade-guide">Гайд по миграции</a></li>
<li><a href="https://tailwindcss.com/blog/tailwindcss-v4">Блог-пост о v4</a></li>
<li><a href="https://github.com/tailwindlabs/tailwindcss">GitHub репозиторий</a></li>
</ul>

            </div>

            <div class="chapter-nav">
                <button class="nav-btn nav-btn-prev" onclick="navigateTo('chapter8')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12,19 5,12 12,5"/>
                    </svg>
                    Назад
                </button>
                <button class="nav-btn nav-btn-next" onclick="navigateTo('intro')">
                    На главную
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12,5 19,12 12,19"/>
                    </svg>
                </button>
            </div>
        </section>    </main>

    <script src="script.js"></script>
</body>
</html>
